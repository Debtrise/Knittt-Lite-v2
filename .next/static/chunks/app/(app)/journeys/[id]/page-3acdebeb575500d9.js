(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{10705:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>u,Es:()=>p,L3:()=>x,c7:()=>m,lG:()=>d});var s=a(95155),r=a(12115),i=a(66217),n=a(40767),l=a(67910);let d=i.bL;i.l9;let o=i.ZL;i.bm;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});c.displayName=i.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(i.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[r,(0,s.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=i.UC.displayName;let m=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});x.displayName=i.hE.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})}).displayName=i.VY.displayName},32906:(e,t,a)=>{"use strict";a.d(t,{S:()=>d});var s=a(95155),r=a(12115),i=a(86352),n=a(98867),l=a(67910);let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.bL,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,s.jsx)(i.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})})});d.displayName=i.bL.displayName},48353:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ej});var s=a(95155),r=a(12115),i=a(76046),n=a(48173),l=a.n(n),d=a(55037),o=a(87364),c=a(92823),u=a(22725),m=a(29191),p=a(26764),x=a(45686),h=a(1169),g=a(19393),y=a(97754),v=a(52107),f=a(10705),j=a(43031),b=a(76631),N=a(60477),w=a(32906),C=a(63669),S=a(73746),A=a(85725),T=a(75484),k=a(76962),E=a(95368),I=a(68719);a(11687);var _=a(62060),D=a(78058),q=a(38619),L=a(46967),R=a(44857),J=a(43831),O=a(63348),F=a(66462),P=a(14081),M=a(45471),U=a(35765),V=a(66889),W=a(71726),H=a(81476),$=a(21773),z=a(86835),B=a(61594);let Z=e=>{switch(e){case"call":return(0,s.jsx)(J.A,{className:"h-4 w-4 text-blue-500"});case"sms":return(0,s.jsx)(O.A,{className:"h-4 w-4 text-green-500"});case"email":return(0,s.jsx)(F.A,{className:"h-4 w-4 text-amber-500"});case"status_change":return(0,s.jsx)(P.A,{className:"h-4 w-4 text-purple-500"});case"tag_update":return(0,s.jsx)(M.A,{className:"h-4 w-4 text-indigo-500"});case"webhook":return(0,s.jsx)(U.A,{className:"h-4 w-4 text-gray-500"});case"wait_for_event":return(0,s.jsx)(V.A,{className:"h-4 w-4 text-teal-500"});case"conditional_branch":return(0,s.jsx)(W.A,{className:"h-4 w-4 text-indigo-500"});case"lead_assignment":return(0,s.jsx)(c.A,{className:"h-4 w-4 text-blue-400"});case"data_update":return(0,s.jsx)(H.A,{className:"h-4 w-4 text-orange-500"});case"journey_transfer":return(0,s.jsx)($.A,{className:"h-4 w-4 text-red-500"});case"delay":return(0,s.jsx)(V.A,{className:"h-4 w-4 text-gray-500"});default:return(0,s.jsx)(z.A,{className:"h-4 w-4 text-gray-500"})}},G=(e,t,a)=>{switch(e){case"call":case"lead_assignment":return t?"border-green-300":a?"border-red-300":"border-blue-300";case"sms":return t?"border-green-300":a?"border-red-300":"border-green-300";case"email":return t?"border-green-300":a?"border-red-300":"border-amber-300";case"status_change":return t?"border-green-300":a?"border-red-300":"border-purple-300";case"tag_update":case"conditional_branch":return t?"border-green-300":a?"border-red-300":"border-indigo-300";case"webhook":case"delay":return t?"border-green-300":a?"border-red-300":"border-gray-300";case"wait_for_event":return t?"border-green-300":a?"border-red-300":"border-teal-300";case"data_update":return t?"border-green-300":a?"border-red-300":"border-orange-300";case"journey_transfer":return t?"border-green-300":"border-red-300";default:return"border-gray-300"}},K=(e,t,a)=>{switch(e){case"call":return t?"Start":a?"End":"Call";case"sms":return t?"Start":a?"End":"SMS";case"email":return t?"Start":a?"End":"Email";case"status_change":return t?"Start":a?"End":"Status Change";case"tag_update":return t?"Start":a?"End":"Tag Update";case"webhook":return t?"Start":a?"End":"Webhook";case"wait_for_event":return t?"Start":a?"End":"Wait for Event";case"conditional_branch":return t?"Start":a?"End":"Branch";case"lead_assignment":return t?"Start":a?"End":"Assignment";case"data_update":return t?"Start":a?"End":"Data Update";case"journey_transfer":return t?"Start":a?"End":"Transfer";case"delay":return t?"Start":a?"End":"Delay";default:return"Unknown"}},X=(e,t)=>{switch(e){case"immediate":return"Immediate";case"fixed_time":return"At ".concat(t.time||"specific time");case"delay_after_previous":let a=t.minutes||0,s=t.hours||0,r=t.days||0,i=[];return r>0&&i.push("".concat(r," day").concat(1!==r?"s":"")),s>0&&i.push("".concat(s," hr").concat(1!==s?"s":"")),a>0&&i.push("".concat(a," min").concat(1!==a?"s":"")),i.length>0?"".concat(i.join(", ")," after previous"):"After previous";case"delay_after_enrollment":return"".concat(t.days||0,"d ").concat(t.hours||0,"h after enrollment");case"specific_days":let n=(Array.isArray(t.days)?t.days:[]).map(e=>e.substring(0,3)).join(", ");return"On ".concat(n||"specific days");default:return"Custom delay"}},Y=(0,r.memo)(e=>{var t,a,r,i,n,l,d,o,c,u,m,p;let{data:x}=e,{step:h,selected:g,onEdit:v,displayIndex:f}=x,j=h.isExitPoint,b=h.isActive,N=0===h.stepOrder,w=G(h.actionType,N,j),C=K(h.actionType,N,j),S=void 0!==f?f+1:Math.ceil(h.stepOrder/10);return(0,s.jsxs)("div",{className:"relative p-4 rounded-lg border-2 w-72 bg-white shadow-md transition-all hover:shadow-lg\n        ".concat(g?"border-brand ring-2 ring-brand ring-opacity-50":w,"\n        ").concat(b?"":"opacity-60","\n        ").concat(N?"bg-gradient-to-br from-green-50 to-white":"","\n        ").concat(j?"bg-gradient-to-br from-red-50 to-white":"","\n      "),onClick:()=>v(h),children:[!N&&!j&&(0,s.jsx)("div",{className:"absolute -left-3 -top-3 bg-brand text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-medium shadow-md",children:S}),!N&&(0,s.jsx)(T.h7,{type:"target",position:T.yX.Top,className:"w-3 h-3 bg-gray-400 !border-2 !border-white"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-full ".concat(N?"bg-green-100":j?"bg-red-100":"bg-gray-100"," flex items-center justify-center shadow-sm"),children:N?(0,s.jsx)(W.A,{className:"h-5 w-5 text-green-500"}):j?(0,s.jsx)(B.A,{className:"h-5 w-5 text-red-500"}):Z(h.actionType)}),(0,s.jsx)("div",{className:"flex-1 truncate font-medium text-gray-800 text-base",children:h.name}),(0,s.jsx)(y.E,{variant:"outline",className:"text-xs px-2 py-1 ".concat(N?"bg-green-100 text-green-700":j?"bg-red-100 text-red-700":""),children:C})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:h.description||"No description"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 my-3 bg-gray-50 p-2 rounded-md border border-gray-100",children:["call"===h.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(J.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{children:(null===(t=h.actionConfig)||void 0===t?void 0:t.transferNumber)||"No number"})]}),"sms"===h.actionType&&(0,s.jsx)("div",{className:"line-clamp-2",children:(null===(a=h.actionConfig)||void 0===a?void 0:a.message)||(null===(r=h.actionConfig)||void 0===r?void 0:r.templateId)||"No message"}),"email"===h.actionType&&(0,s.jsx)("div",{className:"line-clamp-2",children:(null===(i=h.actionConfig)||void 0===i?void 0:i.subject)||"No subject"}),"status_change"===h.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:["Status: ",(0,s.jsx)("span",{className:"font-medium",children:(null===(n=h.actionConfig)||void 0===n?void 0:n.newStatus)||"Not set"})]})]}),"tag_update"===h.actionType&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[(null===(l=h.actionConfig)||void 0===l?void 0:l.operation)||"add",":",((null===(d=h.actionConfig)||void 0===d?void 0:d.tags)||[]).map((e,t)=>(0,s.jsx)("span",{className:"bg-gray-200 px-2 py-0.5 rounded-full text-xs",children:e},t)),(!(null===(o=h.actionConfig)||void 0===o?void 0:o.tags)||(null===(c=h.actionConfig)||void 0===c?void 0:c.tags.length)===0)&&(0,s.jsx)("span",{className:"text-gray-400",children:"No tags"})]}),"conditional_branch"===h.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(W.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:[(null===(m=h.actionConfig)||void 0===m?void 0:null===(u=m.branches)||void 0===u?void 0:u.length)||0," condition(s)"]})]}),"wait_for_event"===h.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:["Wait for: ",(null===(p=h.actionConfig)||void 0===p?void 0:p.eventType)||"any event"]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-gray-500",children:X(h.delayType,h.delayConfig)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!b&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"}),j&&!j&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-100 text-red-800",children:"Exit"})]})]}),!j&&(0,s.jsx)(T.h7,{type:"source",position:T.yX.Bottom,className:"w-3 h-3 bg-gray-400 !border-2 !border-white"})]})});var Q=a(19710),ee=a(12558);let et=Q.Kq,ea=Q.bL,es=Q.l9,er=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...i}=e;return(0,s.jsx)(Q.UC,{ref:t,sideOffset:r,className:(0,ee.cn)("z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-900 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})});er.displayName=Q.UC.displayName;let ei={stepNode:Y},en=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(a.length>0){let e=a[a.length-1].position;return{x:e.x,y:e.y+150}}return t<=1?{x:250,y:50}:{x:250,y:50+150*e}},el=(e,t)=>"conditional_branch"===e.actionType?{type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2,strokeDasharray:"5,5"}}:"wait_for_event"===e.actionType?{type:"smoothstep",animated:!0,style:{stroke:"#10b981",strokeWidth:2}}:{type:"smoothstep",animated:!0,style:{stroke:"#999",strokeWidth:2}},ed=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=[...e].sort((e,t)=>e.stepOrder-t.stepOrder),r=s.map((e,r)=>{let i=0===r,n=r===s.length-1;i&&e.name==="Step ".concat(r+1)&&(e.name="Start"),n&&e.name==="Step ".concat(r+1)&&(e.name="End",e.isExitPoint=!0);let l=a.find(t=>t.id==="step-".concat(e.id)),d=l?l.position:en(r,s.length,a);return{id:"step-".concat(e.id),type:"stepNode",position:d,data:{step:e,selected:t===e.id,onEdit:()=>{},displayIndex:r}}}),i=[];for(let e=0;e<s.length-1;e++){let t=s[e],a=s[e+1];if(!t.isExitPoint){let e=el(t,a);i.push({id:"edge-".concat(t.id,"-").concat(a.id),source:"step-".concat(t.id),target:"step-".concat(a.id),...e,label:"conditional_branch"===t.actionType?"Default":void 0})}}return s.forEach(e=>{var t;"conditional_branch"===e.actionType&&(null===(t=e.actionConfig)||void 0===t?void 0:t.branches)&&(Array.isArray(e.actionConfig.branches)?e.actionConfig.branches:[]).forEach((t,a)=>{if(t.nextStepId){let s=t.nextStepId;i.push({id:"edge-".concat(e.id,"-branch-").concat(a,"-").concat(s),source:"step-".concat(e.id),target:"step-".concat(s),type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:1.5},label:t.name||"Condition ".concat(a+1)})}})}),{nodes:r,edges:i}},eo=e=>{let{journey:t,onJourneyUpdated:a,onSelectStep:i,selectedStep:n}=e,[l,o,c]=(0,T.ck)([]),[u,m,p]=(0,T.fM)([]),[x,h]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(t&&t.steps){let{nodes:e,edges:a}=ed(t.steps,(null==n?void 0:n.id)||null,l);o(e.map(e=>({...e,data:{...e.data,onEdit:e=>i(e)}}))),m(a)}},[t,n,o,m,i]);let f=(0,r.useCallback)(e=>{m(t=>(0,T.rN)({...e,type:"smoothstep",animated:!0,style:{stroke:"#999",strokeWidth:2}},t))},[m]),j=(0,r.useCallback)(async(e,a)=>{console.log("Node ".concat(a.id," position updated:"),a.position);let s=a.id.replace("step-","");t.steps.find(e=>e.id===parseInt(s,10))},[t]),b=async()=>{try{h(!0);let e=t.steps||[],s=e.length>0?Math.max(...e.map(e=>e.stepOrder)):0,r={name:"Step ".concat(e.length+1),description:"",stepOrder:s+10,actionType:"call",actionConfig:{},delayType:"immediate",delayConfig:{},conditions:{},isActive:!0,isExitPoint:!1};await (0,A.nn)(t.id,r),d.Ay.success("Step added successfully"),a()}catch(e){console.error("Error adding step:",e),d.Ay.error("Failed to add step")}finally{h(!1)}},N=(0,r.useCallback)(()=>{let e=new Blob([JSON.stringify({journeyId:t.id,name:t.name,steps:t.steps},null,2)],{type:"application/json"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="journey-".concat(t.id,"-flow.json"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},[t]);return(0,r.useEffect)(()=>{let{nodes:e}=new DagreLayout().layout({nodes:l,edges:u,options:{rankdir:"TB",ranksep:50,nodesep:50}});o(e)},[l]),(0,s.jsx)("div",{className:"h-[600px] w-full border border-gray-200 rounded-lg bg-white shadow-sm",children:(0,s.jsxs)(T.Gc,{nodes:l,edges:u,onNodesChange:c,onEdgesChange:p,onConnect:f,onNodeDragStop:j,nodeTypes:ei,defaultEdgeOptions:{type:"smoothstep",style:{stroke:"#94a3b8",strokeWidth:2}},connectionLineType:T.Do.SmoothStep,connectionLineStyle:{stroke:"#94a3b8",strokeWidth:2},fitView:!0,minZoom:.1,maxZoom:1.5,proOptions:{hideAttribution:!0},onInit:v,children:[(0,s.jsx)(k.V,{color:"#f8fafc",gap:24,size:1}),(0,s.jsx)(E.H,{showInteractive:!1,className:"bg-white rounded-lg shadow-md border border-gray-200"}),(0,s.jsx)(I.o,{nodeColor:e=>{let a=t.steps.find(t=>"step-".concat(t.id)===e.id);if(!a)return"#cbd5e1";switch(a.actionType){case"call":return"#3b82f6";case"sms":return"#10b981";case"email":return"#f59e0b";case"tag_update":return"#8b5cf6";case"status_change":return"#ec4899";case"webhook":return"#6b7280";case"wait_for_event":return"#14b8a6";case"conditional_branch":return"#6366f1";default:return"#cbd5e1"}},maskColor:"rgba(255, 255, 255, 0.8)",className:"bg-white rounded-lg shadow-md border border-gray-200"}),(0,s.jsx)(T.Zk,{position:"top-right",className:"bg-white p-3 rounded-lg shadow-md border border-gray-200",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,s.jsx)(et,{children:(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{asChild:!0,children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:b,disabled:x,className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,s.jsx)(_.A,{className:"h-4 w-4"}),"Add Step"]})}),(0,s.jsx)(er,{children:(0,s.jsx)("p",{children:"Add a new step to the journey"})})]})}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(et,{children:(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{y&&y.zoomIn()},className:"hover:bg-gray-50",children:(0,s.jsx)(D.A,{className:"h-4 w-4"})})}),(0,s.jsx)(er,{children:(0,s.jsx)("p",{children:"Zoom in"})})]})}),(0,s.jsx)(et,{children:(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{y&&y.zoomOut()},className:"hover:bg-gray-50",children:(0,s.jsx)(q.A,{className:"h-4 w-4"})})}),(0,s.jsx)(er,{children:(0,s.jsx)("p",{children:"Zoom out"})})]})}),(0,s.jsx)(et,{children:(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{y&&y.fitView()},className:"hover:bg-gray-50",children:(0,s.jsx)(L.A,{className:"h-4 w-4"})})}),(0,s.jsx)(er,{children:(0,s.jsx)("p",{children:"Fit view"})})]})})]}),(0,s.jsx)(et,{children:(0,s.jsxs)(ea,{children:[(0,s.jsx)(es,{asChild:!0,children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:N,className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,s.jsx)(R.A,{className:"h-4 w-4"}),"Export"]})}),(0,s.jsx)(er,{children:(0,s.jsx)("p",{children:"Export journey as JSON"})})]})})]})})]})})};var ec=a(88941);let eu=e=>{switch(e){case"call":return[{id:"transferNumber",name:"Transfer Number",type:"string",required:!1,description:"Direct transfer number (leave empty to use transfer group)"},{id:"transferGroupId",name:"Transfer Group",type:"transfer_group_select",required:!1,description:"Select a transfer group for routing"},{id:"scriptId",name:"Call Script",type:"template_select",templateType:"script",required:!1,description:"Select a script template for the call"},{id:"fallbackDID",name:"Fallback DID",type:"string",required:!1,description:"Fallback DID if no DIDs available"},{id:"useLocalDID",name:"Use Local DID",type:"boolean",required:!1,default:!0,description:"Whether to try matching lead's area code"},{id:"maxAttempts",name:"Maximum Attempts",type:"number",required:!1,default:3,description:"Maximum attempts for this call"},{id:"voicemailDetection",name:"Voicemail Detection",type:"boolean",required:!1,default:!0,description:"Whether to detect voicemail"},{id:"voicemailMessage",name:"Voicemail Script",type:"template_select",templateType:"voicemail",required:!1,description:"Select a voicemail script template"},{id:"callerId",name:"Caller ID Name",type:"string",required:!1,description:"Custom caller ID name"},{id:"recordCall",name:"Record Call",type:"boolean",required:!1,default:!0,description:"Whether to record the call"},{id:"respectBusinessHours",name:"Respect Business Hours",type:"boolean",required:!1,default:!0,description:"Whether to respect tenant business hours"},{id:"ivrEnabled",name:"Enable IVR",type:"boolean",required:!1,default:!1,description:"Enable Interactive Voice Response system"},{id:"ivrPromptText",name:"IVR Prompt Text",type:"string",required:!1,description:'Text-to-speech prompt for IVR (e.g., "Press 1 for sales, 2 for support")'},{id:"ivrPromptRecordingId",name:"IVR Prompt Recording",type:"recording_select",required:!1,description:"Recording ID for IVR prompt (alternative to text)"},{id:"ivrTimeout",name:"IVR Timeout (seconds)",type:"number",required:!1,default:10,description:"Seconds to wait for user input"},{id:"ivrMaxRetries",name:"IVR Max Retries",type:"number",required:!1,default:3,description:"Maximum retries for invalid input"},{id:"ivrInvalidInputText",name:"Invalid Input Text",type:"string",required:!1,description:'Text-to-speech for invalid input (e.g., "Invalid selection, please try again")'},{id:"ivrInvalidInputRecordingId",name:"Invalid Input Recording",type:"recording_select",required:!1,description:"Recording ID for invalid input message"},{id:"ivrOptions",name:"IVR Menu Options",type:"ivr_options",required:!1,description:"Configure IVR menu options and actions"}];case"sms":return[{id:"message",name:"Message",type:"string",required:!1,description:"SMS text (supports variables) - leave empty to use template"},{id:"templateId",name:"SMS Template",type:"template_select",templateType:"sms",required:!1,description:"Select an SMS template (alternative to message)"},{id:"from",name:"From Number",type:"string",required:!1,description:"Sender phone number (leave empty for default)"},{id:"trackClicks",name:"Track Clicks",type:"boolean",required:!1,default:!0,description:"Whether to track link clicks"},{id:"optOutMessage",name:"Include Opt-Out",type:"boolean",required:!1,default:!0,description:"Include opt-out instructions"}];case"email":return[{id:"subject",name:"Subject",type:"string",required:!1,description:"Email subject (leave empty to use template subject)"},{id:"templateId",name:"Email Template",type:"template_select",templateType:"email",required:!0,description:"Select an email template"},{id:"from",name:"From Email",type:"string",required:!1,description:"Sender email (leave empty for default)"},{id:"fromName",name:"From Name",type:"string",required:!1,description:"Sender name (leave empty for default)"},{id:"replyTo",name:"Reply-To",type:"string",required:!1,description:"Reply-to address (leave empty for default)"},{id:"trackOpens",name:"Track Opens",type:"boolean",required:!1,default:!0,description:"Track email opens"},{id:"trackClicks",name:"Track Clicks",type:"boolean",required:!1,default:!0,description:"Track link clicks"}];case"status_change":return[{id:"newStatus",name:"New Status",type:"string",required:!0,description:"New status value"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Add a note about the change"},{id:"noteText",name:"Note Text",type:"string",required:!1,default:"Status changed by journey",description:"Custom note text"},{id:"updateLastAttempt",name:"Update Last Attempt",type:"boolean",required:!1,default:!0,description:"Update lastAttempt timestamp"}];case"tag_update":return[{id:"operation",name:"Operation",type:"select",required:!0,options:["add","remove","set"],default:"add",description:"Operation: add, remove, or set"},{id:"tags",name:"Tags",type:"string",required:!0,description:"Comma-separated tags to operate on"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Record a note about tag changes"},{id:"noteText",name:"Note Text",type:"string",required:!1,default:"Tags updated by journey",description:"Custom note text"}];case"webhook":return[{id:"url",name:"Webhook URL",type:"string",required:!0,description:"Webhook URL"},{id:"method",name:"HTTP Method",type:"select",options:["GET","POST","PUT","PATCH","DELETE"],required:!1,default:"POST",description:"HTTP method"},{id:"timeout",name:"Timeout (ms)",type:"number",required:!1,default:1e4,description:"Timeout in milliseconds"},{id:"retries",name:"Retries",type:"number",required:!1,default:3,description:"Number of retry attempts"},{id:"updateLeadData",name:"Update Lead Data",type:"boolean",required:!1,default:!1,description:"Update lead with response data"}];case"wait_for_event":return[{id:"eventType",name:"Event Type",type:"select",options:["inbound_call","email_opened","link_clicked","form_submitted","sms_replied"],required:!0,description:"Event type to wait for"},{id:"timeoutDays",name:"Timeout Days",type:"number",required:!1,default:7,description:"Days to wait before timing out"},{id:"timeoutAction",name:"Timeout Action",type:"select",options:["skip_step","end_journey"],required:!1,default:"skip_step",description:"Action on timeout"},{id:"captureData",name:"Capture Event Data",type:"boolean",required:!1,default:!0,description:"Whether to capture event data"}];case"conditional_branch":return[{id:"conditionField",name:"Condition Field",type:"string",required:!0,description:"Field to evaluate (e.g., additionalData.value)"},{id:"operator",name:"Operator",type:"select",options:["=","!=",">","<",">=","<=","contains","not_contains","exists","not_exists"],required:!0,description:"Comparison operator"},{id:"value",name:"Value",type:"string",required:!1,description:"Value to compare against"},{id:"nextStepId",name:"Next Step ID",type:"number",required:!0,description:"ID of step to go to if condition is true"},{id:"defaultNextStepId",name:"Default Next Step ID",type:"number",required:!1,description:"Default step if condition is false"}];case"lead_assignment":return[{id:"assignmentType",name:"Assignment Type",type:"select",options:["user","team"],required:!0,description:"User or team"},{id:"assignToId",name:"Assign To ID",type:"string",required:!0,description:"User or team ID"},{id:"notifyAssignee",name:"Notify Assignee",type:"boolean",required:!1,default:!0,description:"Send notification to assignee"},{id:"notificationMethod",name:"Notification Method",type:"select",options:["email","sms","system"],required:!1,default:"email",description:"Method to notify assignee"},{id:"assignmentNote",name:"Assignment Note",type:"string",required:!1,description:"Note for the assignee"},{id:"priority",name:"Priority",type:"select",options:["low","medium","high","urgent"],required:!1,default:"medium",description:"Priority level"}];case"data_update":return[{id:"field",name:"Field",type:"string",required:!0,description:"Field to update (e.g., additionalData.score)"},{id:"value",name:"Value",type:"string",required:!0,description:"New value"},{id:"operation",name:"Operation",type:"select",options:["set","increment","decrement"],required:!1,default:"set",description:"Operation to perform"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Record a note about the update"}];case"journey_transfer":return[{id:"targetJourneyId",name:"Target Journey ID",type:"number",required:!0,description:"Target journey ID"},{id:"exitCurrentJourney",name:"Exit Current Journey",type:"boolean",required:!1,default:!0,description:"Whether to exit the current journey"},{id:"transferContextData",name:"Transfer Context Data",type:"boolean",required:!1,default:!0,description:"Transfer context data to new journey"},{id:"startAtStep",name:"Start At Step",type:"number",required:!1,description:"Start at specific step ID (null = start at beginning)"}];case"delay":return[{id:"minutes",name:"Minutes",type:"number",required:!1,default:0,description:"Minutes to delay"},{id:"hours",name:"Hours",type:"number",required:!1,default:0,description:"Hours to delay"},{id:"days",name:"Days",type:"number",required:!1,default:0,description:"Days to delay"},{id:"businessHoursOnly",name:"Business Hours Only",type:"boolean",required:!1,default:!0,description:"Only count business hours"},{id:"exactDateTime",name:"Exact Date/Time",type:"string",required:!1,description:"Specific date/time to resume (ISO format)"},{id:"overrideStepDelay",name:"Override Step Delay",type:"boolean",required:!1,default:!0,description:"Whether this overrides the step's delayConfig"}];default:return[]}},em=e=>{switch(e){case"immediate":default:return[];case"fixed_time":return[{id:"time",name:"Time",type:"string",required:!0,description:"Time in HH:MM format (24-hour)"}];case"delay_after_previous":case"delay_after_enrollment":return[{id:"minutes",name:"Minutes",type:"number",required:!1,default:0,description:"Minutes to delay"},{id:"hours",name:"Hours",type:"number",required:!1,default:0,description:"Hours to delay"},{id:"days",name:"Days",type:"number",required:!1,default:0,description:"Days to delay"}];case"specific_days":return[{id:"days",name:"Days",type:"select",options:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],required:!0,description:"Days of the week to execute"},{id:"time",name:"Time",type:"string",required:!0,description:"Time in HH:MM format (24-hour)"}]}},ep=e=>{let t=eu(e),a={};return t.forEach(e=>{void 0!==e.default?a[e.id]=e.default:e.required&&("string"===e.type?a[e.id]="":"number"===e.type?a[e.id]=0:"boolean"===e.type?a[e.id]=!1:"select"===e.type&&e.options&&e.options.length>0&&(a[e.id]=e.options[0]))}),a},ex=e=>{let t=em(e),a={};return t.forEach(e=>{void 0!==e.default?a[e.id]=e.default:e.required&&("string"===e.type?a[e.id]="":"number"===e.type?a[e.id]=0:"boolean"===e.type?a[e.id]=!1:"select"===e.type&&e.options&&e.options.length>0&&(a[e.id]=e.options[0]))}),a};var eh=a(34639),eg=a(92598),ey=a(87780),ev=a(97214);let ef=e=>{var t,a;let{step:i,journeyId:n,onStepUpdated:l,onStepDeleted:o,stepIndex:c}=e,{isAuthenticated:u,user:m,token:p}=(0,S.n)();console.log("StepEditor - Authentication state:",{isAuthenticated:u,user:m,hasToken:!!p});let[h,y]=(0,r.useState)({name:"",description:"",stepOrder:0,actionType:"call",actionConfig:{},delayType:"immediate",delayConfig:{},isActive:!0,isExitPoint:!1}),[v,f]=(0,r.useState)(!1),[C,T]=(0,r.useState)(!1),[k,E]=(0,r.useState)({}),[I,_]=(0,r.useState)([]),[D,q]=(0,r.useState)([]),[L,R]=(0,r.useState)(!1),[J,O]=(0,r.useState)(!1),[F,P]=(0,r.useState)(!1),[M,U]=(0,r.useState)(null),[V,W]=(0,r.useState)(!1),[H,$]=(0,r.useState)(!1),[z,B]=(0,r.useState)("html"),Z=void 0!==c?c+1:Math.ceil(i.stepOrder/10),G=eu(h.actionType),K=em(h.delayType),X=(0,r.useCallback)(async e=>{if(!u){console.warn("User not authenticated, skipping template loading");return}console.log("Loading templates for types:",e),R(!0);try{let a={};for(let s of e)try{var t;console.log("Loading templates for type: ".concat(s));let e=await eh.Ay.templates.list({type:s,isActive:!0,limit:100}),r=(null===(t=e.data)||void 0===t?void 0:t.templates)||e.data||[];a[s]=Array.isArray(r)?r:[],console.log("Loaded ".concat(a[s].length," templates for ").concat(s)),console.log("Sample template data for ".concat(s,":"),a[s][0])}catch(e){console.error("Error loading templates for type ".concat(s,":"),e),a[s]=[]}E(e=>({...e,...a}))}catch(e){console.error("Error loading templates:",e),d.Ay.error("Failed to load templates")}finally{R(!1)}},[u]),Y=(0,r.useCallback)(async()=>{if(!u){console.warn("User not authenticated, skipping transfer groups loading");return}console.log("Loading transfer groups..."),O(!0);try{var e;let t=await eh.Ay.transferGroups.list({isActive:!0,limit:100});console.log("Transfer groups API response:",t);let a=(null===(e=t.data)||void 0===e?void 0:e.groups)||t.data||[];_(Array.isArray(a)?a:[]),console.log("Loaded ".concat(a.length," transfer groups"))}catch(e){console.error("Error loading transfer groups:",e),d.Ay.error("Failed to load transfer groups"),_([])}finally{O(!1)}},[u]),Q=(0,r.useCallback)(async()=>{var e,t,a,s;if(!u){console.warn("User not authenticated, skipping recordings loading");return}console.log("Loading recordings..."),P(!0);try{let a=await eh.Ay.recordings.getConfig();if(!(null===(e=a.data)||void 0===e?void 0:e.apiKey)){console.warn("Eleven Labs API not configured"),d.Ay.error("Eleven Labs API not configured. Please configure it in Settings."),q([]);return}let s=await eh.Ay.recordings.list({isActive:!0,limit:100});console.log("Recordings API response:",s);let r=(null===(t=s.data)||void 0===t?void 0:t.data)||s.data||[];q(Array.isArray(r)?r:[]),console.log("Loaded ".concat(r.length," recordings"))}catch(e){console.error("Error loading recordings:",e),(null===(a=e.response)||void 0===a?void 0:a.status)===401?d.Ay.error("Authentication required to load recordings"):(null===(s=e.response)||void 0===s?void 0:s.status)===404?d.Ay.error("Recordings API not available. Please check your configuration."):d.Ay.error("Failed to load recordings"),q([])}finally{P(!1)}},[u]);if((0,r.useEffect)(()=>{i&&y({name:i.name,description:i.description,stepOrder:i.stepOrder,actionType:i.actionType,actionConfig:i.actionConfig,delayType:i.delayType,delayConfig:i.delayConfig,isActive:i.isActive,isExitPoint:i.isExitPoint})},[i]),(0,r.useEffect)(()=>{u&&("sms"===h.actionType?X(["sms"]):"email"===h.actionType?X(["email"]):"call"===h.actionType&&X(["script","voicemail"]))},[h.actionType,u,X]),(0,r.useEffect)(()=>{"call"===h.actionType&&u&&Y()},[h.actionType,u,Y]),(0,r.useEffect)(()=>{var e;"call"===h.actionType&&(null===(e=h.actionConfig)||void 0===e?void 0:e.ivrEnabled)&&u&&Q()},[h.actionType,null===(t=h.actionConfig)||void 0===t?void 0:t.ivrEnabled,u,Q]),!u)return(0,s.jsxs)("div",{className:"bg-white p-4 border border-gray-200 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Step"}),(0,s.jsxs)("div",{className:"bg-brand text-white px-2 py-1 rounded-md text-sm font-medium",children:["Step ",Z]})]}),(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Please log in to edit journey steps."})})]});let ee=async e=>{if(u&&e){console.log("Loading email preview for template:",e),$(!0);try{let t=await eh.Ay.templates.get(e),a=t.data||t;console.log("Template response:",a);let s=null;try{s=await eh.Ay.templates.renderPreview(e,{variables:{firstName:"John",lastName:"Doe",email:"john.doe@example.com",phone:"+1234567890",company:"Example Company"},context:{leadId:"sample",journeyId:n.toString(),stepId:i.id.toString()}}),console.log("Preview response:",s)}catch(e){console.warn("Preview rendering failed, using template content directly:",e)}let r="",l="",d="";(null==s?void 0:s.data)&&(r=s.data.htmlContent||s.data.html||"",l=s.data.textContent||s.data.text||s.data.content||"",d=s.data.subject||""),r||l||(r=a.htmlContent||a.html_content||"",l=a.content||a.textContent||a.text_content||"",d=a.subject||""),!r&&l&&(r='<html><body><div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">'.concat(l.replace(/\n/g,"<br>"),"</div></body></html>")),console.log("Final content:",{htmlContent:r,textContent:l,subject:d}),U({subject:d||"No Subject",htmlContent:r,textContent:l}),B("html"),W(!0)}catch(e){console.error("Error loading email preview:",e),d.Ay.error("Failed to load email preview")}finally{$(!1)}}},et=(e,t)=>{y(a=>({...a,[e]:t}))},ea=(e,t)=>{y(a=>({...a,actionConfig:{...a.actionConfig,[e]:t}}))},es=(e,t)=>{y(a=>({...a,delayConfig:{...a.delayConfig,[e]:t}}))},er=async()=>{try{f(!0),await (0,A.sc)(n,i.id,h),d.Ay.success("Step updated successfully"),l()}catch(e){console.error("Error updating step:",e),d.Ay.error("Failed to update step")}finally{f(!1)}},ei=async()=>{if(confirm("Are you sure you want to delete this step?"))try{T(!0),await (0,A.gF)(n,i.id),d.Ay.success("Step deleted successfully"),o()}catch(e){console.error("Error deleting step:",e),d.Ay.error("Failed to delete step")}finally{T(!1)}},en=e=>{let{value:t,onChange:a,fieldId:i}=e,n=t||{},[l,d]=(0,r.useState)(!1),o=(e,t)=>{a(i,{...n,[e]:t})},c=e=>{let t={...n};delete t[e],a(i,t)},m=Object.keys(n),p=["1","2","3","4","5","6","7","8","9","0","*","#","default"].filter(e=>!m.includes(e));return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["IVR Menu Options (",m.length,")"]}),(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>d(!l),children:[l?"Hide":"Configure"," IVR Menu"]})]}),l&&(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50 space-y-4",children:[m.map(e=>{var t,a,r,i,l,d,m,p,x,h,y,v,f,b,w,C,S,A;return(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsxs)("h5",{className:"font-medium text-sm",children:["Key: ","default"===e?"Default (No Input/Invalid)":e]}),(0,s.jsx)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>c(e),children:"Remove"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Action"}),(0,s.jsxs)(ec.l6,{value:(null===(t=n[e])||void 0===t?void 0:t.action)||"transfer",onValueChange:t=>o(e,{...n[e],action:t}),children:[(0,s.jsx)(ec.bq,{children:(0,s.jsx)(ec.yv,{placeholder:"Select action"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"transfer",children:"Transfer Call"}),(0,s.jsx)(ec.eb,{value:"playRecording",children:"Play Recording"}),(0,s.jsx)(ec.eb,{value:"hangup",children:"Hang Up"}),(0,s.jsx)(ec.eb,{value:"collectInput",children:"Collect More Input"}),(0,s.jsx)(ec.eb,{value:"tag",children:"Add Tag"}),(0,s.jsx)(ec.eb,{value:"webhook",children:"Call Webhook"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Description"}),(0,s.jsx)(j.p,{value:(null===(a=n[e])||void 0===a?void 0:a.description)||"",onChange:t=>o(e,{...n[e],description:t.target.value}),placeholder:"Description for this option"})]})]}),(null===(r=n[e])||void 0===r?void 0:r.action)==="transfer"&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Transfer Number"}),(0,s.jsx)(j.p,{value:(null===(i=n[e])||void 0===i?void 0:i.transferNumber)||"",onChange:t=>o(e,{...n[e],transferNumber:t.target.value}),placeholder:"Phone number to transfer to"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Transfer Group"}),(0,s.jsxs)(ec.l6,{value:(null===(d=n[e])||void 0===d?void 0:null===(l=d.transferGroupId)||void 0===l?void 0:l.toString())||"none",onValueChange:t=>o(e,{...n[e],transferGroupId:"none"===t?null:parseInt(t)}),children:[(0,s.jsx)(ec.bq,{children:(0,s.jsx)(ec.yv,{placeholder:"Select transfer group"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"none",children:"No transfer group"}),I.map(e=>(0,s.jsxs)(ec.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id))]})]})]})]}),(null===(m=n[e])||void 0===m?void 0:m.action)==="playRecording"&&(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Select Recording"}),(0,s.jsxs)(ec.l6,{value:(null===(x=n[e])||void 0===x?void 0:null===(p=x.recordingId)||void 0===p?void 0:p.toString())||"none",onValueChange:t=>{let a="none"===t?null:parseInt(t);o(e,{...n[e],recordingId:a})},disabled:F,onOpenChange:e=>{e&&0===D.length&&u&&(console.log("Recording dropdown opened in IVR options, loading recordings..."),Q())},children:[(0,s.jsx)(ec.bq,{children:(0,s.jsx)(ec.yv,{placeholder:F?"Loading recordings...":"Select a recording"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"none",children:"No recording (use text below)"}),D.map(e=>(0,s.jsxs)(ec.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===D.length&&!F&&(0,s.jsx)(ec.eb,{value:"none",disabled:!0,children:"No recordings available - Configure Eleven Labs in Settings"})]})]}),(null===(h=n[e])||void 0===h?void 0:h.recordingId)&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Preview Recording"})}),(0,s.jsx)(ev.A,{recordingId:n[e].recordingId.toString(),recordingName:(null===(y=D.find(t=>t.id.toString()===n[e].recordingId.toString()))||void 0===y?void 0:y.name)||"Recording",audioUrl:null===(v=D.find(t=>t.id.toString()===n[e].recordingId.toString()))||void 0===v?void 0:v.audioUrl})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Fallback Text (TTS)"}),(0,s.jsx)(j.p,{value:(null===(f=n[e])||void 0===f?void 0:f.recordingText)||"",onChange:t=>o(e,{...n[e],recordingText:t.target.value}),placeholder:"Text-to-speech fallback if recording unavailable"})]})]}),(null===(b=n[e])||void 0===b?void 0:b.action)==="tag"&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Tag Name"}),(0,s.jsx)(j.p,{value:(null===(w=n[e])||void 0===w?void 0:w.tag)||"",onChange:t=>o(e,{...n[e],tag:t.target.value}),placeholder:"Tag to add to lead"})]}),(null===(C=n[e])||void 0===C?void 0:C.action)==="webhook"&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Webhook URL"}),(0,s.jsx)(j.p,{value:(null===(S=n[e])||void 0===S?void 0:S.webhookUrl)||"",onChange:t=>o(e,{...n[e],webhookUrl:t.target.value}),placeholder:"https://example.com/webhook"})]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Next Step ID (Optional)"}),(0,s.jsx)(j.p,{type:"number",value:(null===(A=n[e])||void 0===A?void 0:A.nextStepId)||"",onChange:t=>o(e,{...n[e],nextStepId:parseInt(t.target.value)||null}),placeholder:"Jump to specific step after action"})]})]},e)}),p.length>0&&(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Add IVR Menu Option"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:p.map(e=>(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>o(e,{action:"transfer",description:"Option ".concat("default"===e?"Default":e)}),children:["Add ","default"===e?"Default":e]},e))})]}),0===p.length&&(0,s.jsx)("div",{className:"text-center py-2",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"All IVR options configured"})})]}),0===m.length&&!l&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No IVR options configured"})]})},el=(e,t,a)=>{var r,i,n;switch(e.type){case"string":return(0,s.jsx)(j.p,{id:e.id,value:t||e.default||"",onChange:t=>a(e.id,t.target.value),placeholder:e.description});case"number":return(0,s.jsx)(j.p,{id:e.id,type:"number",value:void 0!==t?t:e.default||0,onChange:t=>a(e.id,parseInt(t.target.value,10)||0),placeholder:e.description});case"boolean":return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:e.id,checked:void 0!==t?t:e.default||!1,onCheckedChange:t=>a(e.id,!!t)}),(0,s.jsx)(N.J,{htmlFor:e.id,children:e.description})]});case"select":return(0,s.jsxs)(ec.l6,{value:t||e.default||(e.options?e.options[0]:""),onValueChange:t=>a(e.id,t),children:[(0,s.jsx)(ec.bq,{id:e.id,children:(0,s.jsx)(ec.yv,{placeholder:e.description})}),(0,s.jsx)(ec.gC,{children:null===(r=e.options)||void 0===r?void 0:r.map(e=>(0,s.jsx)(ec.eb,{value:e,children:e},e))})]});case"template_select":let l=e.templateType&&k[e.templateType]||[],d="email"===e.templateType,o=t||e.default;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(ec.l6,{value:o||"none",onValueChange:t=>{a(e.id,"none"===t?"":t),d&&(U(null),W(!1))},disabled:L,onOpenChange:t=>{t&&e.templateType&&(!k[e.templateType]||0===k[e.templateType].length)&&u&&(console.log("Template dropdown opened for ".concat(e.templateType,", loading templates...")),X([e.templateType]))},children:[(0,s.jsx)(ec.bq,{id:e.id,children:(0,s.jsx)(ec.yv,{placeholder:L?"Loading templates...":"Select a template"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"none",children:"No template"}),l.map(e=>(0,s.jsx)(ec.eb,{value:e.id.toString(),children:e.name},e.id)),0===l.length&&!L&&(0,s.jsxs)(ec.eb,{value:"no-templates",disabled:!0,children:["No ",e.templateType," templates found"]})]})]}),d&&o&&"none"!==o&&(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>ee(o),disabled:H,className:"w-full flex items-center gap-2",children:[(0,s.jsx)(eg.A,{className:"h-4 w-4"}),H?"Loading Preview...":"Preview Email"]})]});case"transfer_group_select":return(0,s.jsxs)(ec.l6,{value:t||e.default||"none",onValueChange:t=>a(e.id,"none"===t?"":t),disabled:J,onOpenChange:e=>{e&&0===I.length&&u&&(console.log("Transfer group dropdown opened, loading transfer groups..."),Y())},children:[(0,s.jsx)(ec.bq,{id:e.id,children:(0,s.jsx)(ec.yv,{placeholder:J?"Loading transfer groups...":"Select a transfer group"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"none",children:"No transfer group"}),I.map(e=>(0,s.jsxs)(ec.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===I.length&&!J&&(0,s.jsx)(ec.eb,{value:"no-groups",disabled:!0,children:"No transfer groups found"})]})]});case"recording_select":let c=t||e.default;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(ec.l6,{value:(null==c?void 0:c.toString())||"none",onValueChange:t=>{let s="none"===t?null:parseInt(t);a(e.id,s)},disabled:F,onOpenChange:e=>{e&&0===D.length&&u&&(console.log("Recording dropdown opened, loading recordings..."),Q())},children:[(0,s.jsx)(ec.bq,{id:e.id,children:(0,s.jsx)(ec.yv,{placeholder:F?"Loading recordings...":"Select a recording"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"none",children:"No recording (use text-to-speech)"}),D.map(e=>(0,s.jsxs)(ec.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===D.length&&!F&&(0,s.jsx)(ec.eb,{value:"none",disabled:!0,children:"No recordings available - Configure Eleven Labs in Settings"})]})]}),c&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Preview Recording"})}),(0,s.jsx)(ev.A,{recordingId:c.toString(),recordingName:(null===(i=D.find(e=>e.id.toString()===c.toString()))||void 0===i?void 0:i.name)||"Recording",audioUrl:null===(n=D.find(e=>e.id.toString()===c.toString()))||void 0===n?void 0:n.audioUrl})]})]});case"ivr_options":return(0,s.jsx)(en,{value:t,onChange:a,fieldId:e.id});default:return null}};return(0,s.jsxs)("div",{className:"bg-white p-4 border border-gray-200 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Step"}),(0,s.jsxs)("div",{className:"bg-brand text-white px-2 py-1 rounded-md text-sm font-medium",children:["Step ",Z]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"name",children:"Name"}),(0,s.jsx)(j.p,{id:"name",value:h.name,onChange:e=>et("name",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"description",children:"Description"}),(0,s.jsx)(b.T,{id:"description",value:h.description,onChange:e=>et("description",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"stepOrder",children:"Order"}),(0,s.jsx)(j.p,{id:"stepOrder",type:"number",value:void 0!==h.stepOrder&&Number(h.stepOrder)||0,onChange:e=>et("stepOrder",parseInt(e.target.value,10)||0)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Internal order value. Displayed as Step ",Z,"."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"actionType",children:"Action Type"}),(0,s.jsxs)(ec.l6,{value:h.actionType,onValueChange:e=>{console.log("Action type changing to:",e);let t=ep(e),a=eu(e);console.log("New action params:",a),console.log("Template select params:",a.filter(e=>"template_select"===e.type)),console.log("Transfer group select params:",a.filter(e=>"transfer_group_select"===e.type)),y(a=>({...a,actionType:e,actionConfig:t}))},children:[(0,s.jsx)(ec.bq,{id:"actionType",children:(0,s.jsx)(ec.yv,{placeholder:"Select action type"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"call",children:"Call"}),(0,s.jsx)(ec.eb,{value:"sms",children:"SMS"}),(0,s.jsx)(ec.eb,{value:"email",children:"Email"}),(0,s.jsx)(ec.eb,{value:"status_change",children:"Status Change"}),(0,s.jsx)(ec.eb,{value:"tag_update",children:"Tag Update"}),(0,s.jsx)(ec.eb,{value:"webhook",children:"Webhook"}),(0,s.jsx)(ec.eb,{value:"wait_for_event",children:"Wait for Event"}),(0,s.jsx)(ec.eb,{value:"conditional_branch",children:"Conditional Branch"}),(0,s.jsx)(ec.eb,{value:"lead_assignment",children:"Lead Assignment"}),(0,s.jsx)(ec.eb,{value:"data_update",children:"Data Update"}),(0,s.jsx)(ec.eb,{value:"journey_transfer",children:"Journey Transfer"}),(0,s.jsx)(ec.eb,{value:"delay",children:"Delay"})]})]})]}),(0,s.jsxs)("div",{className:"border border-gray-200 rounded-md p-3 bg-white",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Action Configuration"}),(0,s.jsxs)("div",{className:"space-y-3",children:[G.filter(e=>!e.id.startsWith("ivr")||"ivrEnabled"===e.id).map(e=>{var t;return(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),el(e,null===(t=h.actionConfig)||void 0===t?void 0:t[e.id],ea),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id)}),0===G.filter(e=>!e.id.startsWith("ivr")||"ivrEnabled"===e.id).length&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No configuration needed for this action type."})]})]}),"call"===h.actionType&&(null===(a=h.actionConfig)||void 0===a?void 0:a.ivrEnabled)&&(0,s.jsxs)("div",{className:"border border-blue-200 rounded-md p-3 bg-blue-50",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"IVR Configuration"}),(0,s.jsx)("div",{className:"space-y-3",children:G.filter(e=>e.id.startsWith("ivr")&&"ivrEnabled"!==e.id).map(e=>{var t;return(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),el(e,null===(t=h.actionConfig)||void 0===t?void 0:t[e.id],ea),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"delayType",children:"Delay Type"}),(0,s.jsxs)(ec.l6,{value:h.delayType,onValueChange:e=>{let t=ex(e);y(a=>({...a,delayType:e,delayConfig:t}))},children:[(0,s.jsx)(ec.bq,{id:"delayType",children:(0,s.jsx)(ec.yv,{placeholder:"Select delay type"})}),(0,s.jsxs)(ec.gC,{children:[(0,s.jsx)(ec.eb,{value:"immediate",children:"Immediate"}),(0,s.jsx)(ec.eb,{value:"fixed_time",children:"Fixed Time"}),(0,s.jsx)(ec.eb,{value:"delay_after_previous",children:"Delay After Previous"}),(0,s.jsx)(ec.eb,{value:"delay_after_enrollment",children:"Delay After Enrollment"}),(0,s.jsx)(ec.eb,{value:"specific_days",children:"Specific Days"})]})]})]}),K.length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-md p-3 bg-white",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Delay Configuration"}),(0,s.jsx)("div",{className:"space-y-3",children:K.map(e=>{var t;return(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),el(e,null===(t=h.delayConfig)||void 0===t?void 0:t[e.id],es),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id)})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"isActive",checked:h.isActive,onCheckedChange:e=>et("isActive",!!e)}),(0,s.jsx)(N.J,{htmlFor:"isActive",children:"Active"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"isExitPoint",checked:h.isExitPoint,onCheckedChange:e=>et("isExitPoint",!!e)}),(0,s.jsx)(N.J,{htmlFor:"isExitPoint",children:"Exit Point (Journey ends after this step)"})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-4 border-t border-gray-200",children:[(0,s.jsxs)(g.$,{variant:"destructive",onClick:ei,disabled:C,className:"flex items-center gap-1",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),C?"Deleting...":"Delete Step"]}),(0,s.jsxs)(g.$,{onClick:er,disabled:v,className:"flex items-center gap-1",children:[(0,s.jsx)(ey.A,{className:"h-4 w-4"}),v?"Saving...":"Save Changes"]})]})]}),V&&M&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Email Preview"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>W(!1),children:"Close"})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{className:"text-sm font-medium text-gray-700",children:"Subject"}),(0,s.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded border text-sm",children:M.subject})]}),(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex border-b",children:[(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium border-r ".concat("html"===z?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"),onClick:()=>B("html"),children:"HTML Preview"}),(0,s.jsx)("button",{className:"px-4 py-2 text-sm font-medium ".concat("text"===z?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"),onClick:()=>B("text"),children:"Text Version"})]}),"html"===z&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"border rounded bg-white min-h-[400px]",children:M.htmlContent?(0,s.jsx)("div",{className:"h-full",children:M.htmlContent.includes("<html>")||M.htmlContent.includes("<body>")?(0,s.jsx)("iframe",{srcDoc:M.htmlContent,className:"w-full h-[500px] border-0 rounded",title:"Email HTML Preview",style:{minHeight:"400px"}}):(0,s.jsx)("div",{className:"p-6 overflow-auto max-h-[500px]",children:(0,s.jsx)("div",{className:"prose prose-sm max-w-none leading-relaxed",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},dangerouslySetInnerHTML:{__html:M.htmlContent}})})}):M.textContent?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4 italic",children:"No HTML content available. Showing text content:"}),(0,s.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},children:M.textContent})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-[400px] text-gray-500 italic",children:"No HTML content available"})})}),"text"===z&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"border rounded bg-gray-50 min-h-[400px]",children:(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 leading-relaxed font-sans",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},children:M.textContent||"No text content available"})})})})]}),(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Sample Variables Used"}),(0,s.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"firstName:"})," John"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"lastName:"})," Doe"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"email:"})," john.doe@example.com"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"phone:"})," +1234567890"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"company:"})," Example Company"]})]})]})]})]})})]})};function ej(e){var t,a,n,T,k,E,I;let{params:_}=e,D=(0,i.useRouter)(),{isAuthenticated:q}=(0,S.n)(),L=parseInt(_.id,10),[R,J]=(0,r.useState)(null),[O,F]=(0,r.useState)([]),[P,M]=(0,r.useState)([]),[U,V]=(0,r.useState)(!0),[W,H]=(0,r.useState)("builder"),[$,z]=(0,r.useState)(!1),[B,Z]=(0,r.useState)(!1),[G,K]=(0,r.useState)(null),[X,Y]=(0,r.useState)(!1),[Q,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)({brands:[],sources:[],leadStatus:[],leadTags:[],leadAgeDays:{min:void 0,max:void 0}}),[es,er]=(0,r.useState)(""),[ei,en]=(0,r.useState)(""),[el,ed]=(0,r.useState)(""),[ec,eu]=(0,r.useState)(""),[em,ep]=(0,r.useState)(100),[ex,eh]=(0,r.useState)(!1),[eg,ey]=(0,r.useState)(null),[ev,ej]=(0,r.useState)({name:"",description:"",isActive:!0,autoEnroll:!0,leadStatus:[],leadTags:[]});(0,r.useEffect)(()=>{q&&L&&eN()},[q,L]),(0,r.useEffect)(()=>{Q&&L&&eb()},[Q,L,et]);let eb=async()=>{try{let e=await (0,A.ft)(L);ey(e)}catch(e){console.error("Error fetching matching stats:",e)}},eN=async()=>{try{V(!0);let e=await (0,A.Hx)(L);if(J(e),e.steps)F(e.steps);else{let e=await (0,A._l)(L);F(e)}let t=await (0,A.MF)(L,{limit:10});M(t.leads||[])}catch(e){console.error("Error fetching journey details:",e),d.Ay.error("Failed to load journey details")}finally{V(!1)}},ew=async()=>{if(R)try{await (0,A.Qf)(L,{isActive:!R.isActive}),d.Ay.success("Journey ".concat(R.isActive?"paused":"activated"," successfully")),eN()}catch(e){console.error("Error updating journey status:",e),d.Ay.error("Failed to update journey status")}},eC=async()=>{if(R)try{Y(!0),await (0,A.Qf)(R.id,{name:ev.name,description:ev.description,isActive:ev.isActive,triggerCriteria:{leadStatus:ev.leadStatus,leadTags:ev.leadTags,autoEnroll:ev.autoEnroll}}),d.Ay.success("Journey updated successfully"),z(!1),eN()}catch(e){console.error("Error updating journey:",e),d.Ay.error("Failed to update journey")}finally{Y(!1)}},eS=async()=>{if(R)try{Y(!0),await (0,A.sg)(R.id),d.Ay.success("Journey deleted successfully"),D.push("/journeys")}catch(e){console.error("Error deleting journey:",e),d.Ay.error("Failed to delete journey"),Y(!1),Z(!1)}},eA=()=>{var e;!es||(null===(e=et.brands)||void 0===e?void 0:e.includes(es))||(ea({...et,brands:[...et.brands||[],es]}),er(""))},eT=e=>{var t;ea({...et,brands:(null===(t=et.brands)||void 0===t?void 0:t.filter(t=>t!==e))||[]})},ek=()=>{var e;!ei||(null===(e=et.sources)||void 0===e?void 0:e.includes(ei))||(ea({...et,sources:[...et.sources||[],ei]}),en(""))},eE=e=>{var t;ea({...et,sources:(null===(t=et.sources)||void 0===t?void 0:t.filter(t=>t!==e))||[]})},eI=()=>{var e;!el||(null===(e=et.leadStatus)||void 0===e?void 0:e.includes(el))||(ea({...et,leadStatus:[...et.leadStatus||[],el]}),ed(""))},e_=e=>{var t;ea({...et,leadStatus:(null===(t=et.leadStatus)||void 0===t?void 0:t.filter(t=>t!==e))||[]})},eD=()=>{ea({brands:[],sources:[],leadStatus:[],leadTags:[],leadAgeDays:{min:void 0,max:void 0}}),er(""),en(""),ed(""),eu(""),ep(100),eh(!1)},eq=async()=>{try{Y(!0);let e=await (0,A.s5)(L,{criteria:et,restart:ex,limit:em});d.Ay.success("Successfully enrolled ".concat(e.enrolledCount," leads")),ee(!1),eD(),eN()}catch(e){console.error("Error enrolling leads:",e),d.Ay.error("Failed to enroll leads")}finally{Y(!1)}};return q&&R?(0,s.jsxs)(h.A,{children:[(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l(),{href:"/journeys",children:(0,s.jsx)(g.$,{variant:"ghost",className:"mr-4",children:(0,s.jsx)(o.A,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:R.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:R.description})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(g.$,{variant:"outline",onClick:()=>ee(!0),children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Bulk Enroll"]}),(0,s.jsx)(g.$,{variant:R.isActive?"outline":"default",onClick:ew,children:R.isActive?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Pause"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Activate"]})}),(0,s.jsxs)(g.$,{variant:"outline",onClick:()=>{R&&(ej({name:R.name,description:R.description,isActive:R.isActive,autoEnroll:R.triggerCriteria.autoEnroll,leadStatus:R.triggerCriteria.leadStatus||[],leadTags:R.triggerCriteria.leadTags||[]}),z(!0))},children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,s.jsxs)(g.$,{variant:"destructive",onClick:()=>Z(!0),children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),(0,s.jsxs)(C.tU,{value:W,onValueChange:H,className:"w-full mt-6",children:[(0,s.jsxs)(C.j7,{className:"grid w-full grid-cols-3",children:[(0,s.jsx)(C.Xi,{value:"builder",children:"Flow Builder"}),(0,s.jsx)(C.Xi,{value:"overview",children:"Overview"}),(0,s.jsx)(C.Xi,{value:"leads",children:"Leads"})]}),(0,s.jsx)(C.av,{value:"builder",className:"mt-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Journey Flow"}),(0,s.jsx)(eo,{journey:R,onJourneyUpdated:eN,onSelectStep:K,selectedStep:G})]})}),(0,s.jsx)("div",{children:G?(0,s.jsx)(ef,{step:G,journeyId:L,onStepUpdated:eN,onStepDeleted:()=>{eN(),K(null)}}):(0,s.jsxs)(v.Zp,{children:[(0,s.jsxs)(v.aR,{children:[(0,s.jsx)(v.ZB,{children:"Step Properties"}),(0,s.jsx)(v.BT,{children:"Select a step in the flow builder to edit its properties"})]}),(0,s.jsx)(v.Wu,{children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Click on any step in the flow to view and edit its properties. You can also add new steps using the + button in the flow builder."})})]})})]})}),(0,s.jsx)(C.av,{value:"overview",className:"mt-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)(v.Zp,{children:[(0,s.jsx)(v.aR,{className:"pb-2",children:(0,s.jsx)(v.ZB,{children:"Status"})}),(0,s.jsxs)(v.Wu,{children:[(0,s.jsx)(y.E,{variant:R.isActive?"default":"secondary",className:"text-sm",children:R.isActive?"Active":"Paused"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Last updated: ",new Date(R.updatedAt).toLocaleString()]})]})]}),(0,s.jsxs)(v.Zp,{children:[(0,s.jsx)(v.aR,{className:"pb-2",children:(0,s.jsx)(v.ZB,{children:"Leads"})}),(0,s.jsx)(v.Wu,{children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:R.activeLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Active"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:R.completedLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Completed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:R.failedLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Failed"})]})]})})]}),(0,s.jsxs)(v.Zp,{children:[(0,s.jsx)(v.aR,{className:"pb-2",children:(0,s.jsx)(v.ZB,{children:"Enrollment Criteria"})}),(0,s.jsx)(v.Wu,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Auto-enrollment:"}),(0,s.jsx)("p",{className:"text-sm",children:R.triggerCriteria.autoEnroll?"Enabled":"Disabled"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Lead Status:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:(null===(t=R.triggerCriteria.leadStatus)||void 0===t?void 0:t.length)?R.triggerCriteria.leadStatus.map(e=>(0,s.jsx)(y.E,{variant:"outline",className:"text-xs",children:e},e)):(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Any"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Lead Tags:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:(null===(a=R.triggerCriteria.leadTags)||void 0===a?void 0:a.length)?R.triggerCriteria.leadTags.map(e=>(0,s.jsx)(y.E,{variant:"outline",className:"text-xs",children:e},e)):(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Any"})})]})]})})]})]})}),(0,s.jsx)(C.av,{value:"leads",className:"mt-6",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Enrolled Leads"}),(0,s.jsx)(l(),{href:"/journeys/".concat(L,"/leads"),children:(0,s.jsxs)(g.$,{children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Manage Leads"]})})]})}),0===P.length?(0,s.jsxs)("div",{className:"p-6 text-center",children:[(0,s.jsx)("p",{className:"text-gray-500",children:U?"Loading leads...":"No leads enrolled in this journey"}),!U&&(0,s.jsx)(g.$,{variant:"outline",className:"mt-4",onClick:eN,children:"Retry Loading Leads"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lead"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Step"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Execution"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.Lead?(0,s.jsx)(l(),{href:"/leads/".concat(e.leadId),className:"hover:underline",children:e.Lead.name}):"Lead #".concat(e.leadId)}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:null===(t=e.Lead)||void 0===t?void 0:t.phone})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)(y.E,{variant:"active"===e.status?"default":"paused"===e.status?"secondary":"completed"===e.status?"outline":"destructive",className:"text-xs",children:e.status})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.currentStep?e.currentStep.name:"N/A"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.nextExecutionTime?new Date(e.nextExecutionTime).toLocaleString():"Not scheduled"})]},e.id)})})]})}),P.length>0&&(0,s.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,s.jsx)(l(),{href:"/journeys/".concat(L,"/leads"),className:"text-sm text-indigo-600 hover:text-indigo-900",children:"View all enrolled leads "})})]})})]})]}),(0,s.jsx)(f.lG,{open:$,onOpenChange:z,children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(f.c7,{children:(0,s.jsx)(f.L3,{children:"Edit Journey"})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{htmlFor:"edit-name",children:"Name"}),(0,s.jsx)(j.p,{id:"edit-name",value:ev.name,onChange:e=>ej({...ev,name:e.target.value}),placeholder:"Journey name"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{htmlFor:"edit-description",children:"Description"}),(0,s.jsx)(b.T,{id:"edit-description",value:ev.description,onChange:e=>ej({...ev,description:e.target.value}),placeholder:"Journey description"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsxs)(N.J,{htmlFor:"edit-isActive",className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",id:"edit-isActive",checked:ev.isActive,onChange:e=>ej({...ev,isActive:e.target.checked}),className:"form-checkbox h-4 w-4 text-indigo-600"}),"Active"]})}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsxs)(N.J,{htmlFor:"edit-autoEnroll",className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",id:"edit-autoEnroll",checked:ev.autoEnroll,onChange:e=>ej({...ev,autoEnroll:e.target.checked}),className:"form-checkbox h-4 w-4 text-indigo-600"}),"Auto-enroll matching leads"]})})]}),(0,s.jsxs)(f.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),(0,s.jsx)(g.$,{onClick:eC,disabled:!ev.name||X,children:X?"Updating...":"Update Journey"})]})]})}),(0,s.jsx)(f.lG,{open:B,onOpenChange:Z,children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(f.c7,{children:(0,s.jsx)(f.L3,{children:"Delete Journey"})}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("p",{className:"text-gray-500",children:['Are you sure you want to delete the journey "',null==R?void 0:R.name,'"? This action cannot be undone.']})}),(0,s.jsxs)(f.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),(0,s.jsx)(g.$,{variant:"destructive",onClick:eS,disabled:X,children:X?"Deleting...":"Delete Journey"})]})]})}),(0,s.jsx)(f.lG,{open:Q,onOpenChange:ee,children:(0,s.jsxs)(f.Cf,{className:"sm:max-w-lg",children:[(0,s.jsx)(f.c7,{children:(0,s.jsx)(f.L3,{children:"Bulk Enroll Leads"})}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Enroll leads that match the specified criteria in this journey."}),eg&&(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md mb-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Matching Statistics"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[eg.matchingLeads," out of ",eg.totalLeads," leads match the current journey criteria"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Age Criteria (Days)"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"bulk-minAge",className:"text-xs",children:"Minimum Age"}),(0,s.jsx)(j.p,{id:"bulk-minAge",type:"number",value:(null===(n=et.leadAgeDays)||void 0===n?void 0:n.min)!==void 0?et.leadAgeDays.min:"",onChange:e=>{let t=e.target.value?parseInt(e.target.value,10):void 0;ea({...et,leadAgeDays:{...et.leadAgeDays,min:t}})},placeholder:"Min days",min:0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"bulk-maxAge",className:"text-xs",children:"Maximum Age"}),(0,s.jsx)(j.p,{id:"bulk-maxAge",type:"number",value:(null===(T=et.leadAgeDays)||void 0===T?void 0:T.max)!==void 0?et.leadAgeDays.max:"",onChange:e=>{let t=e.target.value?parseInt(e.target.value,10):void 0;ea({...et,leadAgeDays:{...et.leadAgeDays,max:t}})},placeholder:"Max days",min:0})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Brands"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(j.p,{value:es,onChange:e=>er(e.target.value),placeholder:"Add brand",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),eA())}),(0,s.jsx)(g.$,{type:"button",onClick:eA,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:null===(k=et.brands)||void 0===k?void 0:k.map(e=>(0,s.jsxs)(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>eT(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Sources"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(j.p,{value:ei,onChange:e=>en(e.target.value),placeholder:"Add source",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),ek())}),(0,s.jsx)(g.$,{type:"button",onClick:ek,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:null===(E=et.sources)||void 0===E?void 0:E.map(e=>(0,s.jsxs)(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>eE(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Status"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(j.p,{value:el,onChange:e=>ed(e.target.value),placeholder:"Add status",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),eI())}),(0,s.jsx)(g.$,{type:"button",onClick:eI,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:null===(I=et.leadStatus)||void 0===I?void 0:I.map(e=>(0,s.jsxs)(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>e_(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Max Leads to Enroll"}),(0,s.jsx)(j.p,{type:"number",value:em,onChange:e=>ep(parseInt(e.target.value,10)||100),min:1,max:500}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Maximum number of leads to enroll in one operation (1-500)"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"restart-enrollment",checked:ex,onCheckedChange:e=>eh(e)}),(0,s.jsx)(N.J,{htmlFor:"restart-enrollment",children:"Restart for leads already in journey"})]})]})]}),(0,s.jsxs)(f.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>{ee(!1),eD()},children:"Cancel"}),(0,s.jsx)(g.$,{onClick:eq,disabled:X,children:X?"Enrolling...":"Enroll Leads"})]})]})})]}):(0,s.jsx)(h.A,{children:(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)(l(),{href:"/journeys",children:(0,s.jsx)(g.$,{variant:"ghost",className:"mr-4",children:(0,s.jsx)(o.A,{className:"h-5 w-5"})})}),(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:U?"Loading journey...":"Journey not found"})]}),U&&(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand"})})]})})}},60477:(e,t,a)=>{"use strict";a.d(t,{J:()=>l});var s=a(95155),r=a(12115),i=a(46195),n=a(67910);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.b,{ref:t,className:(0,n.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",a),...r})});l.displayName=i.b.displayName},60541:(e,t,a)=>{Promise.resolve().then(a.bind(a,48353))},63669:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>o,av:()=>c,j7:()=>d,tU:()=>l});var s=a(95155),r=a(12115),i=a(98217),n=a(67910);let l=i.bL,d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});d.displayName=i.B8.displayName;let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});o.displayName=i.l9.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})});c.displayName=i.UC.displayName},97754:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var s=a(95155);a(12115);var r=a(31027),i=a(12558);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)(n({variant:a}),t),...r})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1294,8702,9272,2376,6514,5037,7295,6870,9499,8217,814,8822,8821,2199,1169,1485,2958,8441,6587,7358],()=>t(60541)),_N_E=e.O()}]);