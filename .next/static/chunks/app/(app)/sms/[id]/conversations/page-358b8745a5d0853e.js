(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2146],{6169:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var n=s(95155),a=s(12115),i=s(76046),r=s(55037),l=s(87364),o=s(99271),c=s(61594);let d=(0,s(67401).A)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);var u=s(63348),h=s(73239),p=s(28283),m=s(1169),x=s(19393),f=s(43031),y=s(69205),g=s(85725),v=s(73746);function j(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{isAuthenticated:s}=(0,v.n)(),j=parseInt(e.id),[b,N]=(0,a.useState)([]),[w,k]=(0,a.useState)([]),[S,C]=(0,a.useState)(null),[A,$]=(0,a.useState)([]),[E,M]=(0,a.useState)(""),[L,R]=(0,a.useState)(""),[z,U]=(0,a.useState)(!0),[T,P]=(0,a.useState)(!1),[F,_]=(0,a.useState)(!1),[B,I]=(0,a.useState)(!1),[D,H]=(0,a.useState)(!1),[O,W]=(0,a.useState)(""),[V,Z]=(0,a.useState)(!1),[q,J]=(0,a.useState)(!1),[Q,G]=(0,a.useState)(!1),[K,X]=(0,a.useState)([]),Y=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!s){t.push("/login");return}ee()},[s,t,j]),(0,a.useEffect)(()=>{V?et():ee()},[V,j]),(0,a.useEffect)(()=>{S&&es(S.id)},[S]),(0,a.useEffect)(()=>{let e=e=>{Y.current&&!Y.current.contains(e.target)&&J(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let ee=async()=>{U(!0);try{var e;let t=await (0,g.au)(j,{limit:200});N((null===(e=t.contacts)||void 0===e?void 0:e.map(e=>({...e,isUnresponded:!1})))||[])}catch(e){console.error("Error fetching contacts:",e),r.Ay.error("Failed to load contacts")}finally{U(!1)}},et=async()=>{U(!0);try{var e;let t=await (0,g.wV)({campaignId:j}),s=(null===(e=t.unrespondedContacts)||void 0===e?void 0:e.map(e=>({...e,id:e.id||e.contactId,isUnresponded:!0,lastMessage:e.lastMessage||{content:"Unresponded inbound message",direction:"inbound"}})))||[];k(s)}catch(e){console.error("Error fetching unresponded messages:",e),r.Ay.error("Failed to load unresponded messages")}finally{U(!1)}},es=async e=>{P(!0);try{let t=await (0,g.Ag)(e);$(t.messages||[]);let s=(V?w:b).map(t=>t.id===e?{...t,unreadCount:0,isUnresponded:!1}:t);V?k(s):N(s)}catch(e){console.error("Error fetching conversation:",e),r.Ay.error("Failed to load conversation")}finally{P(!1)}},en=async e=>{if(e.preventDefault(),S&&E.trim()){_(!0);try{let e=await (0,g.a6)(S.id,E);$(t=>[...t,e.sentMessage]),M(""),r.Ay.success("Message sent successfully"),S.isUnresponded&&et()}catch(e){console.error("Error sending message:",e),r.Ay.error("Failed to send message")}finally{_(!1)}}},ea=async e=>{if(e){I(!0);try{await (0,g.MH)([e]),r.Ay.success("Conversation marked as resolved."),et(),(null==S?void 0:S.id)===e&&C(e=>e?{...e,isUnresponded:!1}:null)}catch(e){console.error("Error marking as resolved:",e),r.Ay.error("Failed to mark as resolved.")}finally{I(!1)}}},ei=e=>{X(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},er=async e=>{if(e.preventDefault(),0===K.length||!L.trim()){r.Ay.error("Please select contacts and enter a message for bulk reply.");return}H(!0);try{await (0,g.JI)({contactIds:K,message:L}),r.Ay.success("Bulk reply sent to ".concat(K.length," contacts.")),R(""),X([]),G(!1),et()}catch(e){console.error("Error sending bulk reply:",e),r.Ay.error("Failed to send bulk reply.")}finally{H(!1)}},el=e=>e?new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",eo=(V?w:b).filter(e=>{var t,s,n,a;let i=O.toLowerCase();return e.phone.toLowerCase().includes(i)||null!==(n=null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(i))&&void 0!==n&&n||null!==(a=null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(i))&&void 0!==a&&a}),ec=(e,t)=>{"newMessage"===t?M(t=>t+e.emoji):R(t=>t+e.emoji)};return s?(0,n.jsx)(m.A,{children:(0,n.jsxs)("div",{className:"py-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(x.$,{variant:"ghost",onClick:()=>t.back(),className:"mr-4",children:(0,n.jsx)(l.A,{className:"w-4 h-4"})}),(0,n.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"SMS Conversations"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[V&&K.length>0&&(0,n.jsxs)(x.$,{onClick:()=>G(!0),variant:"outline",children:[(0,n.jsx)(o.A,{className:"w-4 h-4 mr-2"}),"Bulk Reply (",K.length,")"]}),(0,n.jsxs)(x.$,{variant:V?"brand":"secondary",onClick:()=>Z(!V),className:"flex items-center",children:[(0,n.jsx)(c.A,{className:"w-4 h-4 mr-2"}),V?"Show All (".concat(b.length,")"):"Show Unreplied (".concat(w.length,")")]})]})]}),Q&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Send Bulk Reply"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["To: ",K.length," selected contacts."]}),(0,n.jsxs)("form",{onSubmit:er,children:[(0,n.jsxs)("div",{className:"relative mb-4",children:[(0,n.jsx)("textarea",{value:L,onChange:e=>R(e.target.value),placeholder:"Type your bulk reply message...",rows:4,className:"w-full p-2 border rounded-md pr-10 focus:ring-brand focus:border-brand"}),(0,n.jsx)(x.$,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-2",onClick:e=>{e.stopPropagation(),J(e=>!e)},children:(0,n.jsx)(d,{className:"w-5 h-5 text-gray-500"})}),q&&(0,n.jsx)("div",{ref:Y,className:"absolute mt-1 z-20",children:(0,n.jsx)(y.Ay,{onEmojiClick:e=>ec(e,"bulkReplyMessage"),width:300,height:350})})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,n.jsx)(x.$,{type:"button",variant:"secondary",onClick:()=>{G(!1),J(!1)},children:"Cancel"}),(0,n.jsx)(x.$,{type:"submit",variant:"brand",isLoading:D,disabled:!L.trim()||D,children:"Send Bulk Reply"})]})]})]})}),(0,n.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,n.jsxs)("div",{className:"col-span-4 bg-white shadow rounded-lg",children:[(0,n.jsx)("div",{className:"p-4 border-b",children:(0,n.jsx)(f.p,{type:"text",placeholder:"Search contacts...",value:O,onChange:e=>W(e.target.value),className:"w-full"})}),(0,n.jsxs)("div",{className:"divide-y divide-gray-200 max-h-[calc(100vh-260px)] overflow-y-auto",children:[z?(0,n.jsx)("p",{className:"p-4 text-center text-gray-500",children:"Loading contacts..."}):eo.map(e=>(0,n.jsxs)("div",{className:"flex items-center p-4 hover:bg-gray-50 ".concat((null==S?void 0:S.id)===e.id?"bg-gray-100":""),children:[V&&(0,n.jsx)("input",{type:"checkbox",checked:K.includes(e.id),onChange:()=>ei(e.id),className:"h-4 w-4 text-brand focus:ring-brand border-gray-300 rounded mr-3 flex-shrink-0"}),(0,n.jsxs)("button",{onClick:()=>C(e),className:"w-full text-left flex items-center",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(u.A,{className:"h-6 w-6 ".concat(e.isUnresponded?"text-red-500":"text-gray-400")})}),(0,n.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name||e.phone||"Unknown"}),"number"==typeof e.unreadCount&&e.unreadCount>0&&!S&&(0,n.jsx)("span",{className:"bg-red-100 text-red-800 text-xs font-medium px-2 py-0.5 rounded-full",children:e.unreadCount})]}),(0,n.jsx)("p",{className:"text-sm text-gray-500 truncate",children:e.phone}),e.lastMessage&&(0,n.jsx)("p",{className:"text-xs mt-1 truncate ".concat(e.isUnresponded?"text-red-600 font-semibold":"text-gray-500"),children:e.lastMessage.content})]})]})]},e.id)),!z&&0===eo.length&&(0,n.jsx)("p",{className:"p-4 text-center text-gray-500",children:"No contacts found."})]})]}),(0,n.jsx)("div",{className:"col-span-8 bg-white shadow rounded-lg flex flex-col",children:S?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:S.name||"Unknown"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:S.phone})]}),S.isUnresponded&&(0,n.jsxs)(x.$,{variant:"outline",size:"sm",onClick:()=>ea(S.id),isLoading:B,disabled:B,children:[(0,n.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"Mark as Resolved"]})]}),T?(0,n.jsx)("p",{className:"p-4 text-center text-gray-500",children:"Loading conversation..."}):(0,n.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto max-h-[calc(100vh-400px)] space-y-4",children:[A.map(e=>(0,n.jsx)("div",{className:"flex ".concat("outbound"===e.direction?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[70%] rounded-lg px-4 py-2 shadow-sm ".concat("outbound"===e.direction?"bg-brand text-white":"bg-gray-100 text-gray-900"),children:[(0,n.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,n.jsx)("p",{className:"text-xs opacity-75",children:el(e.sentAt)}),"outbound"===e.direction&&(0,n.jsxs)("span",{className:"text-xs ml-2 ".concat("failed"===e.status?"text-red-300":"opacity-75"),children:["sent"===e.status&&"✓","delivered"===e.status&&"✓✓","read"===e.status&&(0,n.jsx)(h.A,{className:"inline w-3 h-3 text-blue-300"}),"failed"===e.status&&"✕"]})]})]})},e.id)),0===A.length&&(0,n.jsx)("p",{className:"text-center text-gray-500",children:"No messages yet."})]}),(0,n.jsx)("div",{className:"p-4 border-t",children:(0,n.jsxs)("form",{onSubmit:en,className:"flex space-x-3 items-center",children:[(0,n.jsxs)("div",{className:"relative flex-1",children:[(0,n.jsx)(f.p,{type:"text",value:E,onChange:e=>M(e.target.value),placeholder:"Type your message...",className:"w-full pr-10 py-2"}),(0,n.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2",onClick:e=>{e.stopPropagation(),J(e=>!e)},children:(0,n.jsx)(d,{className:"w-5 h-5 text-gray-500"})}),q&&!Q&&(0,n.jsx)("div",{ref:Y,className:"absolute bottom-full right-0 mb-2 z-10",children:(0,n.jsx)(y.Ay,{onEmojiClick:e=>ec(e,"newMessage"),width:300,height:350})})]}),(0,n.jsx)(x.$,{type:"submit",variant:"brand",disabled:!E.trim()||F,isLoading:F,size:"icon",className:"p-2",children:(0,n.jsx)(p.A,{className:"w-5 h-5"})})]})})]}):(0,n.jsx)("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:(0,n.jsx)("p",{children:"Select a contact to view conversation."})})})]})]})}):null}},12558:(e,t,s)=>{"use strict";s.d(t,{cn:()=>i});var n=s(43463),a=s(69795);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.QP)((0,n.$)(t))}},28283:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(67401).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},43031:(e,t,s)=>{"use strict";s.d(t,{p:()=>r});var n=s(95155),a=s(12115),i=s(12558);let r=a.forwardRef((e,t)=>{let{className:s,type:a,label:r,error:l,...o}=e;return(0,n.jsxs)("div",{className:"w-full",children:[r&&(0,n.jsx)("label",{htmlFor:o.id,className:"block text-sm font-medium text-gray-700 mb-1",children:r}),(0,n.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l?"border-red-500 focus-visible:ring-red-500":"",s),ref:t,...o}),l&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:l})]})});r.displayName="Input"},43522:(e,t,s)=>{Promise.resolve().then(s.bind(s,6169))},54249:(e,t,s)=>{"use strict";function n(e){return[].concat(e)}function a(e){return e.startsWith(":")}function i(e){return o(e)&&("*"===e||e.length>1&&":>~.+*".includes(e.slice(0,1))||c(e))}function r(e,t){return(o(t)||"number"==typeof t)&&"--"!==e&&!a(e)&&!l(e)}function l(e){return e.startsWith("@media")}s.d(t,{_:()=>y,cx:()=>function e(...t){return d(t.reduce((t,s)=>(s instanceof Set?t.push(...s):"string"==typeof s?t.push(s):Array.isArray(s)?t.push(e(...s)):"object"==typeof s&&Object.entries(s).forEach(([e,s])=>{s&&t.push(e)}),t),[])," ").trim()}});function o(e){return e+""===e}function c(e){return o(e)&&(e.startsWith("&")||a(e))}function d(e,t=""){return e.filter(Boolean).join(t)}function u(e,t){let s=0;if(0===t.length)return s.toString();for(let e=0;e<t.length;e++)s=(s<<5)-s+t.charCodeAt(e),s&=s;return`${e??"cl"}_${s.toString(36)}`}var h=class e{constructor(e,t,s,n){this.sheet=e,this.property=t,this.value=s,this.selector=n,this.property=t,this.value=s,this.joined=`${t}:${s}`;let a=this.selector.preconditions.concat(this.selector.postconditions);this.hash=this.selector.hasConditions?this.selector.scopeClassName:u(this.sheet.name,this.joined),this.key=d([this.joined,a,this.hash])}toString(){let t=p(this.selector.preconditions,{right:this.hash});return t=p(this.selector.postconditions,{left:t}),`${t} {${e.genRule(this.property,this.value)}}`}static genRule(e,t){var s,n;return s=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n="content"===e?`"${t}"`:t,`${s}:${n};`}};function p(e,{left:t="",right:s=""}={}){let n=e.reduce((e,t)=>a(t)?e+t:c(t)?e+t.slice(1):d([e,t]," "),t);return d([n,s?`.${s}`:""]," ")}var m=class e{constructor(e,t=null,{preconditions:s,postconditions:a}={}){this.sheet=e,this.preconditions=[],this.scopeClassName=null,this.scopeName=null,this.postconditions=[],this.preconditions=s?n(s):[],this.postconditions=a?n(a):[],this.setScope(t)}setScope(e){return e&&(this.scopeClassName||(this.scopeName=e,this.scopeClassName=u(this.sheet.name,e+this.sheet.count))),this}get hasConditions(){return this.preconditions.length>0||this.postconditions.length>0}addScope(t){return new e(this.sheet,t,{preconditions:this.preconditions,postconditions:this.postconditions})}addPrecondition(t){return new e(this.sheet,this.scopeClassName,{postconditions:this.postconditions,preconditions:this.preconditions.concat(t)})}addPostcondition(t){return new e(this.sheet,this.scopeClassName,{preconditions:this.preconditions,postconditions:this.postconditions.concat(t)})}createRule(e,t){return new h(this.sheet,e,t,this)}},x=class{constructor(e,t){this.name=e,this.rootNode=t,this.storedStyles={},this.storedClasses={},this.style="",this.count=0,this.id=`flairup-${e}`,this.styleTag=this.createStyleTag()}getStyle(){return this.style}append(e){var t;this.style=(t=this.style)?`${t}
${e}`:e}apply(){this.count++,this.styleTag&&(this.styleTag.innerHTML=this.style)}isApplied(){return!!this.styleTag}createStyleTag(){if("undefined"==typeof document||this.isApplied()||null===this.rootNode)return this.styleTag;let e=document.createElement("style");return e.type="text/css",e.id=this.id,(this.rootNode??document.head).appendChild(e),e}addRule(e){let t=this.storedClasses[e.key];return o(t)?t:(this.storedClasses[e.key]=e.hash,this.storedStyles[e.hash]=[e.property,e.value],this.append(e.toString()),e.hash)}};function f(e,t){for(let s in e)t(s.trim(),e[s])}function y(e,t){let s=new x(e,t);return{create:function(e){let t={};return(function e(t,s,n){let a=[];return f(s,(r,l)=>{if(i(r))return e(t,l,n.addPrecondition(r)).forEach(e=>a.push(e));a.push([r,s[r],n.addScope(r)])}),a})(s,e,new m(s)).forEach(([e,a,o])=>{(function e(t,s,a){let o=new Set;return f(s,(s,c)=>{let d=[];if(i(s))d=e(t,c,a.addPostcondition(s));else if("."===s)d=n(c);else if(l(s))d=function(t,s,n,a){t.append(n+" {");let i=e(t,s,a);return t.append("}"),i}(t,c,s,a);else if("--"===s)d=function(t,s,n){let a=new Set,i=[];if(f(s,(s,l)=>{if(r(s,l)){i.push(h.genRule(s,l));return}g(e(t,l??{},n),a)}),!n.scopeClassName)return a;if(i.length){let e=i.join(" ");t.append(`${p(n.preconditions,{right:n.scopeClassName})} {${e}}`)}return a.add(n.scopeClassName),a}(t,c,a);else if(r(s,c)){let e=a.createRule(s,c);t.addRule(e),o.add(e.hash)}return g(d,o)}),o})(s,a,o).forEach(s=>{var n,a;n=e,a=s,t[n]=t[n]??new Set,t[n].add(a)})}),s.apply(),t},getStyle:s.getStyle.bind(s),isApplied:s.isApplied.bind(s)}}function g(e,t){return e.forEach(e=>t.add(e)),t}},63348:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(67401).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},87364:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(67401).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},99271:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(67401).A)("message-circle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[2666,9272,2376,6514,5037,1169,1485,8441,6587,7358],()=>t(43522)),_N_E=e.O()}]);