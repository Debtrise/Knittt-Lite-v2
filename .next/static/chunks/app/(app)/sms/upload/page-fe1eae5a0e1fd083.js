(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5219],{23470:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>b});var t=r(95155),a=r(12115),l=r(76046),i=r(55037),n=r(87364),o=r(23950),c=r(67401);let d=(0,c.A)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);var m=r(40767);let u=(0,c.A)("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var p=r(98867),h=r(1169),x=r(19393),g=r(73746),f=r(85725);let y=e=>{let{headers:s,recommendedMappings:r,fieldMapping:a,setFieldMapping:l}=e,i=(e,s)=>{l(r=>({...r,[e]:s}))};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-md font-medium text-gray-700",children:"Map CSV Headers to System Fields:"}),(0,t.jsx)("div",{className:"text-xs text-red-500 font-medium",children:"* Required field"})]}),[{id:"phone",label:"Phone Number",required:!0},{id:"name",label:"Contact Name",required:!1},{id:"email",label:"Email Address",required:!1}].map(e=>(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 items-center",children:[(0,t.jsxs)("label",{htmlFor:"map-".concat(e.id),className:"block text-sm font-medium ".concat(e.required?"text-gray-800":"text-gray-700"," capitalize"),children:[e.label," ",e.required&&(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsxs)("select",{id:"map-".concat(e.id),value:a[e.id]||"",onChange:s=>i(e.id,s.target.value),className:"block w-full pl-3 pr-10 py-2 text-base border ".concat(e.required&&!a[e.id]?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-brand focus:border-brand"," rounded-md"),required:e.required,children:[(0,t.jsx)("option",{value:"",children:"-- Select CSV Header --"}),s.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),e.required&&!a[e.id]&&(0,t.jsx)("p",{className:"mt-1 text-xs text-red-500",children:"This field is required for importing contacts"})]})]},e.id)),(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,t.jsx)("p",{className:"text-sm text-blue-800",children:(0,t.jsx)("strong",{children:"Field Mapping Instructions:"})}),(0,t.jsxs)("ul",{className:"mt-2 text-xs text-blue-700 list-disc pl-5 space-y-1",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Phone Number"})," is required and must be mapped to a CSV column containing valid phone numbers."]}),(0,t.jsx)("li",{children:"Name and Email are optional but recommended for better contact management."}),(0,t.jsx)("li",{children:"Any unmapped CSV columns will be imported as custom fields."}),(0,t.jsx)("li",{children:"Make sure your CSV headers match the expected format to ensure proper importing."})]})]})]})};function b(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{children:"Loading..."}),children:(0,t.jsx)(v,{})})}function v(){let e=(0,l.useRouter)(),s=(0,l.useSearchParams)(),{isAuthenticated:r}=(0,g.n)(),[c,b]=(0,a.useState)(null),[v,j]=(0,a.useState)(null),[N,w]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),[k,A]=(0,a.useState)({}),[P,q]=(0,a.useState)(""),[M,F]=(0,a.useState)([]),[V,E]=(0,a.useState)(null),[L,I]=(0,a.useState)(null),z=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!r){e.push("/login");return}let t=s.get("campaignId");(async()=>{try{let e=await (0,f.tw)({limit:1e3});if(F(e.campaigns||[]),t){q(t);try{let e=await (0,f.mI)(parseInt(t,10));I(e)}catch(e){console.error("Error fetching campaign details:",e)}}E(!0)}catch(e){console.error("Error fetching campaigns:",e),i.Ay.error("Failed to load campaigns for selection."),E(!1)}})()},[r,e,s]);let R=async()=>{if(!c){i.Ay.error("Please select a CSV file first.");return}w(!0),j(null),A({});let e=new FormData;e.append("file",c);try{let s=await (0,f.nz)(e);j(s);let r=s.recommendedMappings?{...s.recommendedMappings}:{};if(!r.phone&&s.headers){let e=s.headers.filter(e=>e.toLowerCase().includes("phone")||e.toLowerCase().includes("mobile")||e.toLowerCase().includes("cell")||"number"===e.toLowerCase()||"tel"===e.toLowerCase());e.length>0&&(r.phone=e[0])}if(!r.name&&s.headers){let e=s.headers.filter(e=>e.toLowerCase().includes("name")||"fullname"===e.toLowerCase()||"contact"===e.toLowerCase()||"customer"===e.toLowerCase());e.length>0&&(r.name=e[0])}if(!r.email&&s.headers){let e=s.headers.filter(e=>e.toLowerCase().includes("email")||e.toLowerCase().includes("mail")||"e-mail"===e.toLowerCase());e.length>0&&(r.email=e[0])}A(r),r.phone?i.Ay.success("CSV preview loaded successfully with auto-mapped fields."):i.Ay.success("CSV preview loaded. Please map the required Phone Number field."),E(!0)}catch(s){console.error("Error previewing CSV:",s);let e=s.message||"Failed to preview CSV. Please check the file format.";i.Ay.error(e),("Network Error"===s.message||e.includes("Network connection failed"))&&(E(!1),i.Ay.error("API server might be unreachable. Please try again later or contact support.",{duration:5e3}))}finally{w(!1)}},O=async()=>{var s,r,t;if(!c||!v){i.Ay.error("Please select a file and preview it first.");return}if(!k.phone||""===k.phone.trim()){i.Ay.error("Phone Number field mapping is required. Please select a column for phone numbers."),null===(s=document.querySelector("#map-phone"))||void 0===s||s.scrollIntoView({behavior:"smooth",block:"center"});return}let a=Object.values(k).filter(Boolean),l=new Set(a);if(a.length!==l.size){i.Ay.error("You have mapped multiple fields to the same CSV column. Please use each column only once.");return}S(!0);let n=new FormData;n.append("file",c);let o=P?parseInt(P,10):void 0;console.log("Importing with mapping:",k),console.log("Field mapping:",k),console.log("File name:",c.name),console.log("File size:",c.size);try{let s=await (0,f.v0)(n,k,o);E(!0),i.Ay.success(s.message||"Contacts imported successfully!"),b(null),j(null),A({}),q(""),z.current&&(z.current.value=""),o?e.push("/sms/".concat(o,"/settings")):e.push("/sms")}catch(e){if(console.error("Error importing contacts:",e),"ECONNABORTED"===e.code)E(!1),i.Ay.error("Connection timeout. The server took too long to respond.");else if("Network Error"===e.message)E(!1),i.Ay.error("Network connection failed. Please check your internet connection or try again later.");else if(e.response){console.error("Server error data:",e.response.data),console.error("Server error status:",e.response.status),console.error("Server error headers:",e.response.headers);let s=(null===(r=e.response.data)||void 0===r?void 0:r.error)||(null===(t=e.response.data)||void 0===t?void 0:t.message)||"Server error (".concat(e.response.status,"): Please check your data and try again.");i.Ay.error(s)}else if(e.request)console.error("No response received:",e.request),i.Ay.error("No response received from the server. Please try again later.");else{let s=e.message||"Failed to import contacts. Please check console for details.";i.Ay.error(s)}}finally{S(!1)}};return(0,t.jsx)(h.A,{children:(0,t.jsxs)("div",{className:"py-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.$,{variant:"ghost",onClick:()=>e.back(),className:"mr-4",children:(0,t.jsx)(n.A,{className:"w-4 h-4"})}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:L?"Upload Contacts for: ".concat(L.name):"Upload & Import Contacts"})]}),L&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Campaign Status: ",(0,t.jsx)("span",{className:"font-medium ".concat("active"===L.status?"text-green-600":"text-yellow-600"),children:L.status})]})]}),!1===V&&(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(o.A,{className:"h-5 w-5 text-yellow-400"}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Connection Warning"}),(0,t.jsx)("p",{className:"text-sm text-yellow-700",children:"We're having trouble connecting to the server. Some features might be temporarily unavailable. You can still prepare your CSV file and try uploading again shortly."})]})]})}),(0,t.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,t.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:(0,t.jsxs)("div",{className:"space-y-1 text-center",children:[(0,t.jsx)(d,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,t.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,t.jsxs)("label",{htmlFor:"file-upload-input",className:"relative cursor-pointer bg-white rounded-md font-medium text-brand hover:text-brand-dark focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-brand",children:[(0,t.jsx)("span",{children:"Upload a file"}),(0,t.jsx)("input",{id:"file-upload-input",name:"file-upload",type:"file",className:"sr-only",accept:".csv",onChange:e=>{var s;let r=null===(s=e.target.files)||void 0===s?void 0:s[0];r&&(b(r),j(null),A({}))},ref:z})]}),(0,t.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"CSV up to 10MB"})]})}),c&&(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-700 truncate",children:["Selected: ",c.name]}),(0,t.jsx)(x.$,{variant:"ghost",size:"sm",onClick:()=>{b(null),j(null),z.current&&(z.current.value="")},children:(0,t.jsx)(m.A,{className:"w-4 h-4 text-red-500"})})]}),(0,t.jsxs)(x.$,{onClick:R,disabled:!c||N,isLoading:N,className:"mt-4 w-full",variant:"secondary",children:[(0,t.jsx)(u,{className:"w-4 h-4 mr-2"}),"Preview CSV & Configure Mapping"]})]}),v&&(0,t.jsxs)("div",{className:"border-t pt-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"CSV Preview & Field Mapping"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-medium text-red-600",children:"Field mapping is required"})," to correctly import your contacts. At minimum, you must map the ",(0,t.jsx)("span",{className:"font-medium",children:"Phone Number"})," field."]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Estimated Total Rows: ",v.totalRowsEstimate||"N/A"]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsx)("tr",{children:v.headers.map(e=>(0,t.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e},e))})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.previewRows.map((e,s)=>(0,t.jsx)("tr",{children:v.headers.map(r=>(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e[r]},"".concat(s,"-").concat(r)))},s))})]})}),(0,t.jsx)(y,{headers:v.headers,recommendedMappings:v.recommendedMappings,fieldMapping:k,setFieldMapping:A}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"campaign-select",className:"block text-sm font-medium text-gray-700",children:L?"Selected Campaign":"Assign to Campaign (Optional)"}),(0,t.jsxs)("select",{id:"campaign-select",value:P,onChange:e=>q(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md",disabled:!!L,children:[!L&&(0,t.jsx)("option",{value:"",children:"-- Assign Later or Use Default --"}),M.map(e=>(0,t.jsx)("option",{value:e.id.toString(),children:e.name},e.id))]}),(0,t.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:L?"Contacts will be uploaded to the selected campaign.":"If no campaign is selected, contacts might be assigned to a default campaign or held for later assignment, depending on backend configuration."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(x.$,{onClick:O,disabled:C||!k.phone,isLoading:C,className:"w-full",variant:"brand",children:[(0,t.jsx)(p.A,{className:"w-4 h-4 mr-2"}),C?"Importing...":"Import Contacts"]}),!k.phone&&(0,t.jsx)("p",{className:"text-center text-sm text-red-500",children:"Phone Number field mapping is required to import contacts"})]})]})]})]})})}},78337:(e,s,r)=>{Promise.resolve().then(r.bind(r,23470))},87364:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(67401).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},98867:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(67401).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[9272,2376,6514,5037,1169,1485,8441,6587,7358],()=>s(78337)),_N_E=e.O()}]);