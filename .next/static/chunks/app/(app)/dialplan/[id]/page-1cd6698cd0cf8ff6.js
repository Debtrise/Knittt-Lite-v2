(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6729],{4169:(e,t,n)=>{Promise.resolve().then(n.bind(n,98787))},12558:(e,t,n)=>{"use strict";n.d(t,{cn:()=>r});var a=n(43463),o=n(69795);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.QP)((0,a.$)(t))}},33473:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(67401).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},43031:(e,t,n)=>{"use strict";n.d(t,{p:()=>s});var a=n(95155),o=n(12115),r=n(12558);let s=o.forwardRef((e,t)=>{let{className:n,type:o,label:s,error:i,...d}=e;return(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{htmlFor:d.id,className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsx)("input",{type:o,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i?"border-red-500 focus-visible:ring-red-500":"",n),ref:t,...d}),i&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i})]})});s.displayName="Input"},66798:(e,t,n)=>{"use strict";n.d(t,{AC:()=>g,BL:()=>d,ES:()=>r,OK:()=>m,RM:()=>p,U$:()=>v,YE:()=>h,aN:()=>f,ac:()=>o,cV:()=>w,g5:()=>y,gA:()=>s,ht:()=>l,mJ:()=>u,q6:()=>c,tq:()=>x,v:()=>b,xx:()=>i});var a=n(85725);let o=async()=>(await a.Ay.get("/dialplan/projects")).data,r=async e=>(await a.Ay.get("/dialplan/projects/".concat(e))).data,s=async e=>(await a.Ay.post("/dialplan/projects",e)).data,i=async e=>(await a.Ay.delete("/dialplan/projects/".concat(e))).data,d=async(e,t)=>(await a.Ay.post("/dialplan/projects/".concat(e,"/clone"),{newName:t})).data,l=async e=>(await a.Ay.get("/dialplan/projects/".concat(e,"/contexts"))).data,c=async(e,t)=>(await a.Ay.post("/dialplan/projects/".concat(e,"/contexts"),t)).data,u=async e=>(await a.Ay.get("/dialplan/contexts/".concat(e,"/nodes"))).data,p=async(e,t)=>{try{console.log("Creating node with data:",{contextId:e,data:t});let n=await a.Ay.post("/dialplan/contexts/".concat(e,"/nodes"),t);return console.log("Node creation successful:",n.data),n.data}catch(e){var n;throw console.error("Node creation failed:",(null===(n=e.response)||void 0===n?void 0:n.data)||e.message||e),e}},m=async(e,t)=>(await a.Ay.put("/dialplan/nodes/".concat(e),t)).data,g=async e=>{var t,n;try{if(console.log("Deleting node with ID:",e),!e||isNaN(e))throw Error("Invalid node ID");try{let t=await a.Ay.delete("/dialplan/nodes/".concat(e));return console.log("Node deletion successful:",t.data),t.data}catch(n){if((null===(t=n.response)||void 0===t?void 0:t.status)===404){console.warn("Standard delete endpoint not found, trying alternate endpoint...");let t=await a.Ay.post("/dialplan/nodes/delete",{id:e});return console.log("Node deletion successful with fallback:",t.data),t.data}throw n}}catch(a){a.response?console.error("Node deletion failed with response:",{status:a.response.status,data:a.response.data,headers:a.response.headers}):a.request?console.error("Node deletion failed - no response received:",a.request):console.error("Node deletion failed - error setting up request:",a.message);let e="Failed to delete node";(null===(n=a.response)||void 0===n?void 0:n.status)===404?e="The node delete endpoint was not found on the server. The API may not be fully implemented.":a.message&&(e=a.message);let t=Error(e);throw t.cause=a,t}},y=async()=>(await a.Ay.get("/dialplan/node-types")).data,h=async e=>(await a.Ay.get("/dialplan/contexts/".concat(e,"/connections"))).data,x=async e=>{try{console.log("Creating connection with data:",e);let t=await a.Ay.post("/dialplan/connections",e);return console.log("Connection creation successful:",t.data),t.data}catch(e){var t;throw console.error("Connection creation failed:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message||e),e}},f=async e=>{var t,n;try{if(console.log("Deleting connection with ID:",e),!e||isNaN(e))throw Error("Invalid connection ID");try{let t=await a.Ay.delete("/dialplan/connections/".concat(e));return console.log("Connection deletion successful:",t.data),t.data}catch(n){if((null===(t=n.response)||void 0===t?void 0:t.status)===404){console.warn("Standard connection delete endpoint not found, trying alternate endpoint...");let t=await a.Ay.post("/dialplan/connections/delete",{id:e});return console.log("Connection deletion successful with fallback:",t.data),t.data}throw n}}catch(a){a.response?console.error("Connection deletion failed with response:",{status:a.response.status,data:a.response.data}):a.request?console.error("Connection deletion failed - no response received:",a.request):console.error("Connection deletion failed - error setting up request:",a.message);let e="Failed to delete connection";(null===(n=a.response)||void 0===n?void 0:n.status)===404?e="The connection delete endpoint was not found on the server. The API may not be fully implemented.":a.message&&(e=a.message);let t=Error(e);throw t.cause=a,t}},v=async e=>{try{return(await a.Ay.post("/dialplan/projects/".concat(e,"/validate"))).data}catch(e){return console.warn("Validate project endpoint may not be implemented yet"),{valid:!0,errors:[],warnings:[],timestamp:new Date().toISOString()}}},b=async e=>{try{return(await a.Ay.post("/dialplan/projects/".concat(e,"/generate"))).data}catch(e){return console.warn("Generate dialplan endpoint may not be implemented yet"),{dialplan:"[default]\nexten => s,1,NoOp(Demo Dialplan)\nexten => s,n,Hangup()",project:"Demo Project",contexts:1,timestamp:new Date().toISOString()}}},w=async()=>(await a.Ay.get("/system/dialplan-capabilities")).data},75340:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});let a=(0,n(67401).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},93435:(e,t,n)=>{"use strict";n.d(t,{k5:()=>c});var a=n(12115),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=a.createContext&&a.createContext(o),s=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){var a,o,r;a=e,o=t,r=n[t],(o=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(o))in a?Object.defineProperty(a,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[o]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e){return t=>a.createElement(u,i({attr:l({},e.attr)},t),function e(t){return t&&t.map((t,n)=>a.createElement(t.tag,l({key:n},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var n,{attr:o,size:r,title:d}=e,c=function(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,s),u=r||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),a.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,c,{className:n,style:l(l({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),d&&a.createElement("title",null,d),e.children)};return void 0!==r?a.createElement(r.Consumer,null,e=>t(e)):t(o)}},98787:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>$});var a=n(95155),o=n(12115),r=n(76046),s=n(55037),i=n(87364),d=n(33473),l=n(1169),c=n(19393),u=n(66798),p=n(75484),m=n(76962),g=n(95368),y=n(68719);n(11687);var h=n(92888);let x=e=>{switch(e){case"extension":return"#3b82f6";case"application":return"#10b981";case"flowcontrol":return"#8b5cf6";case"action":return"#f97316";case"terminal":return"#ef4444";default:return"#6b7280"}},f=(0,o.memo)(e=>{var t,n,o;let{id:r,data:s,selected:i}=e,{label:d,nodeType:l,properties:c={}}=s,u=x((null==l?void 0:l.category)||"application"),m=(null==l?void 0:l.inputHandles)===void 0||(null==l?void 0:l.inputHandles)>0,g=(null==l?void 0:l.outputHandles)===void 0||(null==l?void 0:l.outputHandles)>0,y=s.isEntry||(null==l?void 0:l.category)==="extension"||((null==l?void 0:null===(t=l.name)||void 0===t?void 0:t.toLowerCase())||"").includes("entry"),f=s.isExit||(null==l?void 0:l.category)==="terminal"||((null==l?void 0:null===(n=l.name)||void 0===n?void 0:n.toLowerCase())||"").includes("exit")||((null==l?void 0:null===(o=l.name)||void 0===o?void 0:o.toLowerCase())||"").includes("hangup"),v=Object.keys(c).length>0,b=!0===s.isTemp;return(0,a.jsxs)("div",{className:"px-4 py-2 shadow-md rounded-md border-2 w-48 ".concat(i?"border-blue-500 bg-blue-50":b?"border-dashed border-gray-400 bg-gray-50":y?"border-green-500 bg-green-50":f?"border-red-500 bg-red-50":"border-gray-300 bg-white"),children:[m&&!y&&(0,a.jsx)(p.h7,{type:"target",position:p.yX.Top,className:"w-3 h-3 rounded-full bg-blue-500"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full mb-2",style:{backgroundColor:u}}),b&&(0,a.jsx)("div",{className:"text-xs bg-yellow-200 text-yellow-800 px-1 rounded-sm mb-1",children:"New"}),y&&(0,a.jsx)("div",{className:"text-xs bg-green-200 text-green-800 px-1 rounded-sm mb-1",children:"Entry"}),f&&(0,a.jsx)("div",{className:"text-xs bg-red-200 text-red-800 px-1 rounded-sm mb-1",children:"Exit"}),v&&!b&&(0,a.jsxs)("div",{className:"text-xs flex items-center text-blue-600 mb-1",children:[(0,a.jsx)(h.VSk,{size:12,className:"mr-1"}),"Config"]})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"text-sm font-bold truncate",title:d,children:d})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Type: ",(null==l?void 0:l.name)||"Unknown"]}),v?(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1 truncate",children:[Object.entries(c).map(e=>{let[t,n]=e;return"string"==typeof n||"number"==typeof n||"boolean"==typeof n?(0,a.jsxs)("div",{className:"truncate",children:[t,": ",String(n)]},t):null}).filter(Boolean).slice(0,2),Object.keys(c).length>2&&(0,a.jsx)("div",{children:"..."})]}):null]}),g&&!f&&(0,a.jsx)(p.h7,{type:"source",position:p.yX.Bottom,className:"w-3 h-3 rounded-full bg-blue-500"})]})}),v=e=>{var t;let{id:n,source:o,target:r,sourceX:s,sourceY:i,targetX:d,targetY:l,sourcePosition:c,targetPosition:u,style:m={},data:g,markerEnd:y,selected:h}=e,[x,f,v]=(0,p.oN)({sourceX:s,sourceY:i,sourcePosition:c,targetX:d,targetY:l,targetPosition:u}),b=null==g?void 0:g.condition,w=null!==(t=null==g?void 0:g.priority)&&void 0!==t?t:1,N=(null==g?void 0:g.isTemp)===!0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.tE,{path:x,markerEnd:y,style:(()=>{let e={...m,strokeWidth:2};return h?{...e,stroke:"#3b82f6",strokeWidth:3}:N?{...e,stroke:"#f59e0b",strokeDasharray:"5,5"}:{...e,stroke:"#64748b"}})()}),(b||w>1)&&(0,a.jsx)(p.rV,{children:(0,a.jsxs)("div",{style:{position:"absolute",transform:"translate(-50%, -50%) translate(".concat(f,"px, ").concat(v,"px)"),fontSize:12,pointerEvents:"all"},className:"px-2 py-1 rounded border shadow-sm ".concat(N?"bg-amber-50 border-amber-200":"bg-white border-gray-200"),children:[b&&(0,a.jsx)("span",{className:"font-medium",children:b}),b&&w>1&&(0,a.jsx)("span",{className:"mx-1",children:"|"}),w>1&&(0,a.jsxs)("span",{className:"text-gray-500",children:["Priority: ",w]}),N&&(0,a.jsx)("span",{className:"text-amber-500 ml-1 text-xs",children:"(not saved)"})]})})]})};var b=n(87780),w=n(40767);let N={extension:"bg-blue-100 border-blue-500 text-blue-700",application:"bg-green-100 border-green-500 text-green-700",flowcontrol:"bg-purple-100 border-purple-500 text-purple-700",action:"bg-orange-100 border-orange-500 text-orange-700",terminal:"bg-red-100 border-red-500 text-red-700"},j={extension:"\uD83D\uDCDE",application:"\uD83D\uDD27",flowcontrol:"\uD83D\uDD04",action:"⚡",terminal:"\uD83D\uDED1"};function C(e){let{nodeTypes:t}=e,n=t.reduce((e,t)=>{let n=t.category||"application";return e[n]||(e[n]=[]),e[n].push(t),e},{}),o=(e,t)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"},r=Object.keys(n).sort((e,t)=>{let n=["extension","application","flowcontrol","action","terminal"];return n.indexOf(e)-n.indexOf(t)});return(0,a.jsxs)("div",{className:"w-64",children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2 px-2",children:"Node Types"}),0===t.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 p-2",children:"No node types available. Please check API configuration."}):r.map(e=>(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h4",{className:"text-xs font-semibold uppercase text-gray-600 mb-1 px-2",children:[j[e]," ",e]}),(0,a.jsx)("div",{className:"flex flex-col gap-1",children:n[e].map(e=>(0,a.jsx)("div",{className:"border px-3 py-2 rounded text-sm cursor-grab ".concat(N[e.category]||"bg-gray-100 border-gray-300"),draggable:!0,onDragStart:t=>o(t,e),title:e.description,children:e.name},e.id))})]},e)),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-4 p-2 bg-gray-50 rounded border border-gray-200",children:"Drag nodes onto the canvas to create your dial plan."})]})}var k=n(43031),T=n(75340);let A=e=>{let{htmlFor:t,children:n}=e;return(0,a.jsx)("label",{htmlFor:t,className:"block text-sm font-medium text-gray-700 mb-1",children:n})},S=e=>{let{id:t,value:n,onChange:o,placeholder:r,className:s,rows:i=3}=e;return(0,a.jsx)("textarea",{id:t,value:n,onChange:o,placeholder:r,className:"px-3 py-2 bg-white text-black border border-gray-300 focus:ring-blue-500 focus:border-blue-500 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 w-full ".concat(s||""),rows:i})},I=e=>{let{id:t,checked:n,onCheckedChange:o}=e;return(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("button",{id:t,type:"button",className:"relative inline-flex h-6 w-11 items-center rounded-full ".concat(n?"bg-blue-600":"bg-gray-200"),onClick:()=>o(!n),children:(0,a.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition ".concat(n?"translate-x-6":"translate-x-1")})})})},E=e=>{let{value:t,onValueChange:n,children:o}=e;return(0,a.jsx)("select",{value:t,onChange:e=>n(e.target.value),className:"px-3 py-2 bg-white text-black border border-gray-300 focus:ring-blue-500 focus:border-blue-500 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 w-full",children:o})},D=e=>{let{value:t,children:n}=e;return(0,a.jsx)("option",{value:t,children:n})},O=e=>{let{name:t,category:n}=e,a=[{id:"priority",name:"Priority",type:"number",required:!1,default:1,description:"Execution priority for this node"}];switch(n){case"extension":return[{id:"exten",name:"Extension",type:"string",required:!0,default:"s",description:"The extension pattern to match"},{id:"matchPattern",name:"Match Pattern",type:"select",required:!1,default:"exact",options:["exact","pattern","regex"],description:"How to match the extension"},...a];case"application":if(null==t?void 0:t.toLowerCase().includes("dial"))return[{id:"technology",name:"Technology",type:"select",required:!0,default:"SIP",options:["SIP","PJSIP","IAX2","DAHDI","Local"],description:"The technology to use for dialing"},{id:"destination",name:"Destination",type:"string",required:!0,default:"",description:"The destination to dial (e.g., extension or phone number)"},{id:"timeout",name:"Timeout",type:"number",required:!1,default:30,description:"Timeout in seconds"},{id:"options",name:"Dial Options",type:"string",required:!1,default:"",description:'Additional dial options (e.g., "m" for music on hold)'},...a];if(null==t?void 0:t.toLowerCase().includes("playback"))return[{id:"filename",name:"Filename",type:"string",required:!0,default:"",description:"Sound file to play (without extension)"},{id:"skip",name:"Skip if busy",type:"boolean",required:!1,default:!1,description:"Skip playback if channel is busy"},...a];if(null==t?void 0:t.toLowerCase().includes("queue"))return[{id:"queueName",name:"Queue Name",type:"string",required:!0,default:"",description:"Name of the queue"},{id:"options",name:"Queue Options",type:"string",required:!1,default:"",description:"Queue options"},{id:"timeout",name:"Timeout",type:"number",required:!1,default:0,description:"Maximum wait time in seconds (0 for unlimited)"},...a];return[{id:"app",name:"Application",type:"string",required:!0,default:"",description:"The application name"},{id:"args",name:"Arguments",type:"string",required:!1,default:"",description:"Application arguments"},...a];case"flowcontrol":if(null==t?void 0:t.toLowerCase().includes("goto"))return[{id:"context",name:"Context",type:"string",required:!1,default:"",description:"Destination context (blank for same context)"},{id:"exten",name:"Extension",type:"string",required:!0,default:"s",description:"Destination extension"},{id:"priority",name:"Priority",type:"string",required:!0,default:"1",description:"Destination priority"},...a];if((null==t?void 0:t.toLowerCase().includes("if"))||(null==t?void 0:t.toLowerCase().includes("condition")))return[{id:"expression",name:"Condition",type:"string",required:!0,default:"",description:"Expression to evaluate (e.g., ${CALLERID(num)} = 1234)"},...a];return[{id:"action",name:"Action",type:"string",required:!0,default:"",description:"Flow control action"},{id:"data",name:"Data",type:"string",required:!1,default:"",description:"Additional data for the action"},...a];case"terminal":if(null==t?void 0:t.toLowerCase().includes("hangup"))return[{id:"cause",name:"Hangup Cause",type:"select",required:!1,default:"normal",options:["normal","busy","congestion","no_answer","decline","canceled"],description:"The reason for hanging up"},...a];return[{id:"action",name:"Action",type:"string",required:!0,default:"Hangup",description:"Terminal action"},...a];default:return[{id:"custom",name:"Custom Value",type:"string",required:!1,default:"",description:"Custom configuration value"},{id:"enabled",name:"Enabled",type:"boolean",required:!1,default:!0,description:"Enable/disable this node"},...a]}},P=e=>{let{selectedNode:t,onUpdateNodeProperties:n,onUpdateNodeLabel:r,onClosePanel:s}=e,[i,d]=(0,o.useState)({}),[l,u]=(0,o.useState)("");if((0,o.useEffect)(()=>{t&&(d(t.data.properties||{}),u(t.data.label||""))},[t]),!t)return null;let p=t.data.nodeType,m=p.paramDefs&&p.paramDefs.length>0?p.paramDefs:O(p),g=(e,t)=>{d(n=>({...n,[e]:t}))},y=e=>{let t=void 0!==i[e.id]?i[e.id]:e.default;switch(e.type){case"string":default:return(0,a.jsx)(k.p,{id:e.id,value:t||"",onChange:t=>g(e.id,t.target.value),placeholder:e.description||"",className:"w-full"});case"number":return(0,a.jsx)(k.p,{id:e.id,type:"number",value:t||0,onChange:t=>g(e.id,parseFloat(t.target.value)),placeholder:e.description||"",className:"w-full"});case"boolean":return(0,a.jsx)(I,{id:e.id,checked:!!t,onCheckedChange:t=>g(e.id,t)});case"select":var n;return(0,a.jsx)(E,{value:t||"",onValueChange:t=>g(e.id,t),children:null===(n=e.options)||void 0===n?void 0:n.map(e=>(0,a.jsx)(D,{value:e,children:e},e))})}};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow-md w-full max-h-full overflow-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Node Properties"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:s,children:(0,a.jsx)(T.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-2 bg-gray-50 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:p.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:p.description}),(0,a.jsx)("div",{className:"text-xs mt-1 bg-gray-200 inline-block px-2 py-0.5 rounded-full",children:p.category})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(A,{htmlFor:"node-label",children:"Label"}),(0,a.jsx)(k.p,{id:"node-label",value:l,onChange:e=>u(e.target.value),placeholder:"Node label",className:"w-full"})]}),m.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Parameters"}),m.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(A,{htmlFor:e.id,children:[e.name," ",e.required&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description}),y(e)]},e.id))]}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No configurable parameters"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(A,{htmlFor:"custom-properties",children:"Custom Properties (JSON)"}),(0,a.jsx)(S,{id:"custom-properties",value:JSON.stringify(i,null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);d(t)}catch(e){}},placeholder:"Custom properties in JSON format",className:"font-mono text-xs",rows:5})]}),(0,a.jsx)(c.$,{variant:"brand",fullWidth:!0,onClick:()=>{t&&(n(t.id,i),l!==t.data.label&&r(t.id,l))},children:"Apply Changes"})]})]})},q={customNode:f,default:f},L={customEdge:v,default:v};function F(e){let{nodes:t=[],edges:n=[],nodeTypes:r=[],contextId:i,onNodesChange:l,onEdgesChange:h,onSave:x,readOnly:f=!1}=e,v=(0,o.useRef)(null),[N,j]=(0,o.useState)(!1),[k,T]=(0,o.useState)(!1),[A,S]=(0,o.useState)({nodesToCreate:[],nodesToUpdate:[],nodesToDelete:[],edgesToCreate:[],edgesToDelete:[]}),[I,E]=(0,o.useState)(-1);r.filter(e=>{var t;return"extension"===e.category||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("entry"))}),r.filter(e=>{var t,n;return"terminal"===e.category||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes("exit"))||(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes("hangup"))});let D=e=>{if(!e||0===e.length)return console.log("No nodes provided to process"),[];console.log("Processing ".concat(e.length," nodes"),e);let t=[],n=[],a=[];e.forEach(e=>{var o,s,i;let d=r.find(t=>t.id===e.nodeTypeId);if(!d){a.push(e);return}"extension"===d.category||(null===(o=d.name)||void 0===o?void 0:o.toLowerCase().includes("entry"))?t.push(e):"terminal"===d.category||(null===(s=d.name)||void 0===s?void 0:s.toLowerCase().includes("exit"))||(null===(i=d.name)||void 0===i?void 0:i.toLowerCase().includes("hangup"))?n.push(e):a.push(e)}),console.log("Found ".concat(t.length," entry nodes, ").concat(n.length," exit nodes, ").concat(a.length," other nodes"));let o=Math.max(600,200*Math.max(t.length,n.length)),s=(o-200*t.length)/2,i=(o-200*n.length)/2;return[...t.map((e,t)=>({id:e.id.toString(),type:"customNode",position:{x:s+200*t,y:50},data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e,isEntry:!0}})),...a.map(e=>({id:e.id.toString(),type:"customNode",position:e.position,data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e}})),...n.map((e,t)=>({id:e.id.toString(),type:"customNode",position:{x:i+200*t,y:600},data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e,isExit:!0}}))]},[O,F]=(0,o.useState)(D(t));(0,o.useEffect)(()=>{F(D(t))},[t,r]);let U=e=>e.map(e=>{var t,n;return{id:e.id,source:e.source,target:e.target,label:e.label,type:"default",markerEnd:{type:p.TG.ArrowClosed},data:{condition:(null===(t=e.data)||void 0===t?void 0:t.condition)||null,priority:(null===(n=e.data)||void 0===n?void 0:n.priority)||1}}}),[_,W,$]=(0,p.ck)(O),[z,V,M]=(0,p.fM)(U(n));(0,o.useEffect)(()=>{W(O)},[O,W]),(0,o.useEffect)(()=>{V(U(n))},[n,V]);let[H,B]=(0,o.useState)(null),[J,R]=(0,o.useState)(null),G=(0,o.useCallback)(()=>(E(e=>e-1),I.toString()),[I]),Q=(0,o.useCallback)(e=>{if(!f&&i)try{if(!e.source||!e.target){console.error("Invalid connection - missing source or target");return}let t=G(),n={id:"temp_".concat(t),source:e.source,target:e.target,type:"default",markerEnd:{type:p.TG.ArrowClosed},data:{condition:null,priority:1,isTemp:!0,sourceId:e.source,targetId:e.target}};S(n=>({...n,edgesToCreate:[...n.edgesToCreate,{tempId:"temp_".concat(t),sourceNodeId:e.source,targetNodeId:e.target,condition:null,priority:1}]})),V(e=>(0,p.rN)(n,e)),s.Ay.success("Connection added (not saved yet)")}catch(e){console.error("Error creating local connection:",e),s.Ay.error("Failed to create connection")}},[i,f,V,G]),X=(0,o.useCallback)((e,t)=>{R(t),T(!0),j(!1)},[]),K=(0,o.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),Y=(0,o.useCallback)(e=>{if(e.preventDefault(),f||!v.current||!H||!i)return;let t=v.current.getBoundingClientRect(),n=e.dataTransfer.getData("application/reactflow");if(n)try{var a,o,r,d,l,c;let i=JSON.parse(n),u={...H.project({x:e.clientX-t.left,y:e.clientY-t.top})};if("extension"===i.category||(null===(a=i.name)||void 0===a?void 0:a.toLowerCase().includes("entry"))){u.y=50;let e=_.filter(e=>{var t,n,a;return e.data.isEntry||(null===(t=e.data.nodeType)||void 0===t?void 0:t.category)==="extension"||(null===(a=e.data.nodeType)||void 0===a?void 0:null===(n=a.name)||void 0===n?void 0:n.toLowerCase().includes("entry"))});u.x=200*e.length+100}else if("terminal"===i.category||(null===(o=i.name)||void 0===o?void 0:o.toLowerCase().includes("exit"))||(null===(r=i.name)||void 0===r?void 0:r.toLowerCase().includes("hangup"))){u.y=600;let e=_.filter(e=>{var t,n,a,o,r;return e.data.isExit||(null===(t=e.data.nodeType)||void 0===t?void 0:t.category)==="terminal"||(null===(a=e.data.nodeType)||void 0===a?void 0:null===(n=a.name)||void 0===n?void 0:n.toLowerCase().includes("exit"))||(null===(r=e.data.nodeType)||void 0===r?void 0:null===(o=r.name)||void 0===o?void 0:o.toLowerCase().includes("hangup"))});u.x=200*e.length+100}let p=G(),m="".concat(i.name,"_").concat(Date.now()),g={tempId:"temp_".concat(p),nodeTypeId:i.id,name:m,label:m,position:u,properties:i.defaultParams||{}};S(e=>({...e,nodesToCreate:[...e.nodesToCreate,g]}));let y={id:"temp_".concat(p),type:"customNode",position:u,data:{label:m,nodeType:i,properties:i.defaultParams||{},isTemp:!0,isEntry:"extension"===i.category||(null===(d=i.name)||void 0===d?void 0:d.toLowerCase().includes("entry")),isExit:"terminal"===i.category||(null===(l=i.name)||void 0===l?void 0:l.toLowerCase().includes("exit"))||(null===(c=i.name)||void 0===c?void 0:c.toLowerCase().includes("hangup"))}};W(e=>[...e,y]),s.Ay.success("Node added (not saved yet)"),j(!1)}catch(e){console.error("Error creating node locally:",e),s.Ay.error("Failed to create node")}},[i,H,f,W,G,_]),Z=(0,o.useCallback)((e,t)=>{!f&&(t.id.startsWith("temp_")||S(e=>({...e,nodesToUpdate:[...e.nodesToUpdate.filter(e=>e.id!==t.id),{id:t.id,position:t.position}]})),t.id.startsWith("temp_")&&S(e=>({...e,nodesToCreate:e.nodesToCreate.map(e=>e.tempId===t.id?{...e,position:t.position}:e)})))},[f]),ee=(0,o.useCallback)(e=>{if(f){console.log("Cannot delete node - readOnly mode is enabled");return}try{W(t=>t.filter(t=>t.id!==e)),e.startsWith("temp_")?S(t=>({...t,nodesToCreate:t.nodesToCreate.filter(t=>t.tempId!==e)})):S(t=>({...t,nodesToDelete:[...t.nodesToDelete,e]})),V(t=>(t.filter(t=>t.source===e||t.target===e).forEach(e=>{e.id.startsWith("temp_")?S(t=>({...t,edgesToCreate:t.edgesToCreate.filter(t=>t.tempId!==e.id)})):S(t=>({...t,edgesToDelete:[...t.edgesToDelete,e.id]}))}),t.filter(t=>t.source!==e&&t.target!==e))),s.Ay.success("Node removed (not saved yet)")}catch(e){console.error("Error removing node locally:",e),s.Ay.error("Failed to remove node")}},[f,W,V]),et=(0,o.useCallback)(e=>{if(f){console.log("Cannot delete connection - readOnly mode is enabled");return}try{V(t=>t.filter(t=>t.id!==e.id)),e.id.startsWith("temp_")?S(t=>({...t,edgesToCreate:t.edgesToCreate.filter(t=>t.tempId!==e.id)})):S(t=>({...t,edgesToDelete:[...t.edgesToDelete,e.id]})),s.Ay.success("Connection removed (not saved yet)")}catch(e){console.error("Error removing connection locally:",e),s.Ay.error("Failed to remove connection")}},[f,V]),en=(0,o.useCallback)(e=>{!f&&("Delete"===e.key||"Backspace"===e.key)&&J&&(console.log("Delete key pressed, deleting selected node:",J.id),ee(J.id),R(null))},[f,J,ee]);(0,o.useEffect)(()=>(document.addEventListener("keydown",en),()=>{document.removeEventListener("keydown",en)}),[en]);let ea=(0,o.useCallback)((e,t)=>{W(n=>n.map(n=>n.id===e?{...n,data:{...n.data,properties:t}}:n)),e.startsWith("temp_")?S(n=>({...n,nodesToCreate:n.nodesToCreate.map(n=>n.tempId===e?{...n,properties:t}:n)})):S(n=>{let a=n.nodesToUpdate.findIndex(t=>t.id===e);if(!(a>=0))return{...n,nodesToUpdate:[...n.nodesToUpdate,{id:e,properties:t}]};{let e=[...n.nodesToUpdate];return e[a]={...e[a],properties:t},{...n,nodesToUpdate:e}}}),s.Ay.success("Properties updated (not saved yet)")},[W]),eo=(0,o.useCallback)((e,t)=>{W(n=>n.map(n=>n.id===e?{...n,data:{...n.data,label:t}}:n)),e.startsWith("temp_")?S(n=>({...n,nodesToCreate:n.nodesToCreate.map(n=>n.tempId===e?{...n,label:t}:n)})):S(n=>{let a=n.nodesToUpdate.findIndex(t=>t.id===e);if(!(a>=0))return{...n,nodesToUpdate:[...n.nodesToUpdate,{id:e,label:t}]};{let e=[...n.nodesToUpdate];return e[a]={...e[a],label:t},{...n,nodesToUpdate:e}}})},[W]),er=(0,o.useCallback)(()=>{j(e=>!e),N||(T(!1),R(null))},[N]),es=async()=>{if(f||!i){s.Ay.error("Cannot save - read-only mode or missing context");return}let e=s.Ay.loading("Saving changes...");try{let t={created:{nodes:0,edges:0},updated:{nodes:0},deleted:{nodes:0,edges:0},errors:{nodes:0,edges:0}},n=!1,a=await Promise.all(A.nodesToCreate.map(async e=>{try{let{tempId:n,...a}=e,o=await (0,u.RM)(i,a);return t.created.nodes++,{tempId:n,createdNode:o}}catch(o){var a;return console.error("Failed to create node:",o),(null===(a=o.response)||void 0===a?void 0:a.status)===404&&(n=!0),t.errors.nodes++,{tempId:e.tempId,error:o}}})),o={};a.forEach(e=>{e.error||(o[e.tempId]=e.createdNode.id.toString())}),await Promise.all(A.nodesToUpdate.map(async e=>{try{let n={};return e.position&&(n.position=e.position),e.properties&&(n.properties=e.properties),e.label&&(n.label=e.label),await (0,u.OK)(parseInt(e.id),n),t.updated.nodes++,{success:!0}}catch(e){var a;return console.error("Failed to update node:",e),(null===(a=e.response)||void 0===a?void 0:a.status)===404&&(n=!0),t.errors.nodes++,{error:e}}})),await Promise.all(A.edgesToCreate.map(async e=>{try{let n=e.sourceNodeId.startsWith("temp_")?parseInt(o[e.sourceNodeId]||"0"):parseInt(e.sourceNodeId),a=e.targetNodeId.startsWith("temp_")?parseInt(o[e.targetNodeId]||"0"):parseInt(e.targetNodeId);if(!n||!a)return console.error("Invalid source or target node ID for connection"),t.errors.edges++,{error:"Invalid node IDs"};let r={sourceNodeId:n,targetNodeId:a,condition:e.condition,priority:e.priority};return await (0,u.tq)(r),t.created.edges++,{success:!0}}catch(e){var a;return console.error("Failed to create connection:",e),(null===(a=e.response)||void 0===a?void 0:a.status)===404&&(n=!0),t.errors.edges++,{error:e}}})),await Promise.all(A.nodesToDelete.map(async e=>{try{return await (0,u.AC)(parseInt(e)),t.deleted.nodes++,{success:!0}}catch(e){var a,o;if(console.error("Failed to delete node:",e),(null===(a=e.response)||void 0===a?void 0:a.status)===404||(null===(o=e.message)||void 0===o?void 0:o.includes("endpoint was not found")))return n=!0,t.deleted.nodes++,{success:!0,apiMissing:!0};return t.errors.nodes++,{error:e}}})),await Promise.all(A.edgesToDelete.map(async e=>{try{let n=parseInt(e.replace("e",""));if(isNaN(n))return console.error("Invalid edge ID format:",e),t.errors.edges++,{error:"Invalid edge ID"};return await (0,u.aN)(n),t.deleted.edges++,{success:!0}}catch(e){var a,o;if(console.error("Failed to delete connection:",e),(null===(a=e.response)||void 0===a?void 0:a.status)===404||(null===(o=e.message)||void 0===o?void 0:o.includes("endpoint was not found")))return n=!0,t.deleted.edges++,{success:!0,apiMissing:!0};return t.errors.edges++,{error:e}}})),S({nodesToCreate:[],nodesToUpdate:[],nodesToDelete:[],edgesToCreate:[],edgesToDelete:[]}),W(e=>e.map(e=>{if(e.id.startsWith("temp_")&&o[e.id]){var t;let n=o[e.id],r=null===(t=a.find(t=>t.tempId===e.id))||void 0===t?void 0:t.createdNode;if(r)return{...e,id:n,data:{...e.data,isTemp:!1,dialplanNode:r}}}return e})),x&&x(),s.Ay.dismiss(e),n?s.Ay.success("Changes saved with some limitations. Some API endpoints may not be fully implemented yet.",{duration:5e3}):t.errors.nodes>0||t.errors.edges>0?s.Ay.success("Saved with some errors: Created ".concat(t.created.nodes," nodes and ").concat(t.created.edges," connections, updated ").concat(t.updated.nodes," nodes, deleted ").concat(t.deleted.nodes," nodes and ").concat(t.deleted.edges," connections. Failed: ").concat(t.errors.nodes," nodes, ").concat(t.errors.edges," connections."),{duration:5e3}):s.Ay.success("Saved: ".concat(t.created.nodes," nodes and ").concat(t.created.edges," connections created, ").concat(t.updated.nodes," nodes updated, ").concat(t.deleted.nodes," nodes and ").concat(t.deleted.edges," connections deleted"))}catch(t){console.error("Error saving changes:",t),s.Ay.dismiss(e),s.Ay.error("Failed to save changes. Some API endpoints may not be fully implemented yet.")}};return(0,o.useEffect)(()=>{H&&_.length>0&&setTimeout(()=>{H.fitView({padding:.2})},250)},[H,_.length]),(0,o.useEffect)(()=>{D()},[D]),(0,a.jsx)("div",{className:"h-full w-full relative",ref:v,children:(0,a.jsxs)(p.Gc,{nodes:_,edges:z,onNodesChange:$,onEdgesChange:M,onConnect:Q,onNodeClick:X,onInit:B,onDrop:Y,onDragOver:K,onNodeDragStop:Z,nodeTypes:q,edgeTypes:L,deleteKeyCode:["Delete","Backspace"],onNodesDelete:e=>e.forEach(e=>ee(e.id)),onEdgesDelete:e=>e.forEach(e=>et(e)),fitView:!0,fitViewOptions:{padding:.2},attributionPosition:"bottom-right",connectionMode:"loose",connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3},connectionLineType:"bezier",defaultEdgeOptions:{type:"default",style:{stroke:"#64748b",strokeWidth:2},animated:!1},defaultViewport:{x:0,y:0,zoom:1},children:[(0,a.jsx)(m.V,{}),(0,a.jsx)(g.H,{}),(0,a.jsx)(y.o,{}),(0,a.jsxs)(p.Zk,{position:"top-right",className:"flex gap-2",children:[Object.values(A).some(e=>e.length>0)&&(0,a.jsx)("div",{className:"bg-yellow-500 text-white text-xs rounded-full px-2 py-1",children:"Unsaved changes"}),(0,a.jsxs)(c.$,{variant:"outline",size:"sm",onClick:es,disabled:f||!i,children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]}),(0,a.jsxs)(c.$,{variant:N?"primary":"outline",size:"sm",onClick:er,disabled:f,children:[N?(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),N?"Close Palette":"Add Node"]})]}),N&&(0,a.jsxs)(p.Zk,{position:"top-left",className:"max-h-[600px] overflow-auto bg-white p-2 rounded shadow-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Node Palette"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:er,children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(C,{nodeTypes:r})]}),k&&J&&(0,a.jsx)(p.Zk,{position:"right",className:"w-80 max-h-full overflow-auto",children:(0,a.jsx)(P,{selectedNode:J,onUpdateNodeProperties:ea,onUpdateNodeLabel:eo,onClosePanel:()=>{T(!1),R(null)}})}),!1]})})}function U(e){return(0,a.jsx)(p.Ln,{children:(0,a.jsx)(F,{...e})})}var _=n(48173),W=n.n(_);function $(){(0,r.useRouter)();let{id:e}=(0,r.useParams)(),t=Number(e),[n,p]=(0,o.useState)(!0),[m,g]=(0,o.useState)(null),[y,h]=(0,o.useState)([]),[x,f]=(0,o.useState)(null),[v,b]=(0,o.useState)([]),[w,N]=(0,o.useState)([]),[j,C]=(0,o.useState)([]),[k,T]=(0,o.useState)(!1),[A,S]=(0,o.useState)({name:"",description:"",position:{x:100,y:100}}),[I,E]=(0,o.useState)(null);(0,o.useEffect)(()=>{t&&(async()=>{p(!0);try{let e=await (0,u.ES)(t);g(e);let n=await (0,u.ht)(t);h(n),n.length>0&&f(n[0].id);let a=await (0,u.g5)();b(a)}catch(e){console.error("Error loading project data:",e),E("Failed to load project data. Please try again later."),s.Ay.error("Failed to load project data")}finally{p(!1)}})()},[t]),(0,o.useEffect)(()=>{x&&(async()=>{try{let e=await (0,u.mJ)(x);N(e);try{let e=await (0,u.YE)(x);C(e)}catch(e){console.warn("Error fetching connections, might not be implemented yet:",e),C([])}}catch(e){console.error("Error loading context data:",e),s.Ay.error("Failed to load context data")}})()},[x]);let D=async e=>{if(e.preventDefault(),t)try{let e=await (0,u.q6)(t,A);console.log("Created context:",e),s.Ay.success("Context created successfully"),S({name:"",description:"",position:{x:100,y:100}}),T(!1);let n=await (0,u.ht)(t);h(n),f(e.id)}catch(e){console.error("Error creating context:",e),s.Ay.error("Failed to create context")}};(0,o.useCallback)((e,t)=>{N(n=>n.map(n=>String(n.id)===String(e)?{...n,...t}:n))},[]),(0,o.useCallback)(e=>{N(t=>t.filter(t=>String(t.id)!==String(e))),C(t=>t.filter(t=>String(t.sourceNodeId)!==String(e)&&String(t.targetNodeId)!==String(e)))},[]),(0,o.useCallback)((e,t)=>{C(n=>n.map(n=>String(n.id)===String(e)?{...n,...t}:n))},[]),(0,o.useCallback)(e=>{C(t=>t.filter(t=>String(t.id)!==String(e)))},[]);let O=async()=>{if(t)try{let e=await (0,u.U$)(t);console.log("Validation result:",e),e.valid?s.Ay.success("Project validation successful!"):(s.Ay.error("Validation failed with ".concat(e.errors.length," errors")),e.errors.forEach(e=>console.error(e)))}catch(e){console.error("Error validating project:",e),s.Ay.error("Failed to validate project")}};return((0,o.useCallback)((e,t)=>{let n={id:Date.now(),contextId:x||0,nodeTypeId:e.id,name:"New ".concat(e.name," Node"),label:"New ".concat(e.name," Node"),position:t,properties:{},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};N(e=>[...e,n])},[x]),(0,o.useCallback)(e=>{let t={id:Date.now(),sourceNodeId:Number(e.source),targetNodeId:Number(e.target),condition:null,priority:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};C(e=>[...e,t])},[]),n)?(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(W(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Loading Dial Plan..."})]}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6 min-h-[300px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading project data..."})})]})}):I?(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(W(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Error Loading Dial Plan"})]}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,a.jsxs)("div",{className:"text-center py-10",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-red-600 mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:I}),(0,a.jsx)(c.$,{variant:"default",onClick:()=>window.location.reload(),children:"Retry"})]})})]})}):(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(W(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:(null==m?void 0:m.name)||"Dial Plan Editor"})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Contexts"}),(0,a.jsxs)(c.$,{onClick:()=>T(!k),variant:"outline",size:"sm",children:[(0,a.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Add Context"]})]}),k&&(0,a.jsxs)("div",{className:"mb-6 border border-gray-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-4",children:"Create New Context"}),(0,a.jsxs)("form",{onSubmit:D,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-4 gap-x-4 sm:grid-cols-6",children:[(0,a.jsxs)("div",{className:"sm:col-span-3",children:[(0,a.jsx)("label",{htmlFor:"contextName",className:"block text-sm font-medium text-gray-700",children:"Context Name"}),(0,a.jsx)("input",{id:"contextName",type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand sm:text-sm",value:A.name,onChange:e=>S({...A,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"contextDescription",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("input",{id:"contextDescription",type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand sm:text-sm",value:A.description,onChange:e=>S({...A,description:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end space-x-3",children:[(0,a.jsx)(c.$,{type:"button",variant:"secondary",onClick:()=>T(!1),children:"Cancel"}),(0,a.jsx)(c.$,{type:"submit",variant:"default",disabled:!A.name,children:"Create Context"})]})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:y.length>0?y.map(e=>(0,a.jsx)("button",{className:"px-4 py-2 rounded-md text-sm font-medium ".concat(x===e.id?"bg-brand text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>f(e.id),children:e.name},e.id)):(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"No contexts available. Create one to start building your dial plan."})})]}),x?(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-4 h-[700px]",children:(0,a.jsx)(U,{nodes:w,edges:j.map(e=>({id:"e".concat(e.id),source:e.sourceNodeId.toString(),target:e.targetNodeId.toString(),label:e.condition||void 0,type:"default"})),nodeTypes:v,contextId:x,onNodesChange:e=>{console.log("Nodes changed:",e)},onEdgesChange:e=>{console.log("Edges changed:",e)},onSave:O})}):(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6 min-h-[300px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:y.length>0?"Select a context to edit its dial plan":"Create a context to start building your dial plan"})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1294,8702,844,9272,2376,6514,5037,8821,1169,1485,8441,6587,7358],()=>t(4169)),_N_E=e.O()}]);