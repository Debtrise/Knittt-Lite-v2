"use strict";exports.id=3868,exports.ids=[3868],exports.modules={13868:(e,s,t)=>{t.d(s,{A:()=>W});var a=t(45512),n=t(58009),i=t(28531),l=t.n(i),r=t(45103),o=t(79334),c=t(92666),d=t(10016),h=t(64977),x=t(69988),m=t(94209),u=t(94667),g=t(26814),f=t(61075),p=t(2694),b=t(94520),j=t(44269),w=t(87798),N=t(30722),y=t(76438);let v=(0,t(72803).v)((e,s)=>({notifications:[],unreadCount:0,isMinimized:!0,addNotification:t=>{let a=Date.now().toString()+Math.random().toString(36).substr(2,9),n={...t,id:a,timestamp:new Date,read:!1};e(e=>({notifications:[n,...e.notifications],unreadCount:e.unreadCount+1})),("success"===t.type||"info"===t.type)&&setTimeout(()=>{s().notifications.find(e=>e.id===a)&&s().removeNotification(a)},1e4)},markAsRead:s=>{e(e=>({notifications:e.notifications.map(e=>e.id===s?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)}))},markAllAsRead:()=>{e(e=>({notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0}))},removeNotification:s=>{e(e=>{let t=e.notifications.find(e=>e.id===s),a=t&&!t.read;return{notifications:e.notifications.filter(e=>e.id!==s),unreadCount:a?Math.max(0,e.unreadCount-1):e.unreadCount}})},clearAll:()=>{e({notifications:[],unreadCount:0})},toggleMinimized:()=>{e(e=>({isMinimized:!e.isMinimized}))}})),k=e=>{let{addNotification:s}=v.getState(),t=`${e.leadCount} New Lead${e.leadCount>1?"s":""} Received`,a=e.message||`${e.leadCount} lead${e.leadCount>1?"s":""} created from ${e.webhookName}`;if(e.brand||e.source){let s=[e.brand,e.source].filter(Boolean).join(" • ");a+=` (${s})`}s({type:"success",title:t,message:a,actionUrl:"/leads",actionLabel:"View Leads",webhookName:e.webhookName,leadCount:e.leadCount,leadIds:e.leadIds,brand:e.brand,source:e.source,executionDetails:e.executionDetails})},C=(e,s)=>{let{addNotification:t}=v.getState();t({type:"error",title:"Webhook Processing Failed",message:`${e}: ${s}`,actionUrl:"/webhooks",actionLabel:"Manage Webhooks",webhookName:e})};var A=t(46583),E=t(45037),$=t(61594),I=t(86201),L=t(16928),S=t(28638);let M=()=>{let{notifications:e,unreadCount:s,isMinimized:t,markAsRead:n,removeNotification:i,clearAll:r,toggleMinimized:o}=v(),c=e=>{switch(e){case"success":return(0,a.jsx)(A.A,{className:"h-5 w-5 text-green-500"});case"error":return(0,a.jsx)(E.A,{className:"h-5 w-5 text-red-500"});case"warning":return(0,a.jsx)($.A,{className:"h-5 w-5 text-yellow-500"});case"info":return(0,a.jsx)(I.A,{className:"h-5 w-5 text-blue-500"});default:return(0,a.jsx)(L.A,{className:"h-5 w-5 text-gray-500"})}},d=e=>{switch(e){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";case"info":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},h=e=>{if(!e.executionDetails)return null;let s=e.executionDetails,t=[];return s.conditionSets&&s.conditionSets.length>0&&t.push(`Rules: ${s.conditionSets.join(", ")}`),s.journeyEnrollments>0&&t.push(`${s.journeyEnrollments} Journey${s.journeyEnrollments>1?"s":""}`),s.actionsExecuted>0&&t.push(`${s.actionsExecuted} Action${s.actionsExecuted>1?"s":""}`),s.processingTime&&t.push(`${s.processingTime}ms`),t.length>0?t.join(" • "):null};return t?(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,a.jsxs)("button",{onClick:o,className:"relative bg-white border border-gray-200 rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow duration-200",children:[(0,a.jsx)(L.A,{className:"h-6 w-6 text-gray-600"}),s>0&&(0,a.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center",children:s>99?"99+":s})]})}):(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-md",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between py-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(L.A,{className:"h-5 w-5 text-gray-600"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["Notifications ",s>0&&`(${s} new)`]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.length>0&&(0,a.jsx)("button",{onClick:r,className:"text-sm text-gray-500 hover:text-gray-700 transition-colors",children:"Clear All"}),(0,a.jsx)("button",{onClick:o,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})]})]}),0===e.length?(0,a.jsxs)("div",{className:"py-8 text-center",children:[(0,a.jsx)(L.A,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-gray-500",children:"No notifications"})]}):(0,a.jsxs)("div",{className:"max-h-96 overflow-y-auto pb-4",children:[(0,a.jsx)("div",{className:"space-y-3",children:e.slice(0,10).map(e=>(0,a.jsx)("div",{className:`p-4 rounded-lg border ${d(e.type)} ${e.read?"":"ring-2 ring-opacity-50"}`,children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3 flex-1",children:[c(e.type),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"text-sm font-medium mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-sm opacity-90 mb-2",children:e.message}),e.webhookName&&(0,a.jsxs)("div",{className:"text-xs opacity-75 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Webhook:"})," ",e.webhookName,e.brand&&` • ${e.brand}`,e.source&&` • ${e.source}`]}),e.leadCount&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Leads:"})," ",e.leadCount," created",e.leadIds&&e.leadIds.length>0&&(0,a.jsxs)("span",{className:"ml-2 text-xs bg-white bg-opacity-50 px-2 py-1 rounded",children:["IDs: ",e.leadIds.slice(0,3).join(", "),e.leadIds.length>3&&"..."]})]}),h(e)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Execution:"})," ",h(e)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[(0,a.jsx)("span",{className:"text-xs opacity-75",children:e.timestamp.toLocaleTimeString()}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.actionUrl&&e.actionLabel&&(0,a.jsx)(l(),{href:e.actionUrl,className:"text-xs bg-white bg-opacity-50 hover:bg-opacity-75 px-3 py-1 rounded transition-colors",children:e.actionLabel}),!e.read&&(0,a.jsx)("button",{onClick:()=>n(e.id),className:"text-xs bg-white bg-opacity-50 hover:bg-opacity-75 px-2 py-1 rounded transition-colors",children:"Mark Read"})]})]})]})]}),(0,a.jsx)("button",{onClick:()=>i(e.id),className:"text-gray-400 hover:text-gray-600 transition-colors ml-2",children:(0,a.jsx)(j.A,{className:"h-4 w-4"})})]})},e.id))}),e.length>10&&(0,a.jsx)("div",{className:"text-center mt-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Showing 10 of ",e.length," notifications"]})})]})]})})};var D=t(67679);class T{start(){this.isPolling||(this.isPolling=!0,this.lastCheckedTimestamp=new Date,this.checkForNewEvents(),this.pollingInterval=setInterval(()=>{this.checkForNewEvents()},this.pollingIntervalMs),console.log("\uD83D\uDD14 Enhanced webhook notification service started"))}stop(){this.isPolling&&(this.isPolling=!1,this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),console.log("\uD83D\uDD14 Enhanced webhook notification service stopped"))}async checkForNewEvents(){try{for(let e of(await this.loadWebhooks(),await this.getRecentWebhookEvents()))await this.processWebhookEvent(e);this.lastCheckedTimestamp=new Date}catch(e){console.error("Error checking for webhook events:",e)}}async loadWebhooks(){try{let e=await D.Ay.webhooks.list({page:1,limit:100}),s=e.data||e,t=s.webhooks||s||[];for(let e of(this.webhookCache.clear(),t))this.webhookCache.set(e.id,e)}catch(e){console.error("Error loading webhooks:",e)}}async getRecentWebhookEvents(){try{let e=[];for(let[s]of this.webhookCache)try{let t=await D.Ay.webhooks.getEvents(s.toString(),{page:1,limit:10}),a=t.data||t,n=a.events||a||[];e.push(...n)}catch(e){console.error(`Error getting events for webhook ${s}:`,e)}return e.filter(e=>{let s=new Date(e.receivedAt);return!this.lastCheckedTimestamp||s>this.lastCheckedTimestamp}).sort((e,s)=>new Date(s.receivedAt).getTime()-new Date(e.receivedAt).getTime())}catch(e){return console.error("Error getting recent webhook events:",e),[]}}async processWebhookEvent(e){let s=this.webhookCache.get(e.webhookId);s&&(e.conditionalRulesApplied&&e.executionLog?await this.processConditionalWebhookEvent(e,s):await this.processBasicWebhookEvent(e,s))}async processConditionalWebhookEvent(e,s){let t=e.executionLog;t.actionsExecuted.filter(e=>"create_lead"===e.type&&"success"===e.status);let a=t.actionsExecuted.filter(e=>"enroll_journey"===e.type&&"success"===e.status);if(t.actionsExecuted.filter(e=>"send_notification"===e.type&&"success"===e.status),"success"===e.status&&e.createdLeadIds.length>0){let n=t.conditionResults.filter(e=>e.matched).map(e=>e.conditionSetName);k({webhookName:s.name,leadCount:e.createdLeadIds.length,leadIds:e.createdLeadIds,brand:s.brand,source:s.source,message:this.buildEnhancedMessage(s,e,{conditionSets:n,actionsExecuted:t.actionsExecuted.length,journeyEnrollments:a.length,processingTime:t.totalExecutionTime})})}else if("failed"===e.status){let a=t.actionsExecuted.filter(e=>"failed"===e.status),n=a.length>0?`Failed actions: ${a.map(e=>e.type).join(", ")}`:e.errorMessage||"Unknown error occurred";C(s.name,n)}}async processBasicWebhookEvent(e,s){if("success"===e.status&&e.createdLeadIds.length>0)k({webhookName:s.name,leadCount:e.createdLeadIds.length,leadIds:e.createdLeadIds,brand:s.brand,source:s.source});else if("partial_success"===e.status&&e.createdLeadIds.length>0)k({webhookName:s.name,leadCount:e.createdLeadIds.length,leadIds:e.createdLeadIds,brand:s.brand,source:s.source});else if("failed"===e.status){let t=e.errorMessage||"Unknown error occurred";C(s.name,t)}}buildEnhancedMessage(e,s,t){let a=`${t.conditionSets.length>0?"Conditional rules triggered":"New leads received"}`;return t.conditionSets.length>0&&(a+=` (${t.conditionSets.join(", ")})`),t.journeyEnrollments>0&&(a+=` • ${t.journeyEnrollments} journey${t.journeyEnrollments>1?"s":""} enrolled`),t.actionsExecuted>0&&(a+=` • ${t.actionsExecuted} action${t.actionsExecuted>1?"s":""} executed`),a}constructor(){this.lastCheckedTimestamp=null,this.isPolling=!1,this.pollingInterval=null,this.pollingIntervalMs=3e4,this.webhookCache=new Map}}new T;let W=({children:e})=>{let s=(0,o.usePathname)(),{user:t,logout:i}=(0,c.n)(),[v,k]=(0,n.useState)(!1),C=[{name:"Dashboard",href:"/dashboard",icon:(0,a.jsx)(d.A,{className:"w-6 h-6"})},{name:"Leads",href:"/leads",icon:(0,a.jsx)(h.A,{className:"w-6 h-6"})},{name:"Journeys",href:"/journeys",icon:(0,a.jsx)(x.A,{className:"w-6 h-6"})},{name:"Calls",href:"/calls",icon:(0,a.jsx)(m.A,{className:"w-6 h-6"})},{name:"DIDs",href:"/dids",icon:(0,a.jsx)(u.A,{className:"w-6 h-6"})},{name:"Transfer Groups",href:"/settings/transfer-groups",icon:(0,a.jsx)(g.A,{className:"w-6 h-6"})},{name:"Templates",href:"/templates",icon:(0,a.jsx)(f.A,{className:"w-6 h-6"})},{name:"Webhooks",href:"/webhooks",icon:(0,a.jsx)(p.A,{className:"w-6 h-6"})},{name:"Reports",href:"/reports",icon:(0,a.jsx)(f.A,{className:"w-6 h-6"})},{name:"Settings",href:"/settings",icon:(0,a.jsx)(b.A,{className:"w-6 h-6"}),adminOnly:!0},{name:"Users",href:"/settings/users",icon:(0,a.jsx)(h.A,{className:"w-6 h-6"}),adminOnly:!0}],A=t?.role==="admin"?C:C.filter(e=>!e.adminOnly),E=()=>{i(),window.location.href="/login"};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(M,{}),(0,a.jsx)("div",{className:"lg:hidden",children:(0,a.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,a.jsx)("div",{className:`fixed inset-0 bg-gray-600 bg-opacity-75 ${v?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>k(!1)}),(0,a.jsxs)("div",{className:`relative flex-1 flex flex-col max-w-xs w-full sidebar-brand ${v?"translate-x-0":"-translate-x-full"}`,children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,a.jsx)("button",{className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>k(!1),children:(0,a.jsx)(j.A,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center px-4",children:(0,a.jsx)("div",{className:"h-10 w-auto relative",children:(0,a.jsx)(r.default,{src:"/logo.png",alt:"Knitt Logo",width:120,height:40,className:"w-auto h-10"})})}),(0,a.jsx)("nav",{className:"mt-5 px-2 space-y-3",children:A.map(e=>(0,a.jsxs)(l(),{href:e.href,className:`group flex items-center px-4 py-4 text-lg font-bold rounded-md ${s===e.href?"bg-brand text-white":"text-gray-300 hover:bg-brand hover:bg-opacity-80 hover:text-white"}`,children:[e.icon,(0,a.jsx)("span",{className:"ml-4",children:e.name})]},e.name))})]}),(0,a.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-700 p-4",children:(0,a.jsxs)("div",{className:"flex-shrink-0 group block",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{children:(0,a.jsx)(w.A,{className:"inline-block h-10 w-10 rounded-full text-gray-300 bg-gray-600 p-2"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-base font-medium text-white",children:t?.username}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-300",children:t?.role})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)(l(),{href:"/settings/profile",className:"flex items-center text-sm font-medium text-gray-300 hover:text-white",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Profile"]}),(0,a.jsxs)("button",{onClick:E,className:"flex items-center text-sm font-medium text-brand hover:text-white",children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})})]})]})}),(0,a.jsx)("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0",children:(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0 sidebar-brand",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,a.jsx)("div",{className:"flex items-center justify-center flex-shrink-0 px-4",children:(0,a.jsx)("div",{className:"h-12 w-auto relative",children:(0,a.jsx)(r.default,{src:"/logo.png",alt:"Knitt Logo",width:150,height:50,className:"w-auto h-12"})})}),(0,a.jsx)("nav",{className:"mt-8 flex-1 px-2 space-y-3",children:A.map(e=>(0,a.jsxs)(l(),{href:e.href,className:`group flex items-center px-4 py-4 text-lg font-bold rounded-md ${s===e.href?"bg-brand text-white":"text-gray-300 hover:bg-brand hover:bg-opacity-80 hover:text-white"}`,children:[e.icon,(0,a.jsx)("span",{className:"ml-4",children:e.name})]},e.name))})]}),(0,a.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-700 p-4",children:(0,a.jsxs)("div",{className:"flex-shrink-0 group block",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{children:(0,a.jsx)(w.A,{className:"inline-block h-10 w-10 rounded-full text-gray-300 bg-gray-600 p-2"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-base font-medium text-white",children:t?.username}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-300",children:t?.role})]})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)(l(),{href:"/settings/profile",className:"flex items-center text-sm font-medium text-gray-300 hover:text-white",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Profile"]}),(0,a.jsxs)("button",{onClick:E,className:"flex items-center text-sm font-medium text-brand hover:text-white",children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})})]})}),(0,a.jsxs)("div",{className:"lg:pl-64 flex flex-col flex-1",children:[(0,a.jsx)("div",{className:"sticky top-0 z-10 lg:hidden pl-1 pt-1 sm:pl-3 sm:pt-3 bg-brand",children:(0,a.jsxs)("button",{type:"button",className:"-ml-0.5 -mt-0.5 h-12 w-12 inline-flex items-center justify-center rounded-md text-white hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>k(!0),children:[(0,a.jsx)("span",{className:"sr-only",children:"Open sidebar"}),(0,a.jsx)(y.A,{className:"h-6 w-6"})]})}),(0,a.jsx)("main",{className:"flex-1 pb-10",children:(0,a.jsx)("div",{className:"py-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:e})})})]})]})}}};