(()=>{var e={};e.id=181,e.ids=[181],e.modules={715:(e,t,r)=>{Promise.resolve().then(r.bind(r,87851))},1372:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8866:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},19904:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},21820:e=>{"use strict";e.exports=require("os")},21956:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34705:(e,t,r)=>{"use strict";r.d(t,{J:()=>d});var s=r(45512),a=r(58009),i=r(30830),n=a.forwardRef((e,t)=>(0,s.jsx)(i.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var l=r(89808);let d=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(n,{ref:r,className:(0,l.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));d.displayName=n.displayName},42163:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]])},49656:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},53505:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o});var s=r(70260),a=r(28203),i=r(25155),n=r.n(i),l=r(67292),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);r.d(t,d);let o={children:["",{children:["(app)",{children:["journeys",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,87851)),"/Applications/Knittt-Lite-v2/app/(app)/journeys/[id]/page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,19611)),"/Applications/Knittt-Lite-v2/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Applications/Knittt-Lite-v2/app/(app)/journeys/[id]/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(app)/journeys/[id]/page",pathname:"/journeys/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57141:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eY});var s=r(45512),a=r(58009),i=r(79334),n=r(28531),l=r.n(n),d=r(22403),o=r(35668),c=r(64977),u=r(81259),p=r(4339),m=r(19904),x=r(49656),h=r(13868),g=r(43517),y=r(89972),f=r(63451),j=r(87565),v=r(49169),b=r(83083),N=r(34705),w=r(59010),C=r(64985),k=r(92666),A=r(66581),S=r(98145),T=r(22387),E=r(67625),_=r(82040);r(17163);var q=r(41680);let I=(0,q.A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),D=(0,q.A)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),L=(0,q.A)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),R=(0,q.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var M=r(19473),P=r(94209),$=r(1372),O=r(8866),F=r(61075),J=r(94937),V=r(42163),U=r(4643);let z=(0,q.A)("circle-arrow-right",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),H=(0,q.A)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var W=r(92557);let B=(0,q.A)("circle-help",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var G=r(45037);let Z=e=>{switch(e){case"call":return(0,s.jsx)(P.A,{className:"h-4 w-4 text-blue-500"});case"sms":return(0,s.jsx)($.A,{className:"h-4 w-4 text-green-500"});case"email":return(0,s.jsx)(O.A,{className:"h-4 w-4 text-amber-500"});case"status_change":return(0,s.jsx)(F.A,{className:"h-4 w-4 text-purple-500"});case"tag_update":return(0,s.jsx)(J.A,{className:"h-4 w-4 text-indigo-500"});case"webhook":return(0,s.jsx)(V.A,{className:"h-4 w-4 text-gray-500"});case"wait_for_event":return(0,s.jsx)(U.A,{className:"h-4 w-4 text-teal-500"});case"conditional_branch":return(0,s.jsx)(z,{className:"h-4 w-4 text-indigo-500"});case"lead_assignment":return(0,s.jsx)(c.A,{className:"h-4 w-4 text-blue-400"});case"data_update":return(0,s.jsx)(H,{className:"h-4 w-4 text-orange-500"});case"journey_transfer":return(0,s.jsx)(W.A,{className:"h-4 w-4 text-red-500"});case"delay":return(0,s.jsx)(U.A,{className:"h-4 w-4 text-gray-500"});default:return(0,s.jsx)(B,{className:"h-4 w-4 text-gray-500"})}},K=(e,t,r)=>{switch(e){case"call":case"lead_assignment":return t?"border-green-300":r?"border-red-300":"border-blue-300";case"sms":return t?"border-green-300":r?"border-red-300":"border-green-300";case"email":return t?"border-green-300":r?"border-red-300":"border-amber-300";case"status_change":return t?"border-green-300":r?"border-red-300":"border-purple-300";case"tag_update":case"conditional_branch":return t?"border-green-300":r?"border-red-300":"border-indigo-300";case"webhook":case"delay":return t?"border-green-300":r?"border-red-300":"border-gray-300";case"wait_for_event":return t?"border-green-300":r?"border-red-300":"border-teal-300";case"data_update":return t?"border-green-300":r?"border-red-300":"border-orange-300";case"journey_transfer":return t?"border-green-300":"border-red-300";default:return"border-gray-300"}},X=(e,t,r)=>{switch(e){case"call":return t?"Start":r?"End":"Call";case"sms":return t?"Start":r?"End":"SMS";case"email":return t?"Start":r?"End":"Email";case"status_change":return t?"Start":r?"End":"Status Change";case"tag_update":return t?"Start":r?"End":"Tag Update";case"webhook":return t?"Start":r?"End":"Webhook";case"wait_for_event":return t?"Start":r?"End":"Wait for Event";case"conditional_branch":return t?"Start":r?"End":"Branch";case"lead_assignment":return t?"Start":r?"End":"Assignment";case"data_update":return t?"Start":r?"End":"Data Update";case"journey_transfer":return t?"Start":r?"End":"Transfer";case"delay":return t?"Start":r?"End":"Delay";default:return"Unknown"}},Y=(e,t)=>{switch(e){case"immediate":return"Immediate";case"fixed_time":return`At ${t.time||"specific time"}`;case"delay_after_previous":let r=t.minutes||0,s=t.hours||0,a=t.days||0,i=[];return a>0&&i.push(`${a} day${1!==a?"s":""}`),s>0&&i.push(`${s} hr${1!==s?"s":""}`),r>0&&i.push(`${r} min${1!==r?"s":""}`),i.length>0?`${i.join(", ")} after previous`:"After previous";case"delay_after_enrollment":return`${t.days||0}d ${t.hours||0}h after enrollment`;case"specific_days":let n=(Array.isArray(t.days)?t.days:[]).map(e=>e.substring(0,3)).join(", ");return`On ${n||"specific days"}`;default:return"Custom delay"}},Q=(0,a.memo)(({data:e})=>{let{step:t,selected:r,onEdit:a,displayIndex:i}=e,n=t.isExitPoint,l=t.isActive,d=0===t.stepOrder,o=K(t.actionType,d,n),c=X(t.actionType,d,n),u=void 0!==i?i+1:Math.ceil(t.stepOrder/10);return(0,s.jsxs)("div",{className:`relative p-4 rounded-lg border-2 w-72 bg-white shadow-md transition-all hover:shadow-lg
        ${r?"border-brand ring-2 ring-brand ring-opacity-50":o}
        ${l?"":"opacity-60"}
        ${d?"bg-gradient-to-br from-green-50 to-white":""}
        ${n?"bg-gradient-to-br from-red-50 to-white":""}
      `,onClick:()=>a(t),children:[!d&&!n&&(0,s.jsx)("div",{className:"absolute -left-3 -top-3 bg-brand text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-medium shadow-md",children:u}),!d&&(0,s.jsx)(S.h7,{type:"target",position:S.yX.Top,className:"w-3 h-3 bg-gray-400 !border-2 !border-white"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)("div",{className:`p-2 rounded-full ${d?"bg-green-100":n?"bg-red-100":"bg-gray-100"} flex items-center justify-center shadow-sm`,children:d?(0,s.jsx)(z,{className:"h-5 w-5 text-green-500"}):n?(0,s.jsx)(G.A,{className:"h-5 w-5 text-red-500"}):Z(t.actionType)}),(0,s.jsx)("div",{className:"flex-1 truncate font-medium text-gray-800 text-base",children:t.name}),(0,s.jsx)(y.E,{variant:"outline",className:`text-xs px-2 py-1 ${d?"bg-green-100 text-green-700":n?"bg-red-100 text-red-700":""}`,children:c})]}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:t.description||"No description"}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 my-3 bg-gray-50 p-2 rounded-md border border-gray-100",children:["call"===t.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{children:t.actionConfig?.transferNumber||"No number"})]}),"sms"===t.actionType&&(0,s.jsx)("div",{className:"line-clamp-2",children:t.actionConfig?.message||t.actionConfig?.templateId||"No message"}),"email"===t.actionType&&(0,s.jsx)("div",{className:"line-clamp-2",children:t.actionConfig?.subject||"No subject"}),"status_change"===t.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(F.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:["Status: ",(0,s.jsx)("span",{className:"font-medium",children:t.actionConfig?.newStatus||"Not set"})]})]}),"tag_update"===t.actionType&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.actionConfig?.operation||"add",":",(t.actionConfig?.tags||[]).map((e,t)=>(0,s.jsx)("span",{className:"bg-gray-200 px-2 py-0.5 rounded-full text-xs",children:e},t)),(!t.actionConfig?.tags||t.actionConfig?.tags.length===0)&&(0,s.jsx)("span",{className:"text-gray-400",children:"No tags"})]}),"conditional_branch"===t.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(z,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:[t.actionConfig?.branches?.length||0," condition(s)"]})]}),"wait_for_event"===t.actionType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(U.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{children:["Wait for: ",t.actionConfig?.eventType||"any event"]})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[(0,s.jsx)(U.A,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-gray-500",children:Y(t.delayType,t.delayConfig)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!l&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"}),n&&!n&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-100 text-red-800",children:"Exit"})]})]}),!n&&(0,s.jsx)(S.h7,{type:"source",position:S.yX.Bottom,className:"w-3 h-3 bg-gray-400 !border-2 !border-white"})]})});var ee=r(31412),et=r(29952),er=r(6004),es=r(41675),ea=r(30096),ei=r(53337),en=(r(80707),r(98060)),el=r(30830),ed=r(12705),eo=r(13024),ec=r(56441),[eu,ep]=(0,er.A)("Tooltip",[ei.Bk]),em=(0,ei.Bk)(),ex="TooltipProvider",eh="tooltip.open",[eg,ey]=eu(ex),ef=e=>{let{__scopeTooltip:t,delayDuration:r=700,skipDelayDuration:i=300,disableHoverableContent:n=!1,children:l}=e,d=a.useRef(!0),o=a.useRef(!1),c=a.useRef(0);return a.useEffect(()=>{let e=c.current;return()=>window.clearTimeout(e)},[]),(0,s.jsx)(eg,{scope:t,isOpenDelayedRef:d,delayDuration:r,onOpen:a.useCallback(()=>{window.clearTimeout(c.current),d.current=!1},[]),onClose:a.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>d.current=!0,i)},[i]),isPointerInTransitRef:o,onPointerInTransitChange:a.useCallback(e=>{o.current=e},[]),disableHoverableContent:n,children:l})};ef.displayName=ex;var ej="Tooltip",[ev,eb]=eu(ej),eN=e=>{let{__scopeTooltip:t,children:r,open:i,defaultOpen:n,onOpenChange:l,disableHoverableContent:d,delayDuration:o}=e,c=ey(ej,e.__scopeTooltip),u=em(t),[p,m]=a.useState(null),x=(0,ea.B)(),h=a.useRef(0),g=d??c.disableHoverableContent,y=o??c.delayDuration,f=a.useRef(!1),[j,v]=(0,eo.i)({prop:i,defaultProp:n??!1,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(eh))):c.onClose(),l?.(e)},caller:ej}),b=a.useMemo(()=>j?f.current?"delayed-open":"instant-open":"closed",[j]),N=a.useCallback(()=>{window.clearTimeout(h.current),h.current=0,f.current=!1,v(!0)},[v]),w=a.useCallback(()=>{window.clearTimeout(h.current),h.current=0,v(!1)},[v]),C=a.useCallback(()=>{window.clearTimeout(h.current),h.current=window.setTimeout(()=>{f.current=!0,v(!0),h.current=0},y)},[y,v]);return a.useEffect(()=>()=>{h.current&&(window.clearTimeout(h.current),h.current=0)},[]),(0,s.jsx)(ei.bL,{...u,children:(0,s.jsx)(ev,{scope:t,contentId:x,open:j,stateAttribute:b,trigger:p,onTriggerChange:m,onTriggerEnter:a.useCallback(()=>{c.isOpenDelayedRef.current?C():N()},[c.isOpenDelayedRef,C,N]),onTriggerLeave:a.useCallback(()=>{g?w():(window.clearTimeout(h.current),h.current=0)},[w,g]),onOpen:N,onClose:w,disableHoverableContent:g,children:r})})};eN.displayName=ej;var ew="TooltipTrigger",eC=a.forwardRef((e,t)=>{let{__scopeTooltip:r,...i}=e,n=eb(ew,r),l=ey(ew,r),d=em(r),o=a.useRef(null),c=(0,et.s)(t,o,n.onTriggerChange),u=a.useRef(!1),p=a.useRef(!1),m=a.useCallback(()=>u.current=!1,[]);return a.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),(0,s.jsx)(ei.Mz,{asChild:!0,...d,children:(0,s.jsx)(el.sG.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...i,ref:c,onPointerMove:(0,ee.m)(e.onPointerMove,e=>{"touch"===e.pointerType||p.current||l.isPointerInTransitRef.current||(n.onTriggerEnter(),p.current=!0)}),onPointerLeave:(0,ee.m)(e.onPointerLeave,()=>{n.onTriggerLeave(),p.current=!1}),onPointerDown:(0,ee.m)(e.onPointerDown,()=>{n.open&&n.onClose(),u.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:(0,ee.m)(e.onFocus,()=>{u.current||n.onOpen()}),onBlur:(0,ee.m)(e.onBlur,n.onClose),onClick:(0,ee.m)(e.onClick,n.onClose)})})});eC.displayName=ew;var[ek,eA]=eu("TooltipPortal",{forceMount:void 0}),eS="TooltipContent",eT=a.forwardRef((e,t)=>{let r=eA(eS,e.__scopeTooltip),{forceMount:a=r.forceMount,side:i="top",...n}=e,l=eb(eS,e.__scopeTooltip);return(0,s.jsx)(en.C,{present:a||l.open,children:l.disableHoverableContent?(0,s.jsx)(eD,{side:i,...n,ref:t}):(0,s.jsx)(eE,{side:i,...n,ref:t})})}),eE=a.forwardRef((e,t)=>{let r=eb(eS,e.__scopeTooltip),i=ey(eS,e.__scopeTooltip),n=a.useRef(null),l=(0,et.s)(t,n),[d,o]=a.useState(null),{trigger:c,onClose:u}=r,p=n.current,{onPointerInTransitChange:m}=i,x=a.useCallback(()=>{o(null),m(!1)},[m]),h=a.useCallback((e,t)=>{let r=e.currentTarget,s={x:e.clientX,y:e.clientY},a=function(e,t){let r=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(r,s,a,i)){case i:return"left";case a:return"right";case r:return"top";case s:return"bottom";default:throw Error("unreachable")}}(s,r.getBoundingClientRect());o(function(e){let t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:+!!(e.y>t.y)),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let s=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(s.y-r.y)>=(e.y-r.y)*(s.x-r.x))t.pop();else break}t.push(s)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let s=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(s.y-t.y)>=(e.y-t.y)*(s.x-t.x))r.pop();else break}r.push(s)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(t)}([...function(e,t,r=5){let s=[];switch(t){case"top":s.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":s.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":s.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":s.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return s}(s,a),...function(e){let{top:t,right:r,bottom:s,left:a}=e;return[{x:a,y:t},{x:r,y:t},{x:r,y:s},{x:a,y:s}]}(t.getBoundingClientRect())])),m(!0)},[m]);return a.useEffect(()=>()=>x(),[x]),a.useEffect(()=>{if(c&&p){let e=e=>h(e,p),t=e=>h(e,c);return c.addEventListener("pointerleave",e),p.addEventListener("pointerleave",t),()=>{c.removeEventListener("pointerleave",e),p.removeEventListener("pointerleave",t)}}},[c,p,h,x]),a.useEffect(()=>{if(d){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},s=c?.contains(t)||p?.contains(t),a=!function(e,t){let{x:r,y:s}=e,a=!1;for(let e=0,i=t.length-1;e<t.length;i=e++){let n=t[e],l=t[i],d=n.x,o=n.y,c=l.x,u=l.y;o>s!=u>s&&r<(c-d)*(s-o)/(u-o)+d&&(a=!a)}return a}(r,d);s?x():a&&(x(),u())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[c,p,d,u,x]),(0,s.jsx)(eD,{...e,ref:l})}),[e_,eq]=eu(ej,{isInside:!1}),eI=(0,ed.Dc)("TooltipContent"),eD=a.forwardRef((e,t)=>{let{__scopeTooltip:r,children:i,"aria-label":n,onEscapeKeyDown:l,onPointerDownOutside:d,...o}=e,c=eb(eS,r),u=em(r),{onClose:p}=c;return a.useEffect(()=>(document.addEventListener(eh,p),()=>document.removeEventListener(eh,p)),[p]),a.useEffect(()=>{if(c.trigger){let e=e=>{let t=e.target;t?.contains(c.trigger)&&p()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[c.trigger,p]),(0,s.jsx)(es.qW,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:e=>e.preventDefault(),onDismiss:p,children:(0,s.jsxs)(ei.UC,{"data-state":c.stateAttribute,...u,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,s.jsx)(eI,{children:i}),(0,s.jsx)(e_,{scope:r,isInside:!0,children:(0,s.jsx)(ec.bL,{id:c.contentId,role:"tooltip",children:n||i})})]})})});eT.displayName=eS;var eL="TooltipArrow";a.forwardRef((e,t)=>{let{__scopeTooltip:r,...a}=e,i=em(r);return eq(eL,r).isInside?null:(0,s.jsx)(ei.i3,{...i,...a,ref:t})}).displayName=eL;var eR=r(7702);let eM=a.forwardRef(({className:e,sideOffset:t=4,...r},a)=>(0,s.jsx)(eT,{ref:a,sideOffset:t,className:(0,eR.cn)("z-50 overflow-hidden rounded-md border border-gray-200 bg-white px-3 py-1.5 text-sm text-gray-900 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));eM.displayName=eT.displayName;let eP={stepNode:Q},e$=(e,t,r=[])=>{if(r.length>0){let e=r[r.length-1].position;return{x:e.x,y:e.y+150}}return t<=1?{x:250,y:50}:{x:250,y:50+150*e}},eO=(e,t)=>"conditional_branch"===e.actionType?{type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2,strokeDasharray:"5,5"}}:"wait_for_event"===e.actionType?{type:"smoothstep",animated:!0,style:{stroke:"#10b981",strokeWidth:2}}:{type:"smoothstep",animated:!0,style:{stroke:"#999",strokeWidth:2}},eF=(e,t,r=[])=>{let s=[...e].sort((e,t)=>e.stepOrder-t.stepOrder),a=s.map((e,a)=>{let i=0===a,n=a===s.length-1;i&&e.name===`Step ${a+1}`&&(e.name="Start"),n&&e.name===`Step ${a+1}`&&(e.name="End",e.isExitPoint=!0);let l=r.find(t=>t.id===`step-${e.id}`),d=l?l.position:e$(a,s.length,r);return{id:`step-${e.id}`,type:"stepNode",position:d,data:{step:e,selected:t===e.id,onEdit:()=>{},displayIndex:a}}}),i=[];for(let e=0;e<s.length-1;e++){let t=s[e],r=s[e+1];if(!t.isExitPoint){let e=eO(t,r);i.push({id:`edge-${t.id}-${r.id}`,source:`step-${t.id}`,target:`step-${r.id}`,...e,label:"conditional_branch"===t.actionType?"Default":void 0})}}return s.forEach(e=>{"conditional_branch"===e.actionType&&e.actionConfig?.branches&&(Array.isArray(e.actionConfig.branches)?e.actionConfig.branches:[]).forEach((t,r)=>{if(t.nextStepId){let s=t.nextStepId;i.push({id:`edge-${e.id}-branch-${r}-${s}`,source:`step-${e.id}`,target:`step-${s}`,type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:1.5},label:t.name||`Condition ${r+1}`})}})}),{nodes:a,edges:i}},eJ=({journey:e,onJourneyUpdated:t,onSelectStep:r,selectedStep:i})=>{let[n,l,o]=(0,S.ck)([]),[c,u,p]=(0,S.fM)([]),[m,x]=(0,a.useState)(!1),[h,y]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(e&&e.steps){let{nodes:t,edges:s}=eF(e.steps,i?.id||null,n);l(t.map(e=>({...e,data:{...e.data,onEdit:e=>r(e)}}))),u(s)}},[e,i,l,u,r]);let f=(0,a.useCallback)(e=>{u(t=>(0,S.rN)({...e,type:"smoothstep",animated:!0,style:{stroke:"#999",strokeWidth:2}},t))},[u]),j=(0,a.useCallback)(async(t,r)=>{console.log(`Node ${r.id} position updated:`,r.position);let s=r.id.replace("step-","");e.steps.find(e=>e.id===parseInt(s,10))},[e]),v=async()=>{try{x(!0);let r=e.steps||[],s=r.length>0?Math.max(...r.map(e=>e.stepOrder)):0,a={name:`Step ${r.length+1}`,description:"",stepOrder:s+10,actionType:"call",actionConfig:{},delayType:"immediate",delayConfig:{},conditions:{},isActive:!0,isExitPoint:!1};await (0,A.nn)(e.id,a),d.Ay.success("Step added successfully"),t()}catch(e){console.error("Error adding step:",e),d.Ay.error("Failed to add step")}finally{x(!1)}},b=(0,a.useCallback)(()=>{let t=new Blob([JSON.stringify({journeyId:e.id,name:e.name,steps:e.steps},null,2)],{type:"application/json"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`journey-${e.id}-flow.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},[e]);return(0,a.useEffect)(()=>{let{nodes:e}=new DagreLayout().layout({nodes:n,edges:c,options:{rankdir:"TB",ranksep:50,nodesep:50}});l(e)},[n]),(0,s.jsx)("div",{className:"h-[600px] w-full border border-gray-200 rounded-lg bg-white shadow-sm",children:(0,s.jsxs)(S.Gc,{nodes:n,edges:c,onNodesChange:o,onEdgesChange:p,onConnect:f,onNodeDragStop:j,nodeTypes:eP,defaultEdgeOptions:{type:"smoothstep",style:{stroke:"#94a3b8",strokeWidth:2}},connectionLineType:S.Do.SmoothStep,connectionLineStyle:{stroke:"#94a3b8",strokeWidth:2},fitView:!0,minZoom:.1,maxZoom:1.5,proOptions:{hideAttribution:!0},onInit:y,children:[(0,s.jsx)(T.V,{color:"#f8fafc",gap:24,size:1}),(0,s.jsx)(E.H,{showInteractive:!1,className:"bg-white rounded-lg shadow-md border border-gray-200"}),(0,s.jsx)(_.o,{nodeColor:t=>{let r=e.steps.find(e=>`step-${e.id}`===t.id);if(!r)return"#cbd5e1";switch(r.actionType){case"call":return"#3b82f6";case"sms":return"#10b981";case"email":return"#f59e0b";case"tag_update":return"#8b5cf6";case"status_change":return"#ec4899";case"webhook":return"#6b7280";case"wait_for_event":return"#14b8a6";case"conditional_branch":return"#6366f1";default:return"#cbd5e1"}},maskColor:"rgba(255, 255, 255, 0.8)",className:"bg-white rounded-lg shadow-md border border-gray-200"}),(0,s.jsx)(S.Zk,{position:"top-right",className:"bg-white p-3 rounded-lg shadow-md border border-gray-200",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,s.jsx)(ef,{children:(0,s.jsxs)(eN,{children:[(0,s.jsx)(eC,{asChild:!0,children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:v,disabled:m,className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,s.jsx)(I,{className:"h-4 w-4"}),"Add Step"]})}),(0,s.jsx)(eM,{children:(0,s.jsx)("p",{children:"Add a new step to the journey"})})]})}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(ef,{children:(0,s.jsxs)(eN,{children:[(0,s.jsx)(eC,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{h&&h.zoomIn()},className:"hover:bg-gray-50",children:(0,s.jsx)(D,{className:"h-4 w-4"})})}),(0,s.jsx)(eM,{children:(0,s.jsx)("p",{children:"Zoom in"})})]})}),(0,s.jsx)(ef,{children:(0,s.jsxs)(eN,{children:[(0,s.jsx)(eC,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{h&&h.zoomOut()},className:"hover:bg-gray-50",children:(0,s.jsx)(L,{className:"h-4 w-4"})})}),(0,s.jsx)(eM,{children:(0,s.jsx)("p",{children:"Zoom out"})})]})}),(0,s.jsx)(ef,{children:(0,s.jsxs)(eN,{children:[(0,s.jsx)(eC,{asChild:!0,children:(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>{h&&h.fitView()},className:"hover:bg-gray-50",children:(0,s.jsx)(R,{className:"h-4 w-4"})})}),(0,s.jsx)(eM,{children:(0,s.jsx)("p",{children:"Fit view"})})]})})]}),(0,s.jsx)(ef,{children:(0,s.jsxs)(eN,{children:[(0,s.jsx)(eC,{asChild:!0,children:(0,s.jsxs)(g.$,{variant:"outline",size:"sm",onClick:b,className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,s.jsx)(M.A,{className:"h-4 w-4"}),"Export"]})}),(0,s.jsx)(eM,{children:(0,s.jsx)("p",{children:"Export journey as JSON"})})]})})]})})]})})};var eV=r(75749);let eU=e=>{switch(e){case"call":return[{id:"transferNumber",name:"Transfer Number",type:"string",required:!1,description:"Direct transfer number (leave empty to use transfer group)"},{id:"transferGroupId",name:"Transfer Group",type:"transfer_group_select",required:!1,description:"Select a transfer group for routing"},{id:"scriptId",name:"Call Script",type:"template_select",templateType:"script",required:!1,description:"Select a script template for the call"},{id:"fallbackDID",name:"Fallback DID",type:"string",required:!1,description:"Fallback DID if no DIDs available"},{id:"useLocalDID",name:"Use Local DID",type:"boolean",required:!1,default:!0,description:"Whether to try matching lead's area code"},{id:"maxAttempts",name:"Maximum Attempts",type:"number",required:!1,default:3,description:"Maximum attempts for this call"},{id:"voicemailDetection",name:"Voicemail Detection",type:"boolean",required:!1,default:!0,description:"Whether to detect voicemail"},{id:"voicemailMessage",name:"Voicemail Script",type:"template_select",templateType:"voicemail",required:!1,description:"Select a voicemail script template"},{id:"callerId",name:"Caller ID Name",type:"string",required:!1,description:"Custom caller ID name"},{id:"recordCall",name:"Record Call",type:"boolean",required:!1,default:!0,description:"Whether to record the call"},{id:"respectBusinessHours",name:"Respect Business Hours",type:"boolean",required:!1,default:!0,description:"Whether to respect tenant business hours"},{id:"ivrEnabled",name:"Enable IVR",type:"boolean",required:!1,default:!1,description:"Enable Interactive Voice Response system"},{id:"ivrPromptText",name:"IVR Prompt Text",type:"string",required:!1,description:'Text-to-speech prompt for IVR (e.g., "Press 1 for sales, 2 for support")'},{id:"ivrPromptRecordingId",name:"IVR Prompt Recording",type:"recording_select",required:!1,description:"Recording ID for IVR prompt (alternative to text)"},{id:"ivrTimeout",name:"IVR Timeout (seconds)",type:"number",required:!1,default:10,description:"Seconds to wait for user input"},{id:"ivrMaxRetries",name:"IVR Max Retries",type:"number",required:!1,default:3,description:"Maximum retries for invalid input"},{id:"ivrInvalidInputText",name:"Invalid Input Text",type:"string",required:!1,description:'Text-to-speech for invalid input (e.g., "Invalid selection, please try again")'},{id:"ivrInvalidInputRecordingId",name:"Invalid Input Recording",type:"recording_select",required:!1,description:"Recording ID for invalid input message"},{id:"ivrOptions",name:"IVR Menu Options",type:"ivr_options",required:!1,description:"Configure IVR menu options and actions"}];case"sms":return[{id:"message",name:"Message",type:"string",required:!1,description:"SMS text (supports variables) - leave empty to use template"},{id:"templateId",name:"SMS Template",type:"template_select",templateType:"sms",required:!1,description:"Select an SMS template (alternative to message)"},{id:"from",name:"From Number",type:"string",required:!1,description:"Sender phone number (leave empty for default)"},{id:"trackClicks",name:"Track Clicks",type:"boolean",required:!1,default:!0,description:"Whether to track link clicks"},{id:"optOutMessage",name:"Include Opt-Out",type:"boolean",required:!1,default:!0,description:"Include opt-out instructions"}];case"email":return[{id:"subject",name:"Subject",type:"string",required:!1,description:"Email subject (leave empty to use template subject)"},{id:"templateId",name:"Email Template",type:"template_select",templateType:"email",required:!0,description:"Select an email template"},{id:"from",name:"From Email",type:"string",required:!1,description:"Sender email (leave empty for default)"},{id:"fromName",name:"From Name",type:"string",required:!1,description:"Sender name (leave empty for default)"},{id:"replyTo",name:"Reply-To",type:"string",required:!1,description:"Reply-to address (leave empty for default)"},{id:"trackOpens",name:"Track Opens",type:"boolean",required:!1,default:!0,description:"Track email opens"},{id:"trackClicks",name:"Track Clicks",type:"boolean",required:!1,default:!0,description:"Track link clicks"}];case"status_change":return[{id:"newStatus",name:"New Status",type:"string",required:!0,description:"New status value"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Add a note about the change"},{id:"noteText",name:"Note Text",type:"string",required:!1,default:"Status changed by journey",description:"Custom note text"},{id:"updateLastAttempt",name:"Update Last Attempt",type:"boolean",required:!1,default:!0,description:"Update lastAttempt timestamp"}];case"tag_update":return[{id:"operation",name:"Operation",type:"select",required:!0,options:["add","remove","set"],default:"add",description:"Operation: add, remove, or set"},{id:"tags",name:"Tags",type:"string",required:!0,description:"Comma-separated tags to operate on"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Record a note about tag changes"},{id:"noteText",name:"Note Text",type:"string",required:!1,default:"Tags updated by journey",description:"Custom note text"}];case"webhook":return[{id:"url",name:"Webhook URL",type:"string",required:!0,description:"Webhook URL"},{id:"method",name:"HTTP Method",type:"select",options:["GET","POST","PUT","PATCH","DELETE"],required:!1,default:"POST",description:"HTTP method"},{id:"timeout",name:"Timeout (ms)",type:"number",required:!1,default:1e4,description:"Timeout in milliseconds"},{id:"retries",name:"Retries",type:"number",required:!1,default:3,description:"Number of retry attempts"},{id:"updateLeadData",name:"Update Lead Data",type:"boolean",required:!1,default:!1,description:"Update lead with response data"}];case"wait_for_event":return[{id:"eventType",name:"Event Type",type:"select",options:["inbound_call","email_opened","link_clicked","form_submitted","sms_replied"],required:!0,description:"Event type to wait for"},{id:"timeoutDays",name:"Timeout Days",type:"number",required:!1,default:7,description:"Days to wait before timing out"},{id:"timeoutAction",name:"Timeout Action",type:"select",options:["skip_step","end_journey"],required:!1,default:"skip_step",description:"Action on timeout"},{id:"captureData",name:"Capture Event Data",type:"boolean",required:!1,default:!0,description:"Whether to capture event data"}];case"conditional_branch":return[{id:"conditionField",name:"Condition Field",type:"string",required:!0,description:"Field to evaluate (e.g., additionalData.value)"},{id:"operator",name:"Operator",type:"select",options:["=","!=",">","<",">=","<=","contains","not_contains","exists","not_exists"],required:!0,description:"Comparison operator"},{id:"value",name:"Value",type:"string",required:!1,description:"Value to compare against"},{id:"nextStepId",name:"Next Step ID",type:"number",required:!0,description:"ID of step to go to if condition is true"},{id:"defaultNextStepId",name:"Default Next Step ID",type:"number",required:!1,description:"Default step if condition is false"}];case"lead_assignment":return[{id:"assignmentType",name:"Assignment Type",type:"select",options:["user","team"],required:!0,description:"User or team"},{id:"assignToId",name:"Assign To ID",type:"string",required:!0,description:"User or team ID"},{id:"notifyAssignee",name:"Notify Assignee",type:"boolean",required:!1,default:!0,description:"Send notification to assignee"},{id:"notificationMethod",name:"Notification Method",type:"select",options:["email","sms","system"],required:!1,default:"email",description:"Method to notify assignee"},{id:"assignmentNote",name:"Assignment Note",type:"string",required:!1,description:"Note for the assignee"},{id:"priority",name:"Priority",type:"select",options:["low","medium","high","urgent"],required:!1,default:"medium",description:"Priority level"}];case"data_update":return[{id:"field",name:"Field",type:"string",required:!0,description:"Field to update (e.g., additionalData.score)"},{id:"value",name:"Value",type:"string",required:!0,description:"New value"},{id:"operation",name:"Operation",type:"select",options:["set","increment","decrement"],required:!1,default:"set",description:"Operation to perform"},{id:"recordNote",name:"Record Note",type:"boolean",required:!1,default:!0,description:"Record a note about the update"}];case"journey_transfer":return[{id:"targetJourneyId",name:"Target Journey ID",type:"number",required:!0,description:"Target journey ID"},{id:"exitCurrentJourney",name:"Exit Current Journey",type:"boolean",required:!1,default:!0,description:"Whether to exit the current journey"},{id:"transferContextData",name:"Transfer Context Data",type:"boolean",required:!1,default:!0,description:"Transfer context data to new journey"},{id:"startAtStep",name:"Start At Step",type:"number",required:!1,description:"Start at specific step ID (null = start at beginning)"}];case"delay":return[{id:"minutes",name:"Minutes",type:"number",required:!1,default:0,description:"Minutes to delay"},{id:"hours",name:"Hours",type:"number",required:!1,default:0,description:"Hours to delay"},{id:"days",name:"Days",type:"number",required:!1,default:0,description:"Days to delay"},{id:"businessHoursOnly",name:"Business Hours Only",type:"boolean",required:!1,default:!0,description:"Only count business hours"},{id:"exactDateTime",name:"Exact Date/Time",type:"string",required:!1,description:"Specific date/time to resume (ISO format)"},{id:"overrideStepDelay",name:"Override Step Delay",type:"boolean",required:!1,default:!0,description:"Whether this overrides the step's delayConfig"}];default:return[]}},ez=e=>{switch(e){case"immediate":default:return[];case"fixed_time":return[{id:"time",name:"Time",type:"string",required:!0,description:"Time in HH:MM format (24-hour)"}];case"delay_after_previous":case"delay_after_enrollment":return[{id:"minutes",name:"Minutes",type:"number",required:!1,default:0,description:"Minutes to delay"},{id:"hours",name:"Hours",type:"number",required:!1,default:0,description:"Hours to delay"},{id:"days",name:"Days",type:"number",required:!1,default:0,description:"Days to delay"}];case"specific_days":return[{id:"days",name:"Days",type:"select",options:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],required:!0,description:"Days of the week to execute"},{id:"time",name:"Time",type:"string",required:!0,description:"Time in HH:MM format (24-hour)"}]}},eH=e=>{let t=eU(e),r={};return t.forEach(e=>{void 0!==e.default?r[e.id]=e.default:e.required&&("string"===e.type?r[e.id]="":"number"===e.type?r[e.id]=0:"boolean"===e.type?r[e.id]=!1:"select"===e.type&&e.options&&e.options.length>0&&(r[e.id]=e.options[0]))}),r},eW=e=>{let t=ez(e),r={};return t.forEach(e=>{void 0!==e.default?r[e.id]=e.default:e.required&&("string"===e.type?r[e.id]="":"number"===e.type?r[e.id]=0:"boolean"===e.type?r[e.id]=!1:"select"===e.type&&e.options&&e.options.length>0&&(r[e.id]=e.options[0]))}),r};var eB=r(67679),eG=r(21956),eZ=r(33680),eK=r(86941);let eX=({step:e,journeyId:t,onStepUpdated:r,onStepDeleted:i,stepIndex:n})=>{let{isAuthenticated:l,user:o,token:c}=(0,k.n)();console.log("StepEditor - Authentication state:",{isAuthenticated:l,user:o,hasToken:!!c});let[u,p]=(0,a.useState)({name:"",description:"",stepOrder:0,actionType:"call",actionConfig:{},delayType:"immediate",delayConfig:{},isActive:!0,isExitPoint:!1}),[m,h]=(0,a.useState)(!1),[y,f]=(0,a.useState)(!1),[j,C]=(0,a.useState)({}),[S,T]=(0,a.useState)([]),[E,_]=(0,a.useState)([]),[q,I]=(0,a.useState)(!1),[D,L]=(0,a.useState)(!1),[R,M]=(0,a.useState)(!1),[P,$]=(0,a.useState)(null),[O,F]=(0,a.useState)(!1),[J,V]=(0,a.useState)(!1),[U,z]=(0,a.useState)("html"),H=void 0!==n?n+1:Math.ceil(e.stepOrder/10),W=eU(u.actionType),B=ez(u.delayType),G=(0,a.useCallback)(async e=>{if(!l){console.warn("User not authenticated, skipping template loading");return}console.log("Loading templates for types:",e),I(!0);try{let t={};for(let r of e)try{console.log(`Loading templates for type: ${r}`);let e=await eB.Ay.templates.list({type:r,isActive:!0,limit:100}),s=e.data?.templates||e.data||[];t[r]=Array.isArray(s)?s:[],console.log(`Loaded ${t[r].length} templates for ${r}`),console.log(`Sample template data for ${r}:`,t[r][0])}catch(e){console.error(`Error loading templates for type ${r}:`,e),t[r]=[]}C(e=>({...e,...t}))}catch(e){console.error("Error loading templates:",e),d.Ay.error("Failed to load templates")}finally{I(!1)}},[l]),Z=(0,a.useCallback)(async()=>{if(!l){console.warn("User not authenticated, skipping transfer groups loading");return}console.log("Loading transfer groups..."),L(!0);try{let e=await eB.Ay.transferGroups.list({isActive:!0,limit:100});console.log("Transfer groups API response:",e);let t=e.data?.groups||e.data||[];T(Array.isArray(t)?t:[]),console.log(`Loaded ${t.length} transfer groups`)}catch(e){console.error("Error loading transfer groups:",e),d.Ay.error("Failed to load transfer groups"),T([])}finally{L(!1)}},[l]),K=(0,a.useCallback)(async()=>{if(!l){console.warn("User not authenticated, skipping recordings loading");return}console.log("Loading recordings..."),M(!0);try{let e=await eB.Ay.recordings.getConfig();if(!e.data?.apiKey){console.warn("Eleven Labs API not configured"),d.Ay.error("Eleven Labs API not configured. Please configure it in Settings."),_([]);return}let t=await eB.Ay.recordings.list({isActive:!0,limit:100});console.log("Recordings API response:",t);let r=t.data?.data||t.data||[];_(Array.isArray(r)?r:[]),console.log(`Loaded ${r.length} recordings`)}catch(e){console.error("Error loading recordings:",e),e.response?.status===401?d.Ay.error("Authentication required to load recordings"):e.response?.status===404?d.Ay.error("Recordings API not available. Please check your configuration."):d.Ay.error("Failed to load recordings"),_([])}finally{M(!1)}},[l]);if((0,a.useEffect)(()=>{e&&p({name:e.name,description:e.description,stepOrder:e.stepOrder,actionType:e.actionType,actionConfig:e.actionConfig,delayType:e.delayType,delayConfig:e.delayConfig,isActive:e.isActive,isExitPoint:e.isExitPoint})},[e]),(0,a.useEffect)(()=>{l&&("sms"===u.actionType?G(["sms"]):"email"===u.actionType?G(["email"]):"call"===u.actionType&&G(["script","voicemail"]))},[u.actionType,l,G]),(0,a.useEffect)(()=>{"call"===u.actionType&&l&&Z()},[u.actionType,l,Z]),(0,a.useEffect)(()=>{"call"===u.actionType&&u.actionConfig?.ivrEnabled&&l&&K()},[u.actionType,u.actionConfig?.ivrEnabled,l,K]),!l)return(0,s.jsxs)("div",{className:"bg-white p-4 border border-gray-200 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Step"}),(0,s.jsxs)("div",{className:"bg-brand text-white px-2 py-1 rounded-md text-sm font-medium",children:["Step ",H]})]}),(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Please log in to edit journey steps."})})]});let X=async r=>{if(l&&r){console.log("Loading email preview for template:",r),V(!0);try{let s=await eB.Ay.templates.get(r),a=s.data||s;console.log("Template response:",a);let i=null;try{i=await eB.Ay.templates.renderPreview(r,{variables:{firstName:"John",lastName:"Doe",email:"john.doe@example.com",phone:"+1234567890",company:"Example Company"},context:{leadId:"sample",journeyId:t.toString(),stepId:e.id.toString()}}),console.log("Preview response:",i)}catch(e){console.warn("Preview rendering failed, using template content directly:",e)}let n="",l="",d="";i?.data&&(n=i.data.htmlContent||i.data.html||"",l=i.data.textContent||i.data.text||i.data.content||"",d=i.data.subject||""),n||l||(n=a.htmlContent||a.html_content||"",l=a.content||a.textContent||a.text_content||"",d=a.subject||""),!n&&l&&(n=`<html><body><div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">${l.replace(/\n/g,"<br>")}</div></body></html>`),console.log("Final content:",{htmlContent:n,textContent:l,subject:d}),$({subject:d||"No Subject",htmlContent:n,textContent:l}),z("html"),F(!0)}catch(e){console.error("Error loading email preview:",e),d.Ay.error("Failed to load email preview")}finally{V(!1)}}},Y=(e,t)=>{p(r=>({...r,[e]:t}))},Q=(e,t)=>{p(r=>({...r,actionConfig:{...r.actionConfig,[e]:t}}))},ee=(e,t)=>{p(r=>({...r,delayConfig:{...r.delayConfig,[e]:t}}))},et=async()=>{try{h(!0),await (0,A.sc)(t,e.id,u),d.Ay.success("Step updated successfully"),r()}catch(e){console.error("Error updating step:",e),d.Ay.error("Failed to update step")}finally{h(!1)}},er=async()=>{if(confirm("Are you sure you want to delete this step?"))try{f(!0),await (0,A.gF)(t,e.id),d.Ay.success("Step deleted successfully"),i()}catch(e){console.error("Error deleting step:",e),d.Ay.error("Failed to delete step")}finally{f(!1)}},es=({value:e,onChange:t,fieldId:r})=>{let i=e||{},[n,d]=(0,a.useState)(!1),o=(e,s)=>{t(r,{...i,[e]:s})},c=e=>{let s={...i};delete s[e],t(r,s)},u=Object.keys(i),p=["1","2","3","4","5","6","7","8","9","0","*","#","default"].filter(e=>!u.includes(e));return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-sm font-medium",children:["IVR Menu Options (",u.length,")"]}),(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>d(!n),children:[n?"Hide":"Configure"," IVR Menu"]})]}),n&&(0,s.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50 space-y-4",children:[u.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsxs)("h5",{className:"font-medium text-sm",children:["Key: ","default"===e?"Default (No Input/Invalid)":e]}),(0,s.jsx)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>c(e),children:"Remove"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Action"}),(0,s.jsxs)(eV.l6,{value:i[e]?.action||"transfer",onValueChange:t=>o(e,{...i[e],action:t}),children:[(0,s.jsx)(eV.bq,{children:(0,s.jsx)(eV.yv,{placeholder:"Select action"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"transfer",children:"Transfer Call"}),(0,s.jsx)(eV.eb,{value:"playRecording",children:"Play Recording"}),(0,s.jsx)(eV.eb,{value:"hangup",children:"Hang Up"}),(0,s.jsx)(eV.eb,{value:"collectInput",children:"Collect More Input"}),(0,s.jsx)(eV.eb,{value:"tag",children:"Add Tag"}),(0,s.jsx)(eV.eb,{value:"webhook",children:"Call Webhook"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Description"}),(0,s.jsx)(v.p,{value:i[e]?.description||"",onChange:t=>o(e,{...i[e],description:t.target.value}),placeholder:"Description for this option"})]})]}),i[e]?.action==="transfer"&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Transfer Number"}),(0,s.jsx)(v.p,{value:i[e]?.transferNumber||"",onChange:t=>o(e,{...i[e],transferNumber:t.target.value}),placeholder:"Phone number to transfer to"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Transfer Group"}),(0,s.jsxs)(eV.l6,{value:i[e]?.transferGroupId?.toString()||"none",onValueChange:t=>o(e,{...i[e],transferGroupId:"none"===t?null:parseInt(t)}),children:[(0,s.jsx)(eV.bq,{children:(0,s.jsx)(eV.yv,{placeholder:"Select transfer group"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"none",children:"No transfer group"}),S.map(e=>(0,s.jsxs)(eV.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id))]})]})]})]}),i[e]?.action==="playRecording"&&(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3 mt-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Select Recording"}),(0,s.jsxs)(eV.l6,{value:i[e]?.recordingId?.toString()||"none",onValueChange:t=>{let r="none"===t?null:parseInt(t);o(e,{...i[e],recordingId:r})},disabled:R,onOpenChange:e=>{e&&0===E.length&&l&&(console.log("Recording dropdown opened in IVR options, loading recordings..."),K())},children:[(0,s.jsx)(eV.bq,{children:(0,s.jsx)(eV.yv,{placeholder:R?"Loading recordings...":"Select a recording"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"none",children:"No recording (use text below)"}),E.map(e=>(0,s.jsxs)(eV.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===E.length&&!R&&(0,s.jsx)(eV.eb,{value:"none",disabled:!0,children:"No recordings available - Configure Eleven Labs in Settings"})]})]}),i[e]?.recordingId&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Preview Recording"})}),(0,s.jsx)(eK.A,{recordingId:i[e].recordingId.toString(),recordingName:E.find(t=>t.id.toString()===i[e].recordingId.toString())?.name||"Recording",audioUrl:E.find(t=>t.id.toString()===i[e].recordingId.toString())?.audioUrl})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{children:"Fallback Text (TTS)"}),(0,s.jsx)(v.p,{value:i[e]?.recordingText||"",onChange:t=>o(e,{...i[e],recordingText:t.target.value}),placeholder:"Text-to-speech fallback if recording unavailable"})]})]}),i[e]?.action==="tag"&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Tag Name"}),(0,s.jsx)(v.p,{value:i[e]?.tag||"",onChange:t=>o(e,{...i[e],tag:t.target.value}),placeholder:"Tag to add to lead"})]}),i[e]?.action==="webhook"&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Webhook URL"}),(0,s.jsx)(v.p,{value:i[e]?.webhookUrl||"",onChange:t=>o(e,{...i[e],webhookUrl:t.target.value}),placeholder:"https://example.com/webhook"})]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)(N.J,{children:"Next Step ID (Optional)"}),(0,s.jsx)(v.p,{type:"number",value:i[e]?.nextStepId||"",onChange:t=>o(e,{...i[e],nextStepId:parseInt(t.target.value)||null}),placeholder:"Jump to specific step after action"})]})]},e)),p.length>0&&(0,s.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"Add IVR Menu Option"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:p.map(e=>(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>o(e,{action:"transfer",description:`Option ${"default"===e?"Default":e}`}),children:["Add ","default"===e?"Default":e]},e))})]}),0===p.length&&(0,s.jsx)("div",{className:"text-center py-2",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"All IVR options configured"})})]}),0===u.length&&!n&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No IVR options configured"})]})},ea=(e,t,r)=>{switch(e.type){case"string":return(0,s.jsx)(v.p,{id:e.id,value:t||e.default||"",onChange:t=>r(e.id,t.target.value),placeholder:e.description});case"number":return(0,s.jsx)(v.p,{id:e.id,type:"number",value:void 0!==t?t:e.default||0,onChange:t=>r(e.id,parseInt(t.target.value,10)||0),placeholder:e.description});case"boolean":return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:e.id,checked:void 0!==t?t:e.default||!1,onCheckedChange:t=>r(e.id,!!t)}),(0,s.jsx)(N.J,{htmlFor:e.id,children:e.description})]});case"select":return(0,s.jsxs)(eV.l6,{value:t||e.default||(e.options?e.options[0]:""),onValueChange:t=>r(e.id,t),children:[(0,s.jsx)(eV.bq,{id:e.id,children:(0,s.jsx)(eV.yv,{placeholder:e.description})}),(0,s.jsx)(eV.gC,{children:e.options?.map(e=>s.jsx(eV.eb,{value:e,children:e},e))})]});case"template_select":let a=e.templateType&&j[e.templateType]||[],i="email"===e.templateType,n=t||e.default;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eV.l6,{value:n||"none",onValueChange:t=>{r(e.id,"none"===t?"":t),i&&($(null),F(!1))},disabled:q,onOpenChange:t=>{t&&e.templateType&&(!j[e.templateType]||0===j[e.templateType].length)&&l&&(console.log(`Template dropdown opened for ${e.templateType}, loading templates...`),G([e.templateType]))},children:[(0,s.jsx)(eV.bq,{id:e.id,children:(0,s.jsx)(eV.yv,{placeholder:q?"Loading templates...":"Select a template"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"none",children:"No template"}),a.map(e=>(0,s.jsx)(eV.eb,{value:e.id.toString(),children:e.name},e.id)),0===a.length&&!q&&(0,s.jsxs)(eV.eb,{value:"no-templates",disabled:!0,children:["No ",e.templateType," templates found"]})]})]}),i&&n&&"none"!==n&&(0,s.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",onClick:()=>X(n),disabled:J,className:"w-full flex items-center gap-2",children:[(0,s.jsx)(eG.A,{className:"h-4 w-4"}),J?"Loading Preview...":"Preview Email"]})]});case"transfer_group_select":return(0,s.jsxs)(eV.l6,{value:t||e.default||"none",onValueChange:t=>r(e.id,"none"===t?"":t),disabled:D,onOpenChange:e=>{e&&0===S.length&&l&&(console.log("Transfer group dropdown opened, loading transfer groups..."),Z())},children:[(0,s.jsx)(eV.bq,{id:e.id,children:(0,s.jsx)(eV.yv,{placeholder:D?"Loading transfer groups...":"Select a transfer group"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"none",children:"No transfer group"}),S.map(e=>(0,s.jsxs)(eV.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===S.length&&!D&&(0,s.jsx)(eV.eb,{value:"no-groups",disabled:!0,children:"No transfer groups found"})]})]});case"recording_select":let d=t||e.default;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(eV.l6,{value:d?.toString()||"none",onValueChange:t=>{let s="none"===t?null:parseInt(t);r(e.id,s)},disabled:R,onOpenChange:e=>{e&&0===E.length&&l&&(console.log("Recording dropdown opened, loading recordings..."),K())},children:[(0,s.jsx)(eV.bq,{id:e.id,children:(0,s.jsx)(eV.yv,{placeholder:R?"Loading recordings...":"Select a recording"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"none",children:"No recording (use text-to-speech)"}),E.map(e=>(0,s.jsxs)(eV.eb,{value:e.id.toString(),children:[e.name," (",e.type,")"]},e.id)),0===E.length&&!R&&(0,s.jsx)(eV.eb,{value:"none",disabled:!0,children:"No recordings available - Configure Eleven Labs in Settings"})]})]}),d&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Preview Recording"})}),(0,s.jsx)(eK.A,{recordingId:d.toString(),recordingName:E.find(e=>e.id.toString()===d.toString())?.name||"Recording",audioUrl:E.find(e=>e.id.toString()===d.toString())?.audioUrl})]})]});case"ivr_options":return(0,s.jsx)(es,{value:t,onChange:r,fieldId:e.id});default:return null}};return(0,s.jsxs)("div",{className:"bg-white p-4 border border-gray-200 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Edit Step"}),(0,s.jsxs)("div",{className:"bg-brand text-white px-2 py-1 rounded-md text-sm font-medium",children:["Step ",H]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"name",children:"Name"}),(0,s.jsx)(v.p,{id:"name",value:u.name,onChange:e=>Y("name",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"description",children:"Description"}),(0,s.jsx)(b.T,{id:"description",value:u.description,onChange:e=>Y("description",e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"stepOrder",children:"Order"}),(0,s.jsx)(v.p,{id:"stepOrder",type:"number",value:void 0!==u.stepOrder&&Number(u.stepOrder)||0,onChange:e=>Y("stepOrder",parseInt(e.target.value,10)||0)}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Internal order value. Displayed as Step ",H,"."]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"actionType",children:"Action Type"}),(0,s.jsxs)(eV.l6,{value:u.actionType,onValueChange:e=>{console.log("Action type changing to:",e);let t=eH(e),r=eU(e);console.log("New action params:",r),console.log("Template select params:",r.filter(e=>"template_select"===e.type)),console.log("Transfer group select params:",r.filter(e=>"transfer_group_select"===e.type)),p(r=>({...r,actionType:e,actionConfig:t}))},children:[(0,s.jsx)(eV.bq,{id:"actionType",children:(0,s.jsx)(eV.yv,{placeholder:"Select action type"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"call",children:"Call"}),(0,s.jsx)(eV.eb,{value:"sms",children:"SMS"}),(0,s.jsx)(eV.eb,{value:"email",children:"Email"}),(0,s.jsx)(eV.eb,{value:"status_change",children:"Status Change"}),(0,s.jsx)(eV.eb,{value:"tag_update",children:"Tag Update"}),(0,s.jsx)(eV.eb,{value:"webhook",children:"Webhook"}),(0,s.jsx)(eV.eb,{value:"wait_for_event",children:"Wait for Event"}),(0,s.jsx)(eV.eb,{value:"conditional_branch",children:"Conditional Branch"}),(0,s.jsx)(eV.eb,{value:"lead_assignment",children:"Lead Assignment"}),(0,s.jsx)(eV.eb,{value:"data_update",children:"Data Update"}),(0,s.jsx)(eV.eb,{value:"journey_transfer",children:"Journey Transfer"}),(0,s.jsx)(eV.eb,{value:"delay",children:"Delay"})]})]})]}),(0,s.jsxs)("div",{className:"border border-gray-200 rounded-md p-3 bg-white",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Action Configuration"}),(0,s.jsxs)("div",{className:"space-y-3",children:[W.filter(e=>!e.id.startsWith("ivr")||"ivrEnabled"===e.id).map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),ea(e,u.actionConfig?.[e.id],Q),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id)),0===W.filter(e=>!e.id.startsWith("ivr")||"ivrEnabled"===e.id).length&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No configuration needed for this action type."})]})]}),"call"===u.actionType&&u.actionConfig?.ivrEnabled&&(0,s.jsxs)("div",{className:"border border-blue-200 rounded-md p-3 bg-blue-50",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-3",children:"IVR Configuration"}),(0,s.jsx)("div",{className:"space-y-3",children:W.filter(e=>e.id.startsWith("ivr")&&"ivrEnabled"!==e.id).map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),ea(e,u.actionConfig?.[e.id],Q),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"delayType",children:"Delay Type"}),(0,s.jsxs)(eV.l6,{value:u.delayType,onValueChange:e=>{let t=eW(e);p(r=>({...r,delayType:e,delayConfig:t}))},children:[(0,s.jsx)(eV.bq,{id:"delayType",children:(0,s.jsx)(eV.yv,{placeholder:"Select delay type"})}),(0,s.jsxs)(eV.gC,{children:[(0,s.jsx)(eV.eb,{value:"immediate",children:"Immediate"}),(0,s.jsx)(eV.eb,{value:"fixed_time",children:"Fixed Time"}),(0,s.jsx)(eV.eb,{value:"delay_after_previous",children:"Delay After Previous"}),(0,s.jsx)(eV.eb,{value:"delay_after_enrollment",children:"Delay After Enrollment"}),(0,s.jsx)(eV.eb,{value:"specific_days",children:"Specific Days"})]})]})]}),B.length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-md p-3 bg-white",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Delay Configuration"}),(0,s.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsxs)(N.J,{htmlFor:e.id,children:[e.name,e.required?" *":""]}),ea(e,u.delayConfig?.[e.id],ee),e.description&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.description})]},e.id))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"isActive",checked:u.isActive,onCheckedChange:e=>Y("isActive",!!e)}),(0,s.jsx)(N.J,{htmlFor:"isActive",children:"Active"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"isExitPoint",checked:u.isExitPoint,onCheckedChange:e=>Y("isExitPoint",!!e)}),(0,s.jsx)(N.J,{htmlFor:"isExitPoint",children:"Exit Point (Journey ends after this step)"})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-4 border-t border-gray-200",children:[(0,s.jsxs)(g.$,{variant:"destructive",onClick:er,disabled:y,className:"flex items-center gap-1",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"}),y?"Deleting...":"Delete Step"]}),(0,s.jsxs)(g.$,{onClick:et,disabled:m,className:"flex items-center gap-1",children:[(0,s.jsx)(eZ.A,{className:"h-4 w-4"}),m?"Saving...":"Save Changes"]})]})]}),O&&P&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Email Preview"}),(0,s.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>F(!1),children:"Close"})]}),(0,s.jsxs)("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-120px)]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{className:"text-sm font-medium text-gray-700",children:"Subject"}),(0,s.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded border text-sm",children:P.subject})]}),(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex border-b",children:[(0,s.jsx)("button",{className:`px-4 py-2 text-sm font-medium border-r ${"html"===U?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"}`,onClick:()=>z("html"),children:"HTML Preview"}),(0,s.jsx)("button",{className:`px-4 py-2 text-sm font-medium ${"text"===U?"bg-blue-50 text-blue-700":"bg-gray-50 text-gray-700"}`,onClick:()=>z("text"),children:"Text Version"})]}),"html"===U&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"border rounded bg-white min-h-[400px]",children:P.htmlContent?(0,s.jsx)("div",{className:"h-full",children:P.htmlContent.includes("<html>")||P.htmlContent.includes("<body>")?(0,s.jsx)("iframe",{srcDoc:P.htmlContent,className:"w-full h-[500px] border-0 rounded",title:"Email HTML Preview",style:{minHeight:"400px"}}):(0,s.jsx)("div",{className:"p-6 overflow-auto max-h-[500px]",children:(0,s.jsx)("div",{className:"prose prose-sm max-w-none leading-relaxed",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},dangerouslySetInnerHTML:{__html:P.htmlContent}})})}):P.textContent?(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4 italic",children:"No HTML content available. Showing text content:"}),(0,s.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},children:P.textContent})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-[400px] text-gray-500 italic",children:"No HTML content available"})})}),"text"===U&&(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"border rounded bg-gray-50 min-h-[400px]",children:(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 leading-relaxed font-sans",style:{lineHeight:"1.6",fontSize:"14px",fontFamily:"system-ui, -apple-system, sans-serif"},children:P.textContent||"No text content available"})})})})]}),(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Sample Variables Used"}),(0,s.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"firstName:"})," John"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"lastName:"})," Doe"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"email:"})," john.doe@example.com"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"phone:"})," +1234567890"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"company:"})," Example Company"]})]})]})]})]})})]})};function eY({params:e}){let t=(0,i.useRouter)(),{isAuthenticated:r}=(0,k.n)(),n=parseInt(e.id,10),[S,T]=(0,a.useState)(null),[E,_]=(0,a.useState)([]),[q,I]=(0,a.useState)([]),[D,L]=(0,a.useState)(!0),[R,M]=(0,a.useState)("builder"),[P,$]=(0,a.useState)(!1),[O,F]=(0,a.useState)(!1),[J,V]=(0,a.useState)(null),[U,z]=(0,a.useState)(!1),[H,W]=(0,a.useState)(!1),[B,G]=(0,a.useState)({brands:[],sources:[],leadStatus:[],leadTags:[],leadAgeDays:{min:void 0,max:void 0}}),[Z,K]=(0,a.useState)(""),[X,Y]=(0,a.useState)(""),[Q,ee]=(0,a.useState)(""),[et,er]=(0,a.useState)(""),[es,ea]=(0,a.useState)(100),[ei,en]=(0,a.useState)(!1),[el,ed]=(0,a.useState)(null),[eo,ec]=(0,a.useState)({name:"",description:"",isActive:!0,autoEnroll:!0,leadStatus:[],leadTags:[]}),eu=async()=>{try{L(!0);let e=await (0,A.Hx)(n);if(T(e),e.steps)_(e.steps);else{let e=await (0,A._l)(n);_(e)}let t=await (0,A.MF)(n,{limit:10});I(t.leads||[])}catch(e){console.error("Error fetching journey details:",e),d.Ay.error("Failed to load journey details")}finally{L(!1)}},ep=async()=>{if(S)try{await (0,A.Qf)(n,{isActive:!S.isActive}),d.Ay.success(`Journey ${S.isActive?"paused":"activated"} successfully`),eu()}catch(e){console.error("Error updating journey status:",e),d.Ay.error("Failed to update journey status")}},em=async()=>{if(S)try{z(!0),await (0,A.Qf)(S.id,{name:eo.name,description:eo.description,isActive:eo.isActive,triggerCriteria:{leadStatus:eo.leadStatus,leadTags:eo.leadTags,autoEnroll:eo.autoEnroll}}),d.Ay.success("Journey updated successfully"),$(!1),eu()}catch(e){console.error("Error updating journey:",e),d.Ay.error("Failed to update journey")}finally{z(!1)}},ex=async()=>{if(S)try{z(!0),await (0,A.sg)(S.id),d.Ay.success("Journey deleted successfully"),t.push("/journeys")}catch(e){console.error("Error deleting journey:",e),d.Ay.error("Failed to delete journey"),z(!1),F(!1)}},eh=()=>{Z&&!B.brands?.includes(Z)&&(G({...B,brands:[...B.brands||[],Z]}),K(""))},eg=e=>{G({...B,brands:B.brands?.filter(t=>t!==e)||[]})},ey=()=>{X&&!B.sources?.includes(X)&&(G({...B,sources:[...B.sources||[],X]}),Y(""))},ef=e=>{G({...B,sources:B.sources?.filter(t=>t!==e)||[]})},ej=()=>{Q&&!B.leadStatus?.includes(Q)&&(G({...B,leadStatus:[...B.leadStatus||[],Q]}),ee(""))},ev=e=>{G({...B,leadStatus:B.leadStatus?.filter(t=>t!==e)||[]})},eb=()=>{G({brands:[],sources:[],leadStatus:[],leadTags:[],leadAgeDays:{min:void 0,max:void 0}}),K(""),Y(""),ee(""),er(""),ea(100),en(!1)},eN=async()=>{try{z(!0);let e=await (0,A.s5)(n,{criteria:B,restart:ei,limit:es});d.Ay.success(`Successfully enrolled ${e.enrolledCount} leads`),W(!1),eb(),eu()}catch(e){console.error("Error enrolling leads:",e),d.Ay.error("Failed to enroll leads")}finally{z(!1)}};return r&&S?(0,s.jsxs)(h.A,{children:[(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l(),{href:"/journeys",children:(0,s.jsx)(g.$,{variant:"ghost",className:"mr-4",children:(0,s.jsx)(o.A,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:S.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:S.description})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(g.$,{variant:"outline",onClick:()=>W(!0),children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Bulk Enroll"]}),(0,s.jsx)(g.$,{variant:S.isActive?"outline":"default",onClick:ep,children:S.isActive?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Pause"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Activate"]})}),(0,s.jsxs)(g.$,{variant:"outline",onClick:()=>{S&&(ec({name:S.name,description:S.description,isActive:S.isActive,autoEnroll:S.triggerCriteria.autoEnroll,leadStatus:S.triggerCriteria.leadStatus||[],leadTags:S.triggerCriteria.leadTags||[]}),$(!0))},children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,s.jsxs)(g.$,{variant:"destructive",onClick:()=>F(!0),children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),(0,s.jsxs)(C.tU,{value:R,onValueChange:M,className:"w-full mt-6",children:[(0,s.jsxs)(C.j7,{className:"grid w-full grid-cols-3",children:[(0,s.jsx)(C.Xi,{value:"builder",children:"Flow Builder"}),(0,s.jsx)(C.Xi,{value:"overview",children:"Overview"}),(0,s.jsx)(C.Xi,{value:"leads",children:"Leads"})]}),(0,s.jsx)(C.av,{value:"builder",className:"mt-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Journey Flow"}),(0,s.jsx)(eJ,{journey:S,onJourneyUpdated:eu,onSelectStep:V,selectedStep:J})]})}),(0,s.jsx)("div",{children:J?(0,s.jsx)(eX,{step:J,journeyId:n,onStepUpdated:eu,onStepDeleted:()=>{eu(),V(null)}}):(0,s.jsxs)(f.Zp,{children:[(0,s.jsxs)(f.aR,{children:[(0,s.jsx)(f.ZB,{children:"Step Properties"}),(0,s.jsx)(f.BT,{children:"Select a step in the flow builder to edit its properties"})]}),(0,s.jsx)(f.Wu,{children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Click on any step in the flow to view and edit its properties. You can also add new steps using the + button in the flow builder."})})]})})]})}),(0,s.jsx)(C.av,{value:"overview",className:"mt-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)(f.Zp,{children:[(0,s.jsx)(f.aR,{className:"pb-2",children:(0,s.jsx)(f.ZB,{children:"Status"})}),(0,s.jsxs)(f.Wu,{children:[(0,s.jsx)(y.E,{variant:S.isActive?"default":"secondary",className:"text-sm",children:S.isActive?"Active":"Paused"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-2",children:["Last updated: ",new Date(S.updatedAt).toLocaleString()]})]})]}),(0,s.jsxs)(f.Zp,{children:[(0,s.jsx)(f.aR,{className:"pb-2",children:(0,s.jsx)(f.ZB,{children:"Leads"})}),(0,s.jsx)(f.Wu,{children:(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:S.activeLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Active"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:S.completedLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Completed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold",children:S.failedLeadsCount||0}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Failed"})]})]})})]}),(0,s.jsxs)(f.Zp,{children:[(0,s.jsx)(f.aR,{className:"pb-2",children:(0,s.jsx)(f.ZB,{children:"Enrollment Criteria"})}),(0,s.jsx)(f.Wu,{children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Auto-enrollment:"}),(0,s.jsx)("p",{className:"text-sm",children:S.triggerCriteria.autoEnroll?"Enabled":"Disabled"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Lead Status:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:S.triggerCriteria.leadStatus?.length?S.triggerCriteria.leadStatus.map(e=>(0,s.jsx)(y.E,{variant:"outline",className:"text-xs",children:e},e)):(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Any"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Lead Tags:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:S.triggerCriteria.leadTags?.length?S.triggerCriteria.leadTags.map(e=>(0,s.jsx)(y.E,{variant:"outline",className:"text-xs",children:e},e)):(0,s.jsx)("span",{className:"text-sm text-gray-500",children:"Any"})})]})]})})]})]})}),(0,s.jsx)(C.av,{value:"leads",className:"mt-6",children:(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,s.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Enrolled Leads"}),(0,s.jsx)(l(),{href:`/journeys/${n}/leads`,children:(0,s.jsxs)(g.$,{children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Manage Leads"]})})]})}),0===q.length?(0,s.jsxs)("div",{className:"p-6 text-center",children:[(0,s.jsx)("p",{className:"text-gray-500",children:D?"Loading leads...":"No leads enrolled in this journey"}),!D&&(0,s.jsx)(g.$,{variant:"outline",className:"mt-4",onClick:eu,children:"Retry Loading Leads"})]}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Lead"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Step"}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Next Execution"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:q.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.Lead?(0,s.jsx)(l(),{href:`/leads/${e.leadId}`,className:"hover:underline",children:e.Lead.name}):`Lead #${e.leadId}`}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.Lead?.phone})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)(y.E,{variant:"active"===e.status?"default":"paused"===e.status?"secondary":"completed"===e.status?"outline":"destructive",className:"text-xs",children:e.status})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.currentStep?e.currentStep.name:"N/A"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.nextExecutionTime?new Date(e.nextExecutionTime).toLocaleString():"Not scheduled"})]},e.id))})]})}),q.length>0&&(0,s.jsx)("div",{className:"px-6 py-4 border-t border-gray-200",children:(0,s.jsx)(l(),{href:`/journeys/${n}/leads`,className:"text-sm text-indigo-600 hover:text-indigo-900",children:"View all enrolled leads "})})]})})]})]}),(0,s.jsx)(j.lG,{open:P,onOpenChange:$,children:(0,s.jsxs)(j.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(j.c7,{children:(0,s.jsx)(j.L3,{children:"Edit Journey"})}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{htmlFor:"edit-name",children:"Name"}),(0,s.jsx)(v.p,{id:"edit-name",value:eo.name,onChange:e=>ec({...eo,name:e.target.value}),placeholder:"Journey name"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{htmlFor:"edit-description",children:"Description"}),(0,s.jsx)(b.T,{id:"edit-description",value:eo.description,onChange:e=>ec({...eo,description:e.target.value}),placeholder:"Journey description"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsxs)(N.J,{htmlFor:"edit-isActive",className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",id:"edit-isActive",checked:eo.isActive,onChange:e=>ec({...eo,isActive:e.target.checked}),className:"form-checkbox h-4 w-4 text-indigo-600"}),"Active"]})}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsxs)(N.J,{htmlFor:"edit-autoEnroll",className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",id:"edit-autoEnroll",checked:eo.autoEnroll,onChange:e=>ec({...eo,autoEnroll:e.target.checked}),className:"form-checkbox h-4 w-4 text-indigo-600"}),"Auto-enroll matching leads"]})})]}),(0,s.jsxs)(j.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>$(!1),children:"Cancel"}),(0,s.jsx)(g.$,{onClick:em,disabled:!eo.name||U,children:U?"Updating...":"Update Journey"})]})]})}),(0,s.jsx)(j.lG,{open:O,onOpenChange:F,children:(0,s.jsxs)(j.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(j.c7,{children:(0,s.jsx)(j.L3,{children:"Delete Journey"})}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("p",{className:"text-gray-500",children:['Are you sure you want to delete the journey "',S?.name,'"? This action cannot be undone.']})}),(0,s.jsxs)(j.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),(0,s.jsx)(g.$,{variant:"destructive",onClick:ex,disabled:U,children:U?"Deleting...":"Delete Journey"})]})]})}),(0,s.jsx)(j.lG,{open:H,onOpenChange:W,children:(0,s.jsxs)(j.Cf,{className:"sm:max-w-lg",children:[(0,s.jsx)(j.c7,{children:(0,s.jsx)(j.L3,{children:"Bulk Enroll Leads"})}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Enroll leads that match the specified criteria in this journey."}),el&&(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md mb-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Matching Statistics"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[el.matchingLeads," out of ",el.totalLeads," leads match the current journey criteria"]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Age Criteria (Days)"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"bulk-minAge",className:"text-xs",children:"Minimum Age"}),(0,s.jsx)(v.p,{id:"bulk-minAge",type:"number",value:B.leadAgeDays?.min!==void 0?B.leadAgeDays.min:"",onChange:e=>{let t=e.target.value?parseInt(e.target.value,10):void 0;G({...B,leadAgeDays:{...B.leadAgeDays,min:t}})},placeholder:"Min days",min:0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(N.J,{htmlFor:"bulk-maxAge",className:"text-xs",children:"Maximum Age"}),(0,s.jsx)(v.p,{id:"bulk-maxAge",type:"number",value:B.leadAgeDays?.max!==void 0?B.leadAgeDays.max:"",onChange:e=>{let t=e.target.value?parseInt(e.target.value,10):void 0;G({...B,leadAgeDays:{...B.leadAgeDays,max:t}})},placeholder:"Max days",min:0})]})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Brands"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v.p,{value:Z,onChange:e=>K(e.target.value),placeholder:"Add brand",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),eh())}),(0,s.jsx)(g.$,{type:"button",onClick:eh,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:B.brands?.map(e=>s.jsxs(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,s.jsx("button",{type:"button",onClick:()=>eg(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Sources"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v.p,{value:X,onChange:e=>Y(e.target.value),placeholder:"Add source",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),ey())}),(0,s.jsx)(g.$,{type:"button",onClick:ey,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:B.sources?.map(e=>s.jsxs(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,s.jsx("button",{type:"button",onClick:()=>ef(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Lead Status"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(v.p,{value:Q,onChange:e=>ee(e.target.value),placeholder:"Add status",onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),ej())}),(0,s.jsx)(g.$,{type:"button",onClick:ej,variant:"secondary",children:"Add"})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:B.leadStatus?.map(e=>s.jsxs(y.E,{variant:"outline",className:"flex items-center gap-1",children:[e,s.jsx("button",{type:"button",onClick:()=>ev(e),className:"ml-1 text-gray-500 hover:text-gray-700",children:"\xd7"})]},e))})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(N.J,{children:"Max Leads to Enroll"}),(0,s.jsx)(v.p,{type:"number",value:es,onChange:e=>ea(parseInt(e.target.value,10)||100),min:1,max:500}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Maximum number of leads to enroll in one operation (1-500)"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w.S,{id:"restart-enrollment",checked:ei,onCheckedChange:e=>en(e)}),(0,s.jsx)(N.J,{htmlFor:"restart-enrollment",children:"Restart for leads already in journey"})]})]})]}),(0,s.jsxs)(j.Es,{children:[(0,s.jsx)(g.$,{variant:"outline",onClick:()=>{W(!1),eb()},children:"Cancel"}),(0,s.jsx)(g.$,{onClick:eN,disabled:U,children:U?"Enrolling...":"Enroll Leads"})]})]})})]}):(0,s.jsx)(h.A,{children:(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)(l(),{href:"/journeys",children:(0,s.jsx)(g.$,{variant:"ghost",className:"mr-4",children:(0,s.jsx)(o.A,{className:"h-5 w-5"})})}),(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:D?"Loading journey...":"Journey not found"})]}),D&&(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand"})})]})})}},59010:(e,t,r)=>{"use strict";r.d(t,{S:()=>d});var s=r(45512),a=r(58009),i=r(2112),n=r(24849),l=r(89808);let d=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.bL,{ref:r,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:(0,s.jsx)(i.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})}));d.displayName=i.bL.displayName},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64985:(e,t,r)=>{"use strict";r.d(t,{Xi:()=>o,av:()=>c,j7:()=>d,tU:()=>l});var s=r(45512),a=r(58009),i=r(29248),n=r(89808);let l=i.bL,d=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.B8,{ref:r,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));d.displayName=i.B8.displayName;let o=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.l9,{ref:r,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));o.displayName=i.l9.displayName;let c=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.UC,{ref:r,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));c.displayName=i.UC.displayName},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83683:(e,t,r)=>{Promise.resolve().then(r.bind(r,57141))},83997:e=>{"use strict";e.exports=require("tty")},87565:(e,t,r)=>{"use strict";r.d(t,{Cf:()=>u,Es:()=>m,L3:()=>x,c7:()=>p,lG:()=>d});var s=r(45512),a=r(58009),i=r(27553),n=r(44269),l=r(89808);let d=i.bL;i.l9;let o=i.ZL;i.bm;let c=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.hJ,{ref:r,className:(0,l.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));c.displayName=i.hJ.displayName;let u=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(o,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(i.UC,{ref:a,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,(0,s.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));u.displayName=i.UC.displayName;let p=({className:e,...t})=>(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});p.displayName="DialogHeader";let m=({className:e,...t})=>(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});m.displayName="DialogFooter";let x=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.hE,{ref:r,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));x.displayName=i.hE.displayName,a.forwardRef(({className:e,...t},r)=>(0,s.jsx)(i.VY,{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",e),...t})).displayName=i.VY.displayName},87851:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Applications/Knittt-Lite-v2/app/(app)/journeys/[id]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Applications/Knittt-Lite-v2/app/(app)/journeys/[id]/page.tsx","default")},89972:(e,t,r)=>{"use strict";r.d(t,{E:()=>l});var s=r(45512);r(58009);var a=r(21643),i=r(7702);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,...r}){return(0,s.jsx)("div",{className:(0,i.cn)(n({variant:t}),e),...r})}},92557:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},94735:e=>{"use strict";e.exports=require("events")},94937:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,1057,4052,5668,7519,6572,9388,1109,4451,3715,9248,1542,5574,4404,931,3868,9110,4883],()=>r(53505));module.exports=s})();