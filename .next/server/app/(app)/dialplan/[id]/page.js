(()=>{var e={};e.id=6729,e.ids=[6729],e.modules={1873:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,pages:()=>c,routeModule:()=>u,tree:()=>l});var a=r(70260),n=r(28203),s=r(25155),o=r.n(s),i=r(67292),d={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);r.d(t,d);let l={children:["",{children:["(app)",{children:["dialplan",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,76775)),"/Applications/Knittt-Lite-v2/app/(app)/dialplan/[id]/page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,19611)),"/Applications/Knittt-Lite-v2/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Applications/Knittt-Lite-v2/app/(app)/dialplan/[id]/page.tsx"],p={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/(app)/dialplan/[id]/page",pathname:"/dialplan/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7702:(e,t,r)=>{"use strict";r.d(t,{cn:()=>s});var a=r(82281),n=r(94805);function s(...e){return(0,n.QP)((0,a.$)(e))}},8818:(e,t,r)=>{"use strict";r.d(t,{AC:()=>g,BL:()=>d,ES:()=>s,OK:()=>m,RM:()=>u,U$:()=>b,YE:()=>h,aN:()=>f,ac:()=>n,cV:()=>w,g5:()=>x,gA:()=>o,ht:()=>l,mJ:()=>p,q6:()=>c,tq:()=>y,v:()=>v,xx:()=>i});var a=r(66581);let n=async()=>(await a.Ay.get("/dialplan/projects")).data,s=async e=>(await a.Ay.get(`/dialplan/projects/${e}`)).data,o=async e=>(await a.Ay.post("/dialplan/projects",e)).data,i=async e=>(await a.Ay.delete(`/dialplan/projects/${e}`)).data,d=async(e,t)=>(await a.Ay.post(`/dialplan/projects/${e}/clone`,{newName:t})).data,l=async e=>(await a.Ay.get(`/dialplan/projects/${e}/contexts`)).data,c=async(e,t)=>(await a.Ay.post(`/dialplan/projects/${e}/contexts`,t)).data,p=async e=>(await a.Ay.get(`/dialplan/contexts/${e}/nodes`)).data,u=async(e,t)=>{try{console.log("Creating node with data:",{contextId:e,data:t});let r=await a.Ay.post(`/dialplan/contexts/${e}/nodes`,t);return console.log("Node creation successful:",r.data),r.data}catch(e){throw console.error("Node creation failed:",e.response?.data||e.message||e),e}},m=async(e,t)=>(await a.Ay.put(`/dialplan/nodes/${e}`,t)).data,g=async e=>{try{if(console.log("Deleting node with ID:",e),!e||isNaN(e))throw Error("Invalid node ID");try{let t=await a.Ay.delete(`/dialplan/nodes/${e}`);return console.log("Node deletion successful:",t.data),t.data}catch(t){if(t.response?.status===404){console.warn("Standard delete endpoint not found, trying alternate endpoint...");let t=await a.Ay.post("/dialplan/nodes/delete",{id:e});return console.log("Node deletion successful with fallback:",t.data),t.data}throw t}}catch(r){r.response?console.error("Node deletion failed with response:",{status:r.response.status,data:r.response.data,headers:r.response.headers}):r.request?console.error("Node deletion failed - no response received:",r.request):console.error("Node deletion failed - error setting up request:",r.message);let e="Failed to delete node";r.response?.status===404?e="The node delete endpoint was not found on the server. The API may not be fully implemented.":r.message&&(e=r.message);let t=Error(e);throw t.cause=r,t}},x=async()=>(await a.Ay.get("/dialplan/node-types")).data,h=async e=>(await a.Ay.get(`/dialplan/contexts/${e}/connections`)).data,y=async e=>{try{console.log("Creating connection with data:",e);let t=await a.Ay.post("/dialplan/connections",e);return console.log("Connection creation successful:",t.data),t.data}catch(e){throw console.error("Connection creation failed:",e.response?.data||e.message||e),e}},f=async e=>{try{if(console.log("Deleting connection with ID:",e),!e||isNaN(e))throw Error("Invalid connection ID");try{let t=await a.Ay.delete(`/dialplan/connections/${e}`);return console.log("Connection deletion successful:",t.data),t.data}catch(t){if(t.response?.status===404){console.warn("Standard connection delete endpoint not found, trying alternate endpoint...");let t=await a.Ay.post("/dialplan/connections/delete",{id:e});return console.log("Connection deletion successful with fallback:",t.data),t.data}throw t}}catch(r){r.response?console.error("Connection deletion failed with response:",{status:r.response.status,data:r.response.data}):r.request?console.error("Connection deletion failed - no response received:",r.request):console.error("Connection deletion failed - error setting up request:",r.message);let e="Failed to delete connection";r.response?.status===404?e="The connection delete endpoint was not found on the server. The API may not be fully implemented.":r.message&&(e=r.message);let t=Error(e);throw t.cause=r,t}},b=async e=>{try{return(await a.Ay.post(`/dialplan/projects/${e}/validate`)).data}catch(e){return console.warn("Validate project endpoint may not be implemented yet"),{valid:!0,errors:[],warnings:[],timestamp:new Date().toISOString()}}},v=async e=>{try{return(await a.Ay.post(`/dialplan/projects/${e}/generate`)).data}catch(e){return console.warn("Generate dialplan endpoint may not be implemented yet"),{dialplan:"[default]\nexten => s,1,NoOp(Demo Dialplan)\nexten => s,n,Hangup()",project:"Demo Project",contexts:1,timestamp:new Date().toISOString()}}},w=async()=>(await a.Ay.get("/system/dialplan-capabilities")).data},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},18741:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(41680).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21367:(e,t,r)=>{Promise.resolve().then(r.bind(r,76775))},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},49169:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var a=r(45512),n=r(58009),s=r(7702);let o=n.forwardRef(({className:e,type:t,label:r,error:n,...o},i)=>(0,a.jsxs)("div",{className:"w-full",children:[r&&(0,a.jsx)("label",{htmlFor:o.id,className:"block text-sm font-medium text-gray-700 mb-1",children:r}),(0,a.jsx)("input",{type:t,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n?"border-red-500 focus-visible:ring-red-500":"",e),ref:i,...o}),n&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:n})]}));o.displayName="Input"},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58159:(e,t,r)=>{Promise.resolve().then(r.bind(r,98684))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76775:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Applications/Knittt-Lite-v2/app/(app)/dialplan/[id]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Applications/Knittt-Lite-v2/app/(app)/dialplan/[id]/page.tsx","default")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},94735:e=>{"use strict";e.exports=require("events")},97832:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(41680).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},98684:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>G});var a=r(45512),n=r(58009),s=r(79334),o=r(22403),i=r(35668),d=r(18741),l=r(13868),c=r(43517),p=r(8818),u=r(98145),m=r(22387),g=r(67625),x=r(82040);r(17163);var h={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},y=n.createContext&&n.createContext(h),f=["attr","size","title"];function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach(function(t){var a,n,s;a=e,n=t,s=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in a?Object.defineProperty(a,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[n]=s}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function j(e){var t=t=>{var r,{attr:a,size:s,title:o}=e,i=function(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;r[a]=e[a]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,f),d=s||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",b({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,i,{className:r,style:w(w({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),o&&n.createElement("title",null,o),e.children)};return void 0!==y?n.createElement(y.Consumer,null,e=>t(e)):t(h)}function N(e){var t;return(t={tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"},child:[]}]},e=>n.createElement(j,b({attr:w({},t.attr)},e),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,w({key:r},t.attr),e(t.child)))}(t.child)))(e)}let C=e=>{switch(e){case"extension":return"#3b82f6";case"application":return"#10b981";case"flowcontrol":return"#8b5cf6";case"action":return"#f97316";case"terminal":return"#ef4444";default:return"#6b7280"}},k=(0,n.memo)(({id:e,data:t,selected:r})=>{let{label:n,nodeType:s,properties:o={}}=t,i=C(s?.category||"application"),d=s?.inputHandles===void 0||s?.inputHandles>0,l=s?.outputHandles===void 0||s?.outputHandles>0,c=t.isEntry||s?.category==="extension"||(s?.name?.toLowerCase()||"").includes("entry"),p=t.isExit||s?.category==="terminal"||(s?.name?.toLowerCase()||"").includes("exit")||(s?.name?.toLowerCase()||"").includes("hangup"),m=Object.keys(o).length>0,g=!0===t.isTemp;return(0,a.jsxs)("div",{className:`px-4 py-2 shadow-md rounded-md border-2 w-48 ${r?"border-blue-500 bg-blue-50":g?"border-dashed border-gray-400 bg-gray-50":c?"border-green-500 bg-green-50":p?"border-red-500 bg-red-50":"border-gray-300 bg-white"}`,children:[d&&!c&&(0,a.jsx)(u.h7,{type:"target",position:u.yX.Top,className:"w-3 h-3 rounded-full bg-blue-500"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full mb-2",style:{backgroundColor:i}}),g&&(0,a.jsx)("div",{className:"text-xs bg-yellow-200 text-yellow-800 px-1 rounded-sm mb-1",children:"New"}),c&&(0,a.jsx)("div",{className:"text-xs bg-green-200 text-green-800 px-1 rounded-sm mb-1",children:"Entry"}),p&&(0,a.jsx)("div",{className:"text-xs bg-red-200 text-red-800 px-1 rounded-sm mb-1",children:"Exit"}),m&&!g&&(0,a.jsxs)("div",{className:"text-xs flex items-center text-blue-600 mb-1",children:[(0,a.jsx)(N,{size:12,className:"mr-1"}),"Config"]})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("div",{className:"text-sm font-bold truncate",title:n,children:n})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Type: ",s?.name||"Unknown"]}),m?(0,a.jsxs)("div",{className:"text-xs text-gray-600 mt-1 truncate",children:[Object.entries(o).map(([e,t])=>"string"==typeof t||"number"==typeof t||"boolean"==typeof t?(0,a.jsxs)("div",{className:"truncate",children:[e,": ",String(t)]},e):null).filter(Boolean).slice(0,2),Object.keys(o).length>2&&(0,a.jsx)("div",{children:"..."})]}):null]}),l&&!p&&(0,a.jsx)(u.h7,{type:"source",position:u.yX.Bottom,className:"w-3 h-3 rounded-full bg-blue-500"})]})}),T=({id:e,source:t,target:r,sourceX:n,sourceY:s,targetX:o,targetY:i,sourcePosition:d,targetPosition:l,style:c={},data:p,markerEnd:m,selected:g})=>{let[x,h,y]=(0,u.oN)({sourceX:n,sourceY:s,sourcePosition:d,targetX:o,targetY:i,targetPosition:l}),f=p?.condition,b=p?.priority??1,v=p?.isTemp===!0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.tE,{path:x,markerEnd:m,style:(()=>{let e={...c,strokeWidth:2};return g?{...e,stroke:"#3b82f6",strokeWidth:3}:v?{...e,stroke:"#f59e0b",strokeDasharray:"5,5"}:{...e,stroke:"#64748b"}})()}),(f||b>1)&&(0,a.jsx)(u.rV,{children:(0,a.jsxs)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${h}px, ${y}px)`,fontSize:12,pointerEvents:"all"},className:`px-2 py-1 rounded border shadow-sm ${v?"bg-amber-50 border-amber-200":"bg-white border-gray-200"}`,children:[f&&(0,a.jsx)("span",{className:"font-medium",children:f}),f&&b>1&&(0,a.jsx)("span",{className:"mx-1",children:"|"}),b>1&&(0,a.jsxs)("span",{className:"text-gray-500",children:["Priority: ",b]}),v&&(0,a.jsx)("span",{className:"text-amber-500 ml-1 text-xs",children:"(not saved)"})]})})]})};var A=r(33680),S=r(44269);let I={extension:"bg-blue-100 border-blue-500 text-blue-700",application:"bg-green-100 border-green-500 text-green-700",flowcontrol:"bg-purple-100 border-purple-500 text-purple-700",action:"bg-orange-100 border-orange-500 text-orange-700",terminal:"bg-red-100 border-red-500 text-red-700"},P={extension:"\uD83D\uDCDE",application:"\uD83D\uDD27",flowcontrol:"\uD83D\uDD04",action:"⚡",terminal:"\uD83D\uDED1"};function D({nodeTypes:e}){let t=e.reduce((e,t)=>{let r=t.category||"application";return e[r]||(e[r]=[]),e[r].push(t),e},{}),r=(e,t)=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(t)),e.dataTransfer.effectAllowed="move"},n=Object.keys(t).sort((e,t)=>{let r=["extension","application","flowcontrol","action","terminal"];return r.indexOf(e)-r.indexOf(t)});return(0,a.jsxs)("div",{className:"w-64",children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2 px-2",children:"Node Types"}),0===e.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 p-2",children:"No node types available. Please check API configuration."}):n.map(e=>(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h4",{className:"text-xs font-semibold uppercase text-gray-600 mb-1 px-2",children:[P[e]," ",e]}),(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t[e].map(e=>(0,a.jsx)("div",{className:`border px-3 py-2 rounded text-sm cursor-grab ${I[e.category]||"bg-gray-100 border-gray-300"}`,draggable:!0,onDragStart:t=>r(t,e),title:e.description,children:e.name},e.id))})]},e)),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-4 p-2 bg-gray-50 rounded border border-gray-200",children:"Drag nodes onto the canvas to create your dial plan."})]})}var E=r(49169),$=r(97832);let O=({htmlFor:e,children:t})=>(0,a.jsx)("label",{htmlFor:e,className:"block text-sm font-medium text-gray-700 mb-1",children:t}),q=({id:e,value:t,onChange:r,placeholder:n,className:s,rows:o=3})=>(0,a.jsx)("textarea",{id:e,value:t,onChange:r,placeholder:n,className:`px-3 py-2 bg-white text-black border border-gray-300 focus:ring-blue-500 focus:border-blue-500 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 w-full ${s||""}`,rows:o}),L=({id:e,checked:t,onCheckedChange:r})=>(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("button",{id:e,type:"button",className:`relative inline-flex h-6 w-11 items-center rounded-full ${t?"bg-blue-600":"bg-gray-200"}`,onClick:()=>r(!t),children:(0,a.jsx)("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition ${t?"translate-x-6":"translate-x-1"}`})})}),_=({value:e,onValueChange:t,children:r})=>(0,a.jsx)("select",{value:e,onChange:e=>t(e.target.value),className:"px-3 py-2 bg-white text-black border border-gray-300 focus:ring-blue-500 focus:border-blue-500 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 w-full",children:r}),F=({value:e,children:t})=>(0,a.jsx)("option",{value:e,children:t}),U=e=>{let{name:t,category:r}=e,a=[{id:"priority",name:"Priority",type:"number",required:!1,default:1,description:"Execution priority for this node"}];switch(r){case"extension":return[{id:"exten",name:"Extension",type:"string",required:!0,default:"s",description:"The extension pattern to match"},{id:"matchPattern",name:"Match Pattern",type:"select",required:!1,default:"exact",options:["exact","pattern","regex"],description:"How to match the extension"},...a];case"application":if(t?.toLowerCase().includes("dial"))return[{id:"technology",name:"Technology",type:"select",required:!0,default:"SIP",options:["SIP","PJSIP","IAX2","DAHDI","Local"],description:"The technology to use for dialing"},{id:"destination",name:"Destination",type:"string",required:!0,default:"",description:"The destination to dial (e.g., extension or phone number)"},{id:"timeout",name:"Timeout",type:"number",required:!1,default:30,description:"Timeout in seconds"},{id:"options",name:"Dial Options",type:"string",required:!1,default:"",description:'Additional dial options (e.g., "m" for music on hold)'},...a];if(t?.toLowerCase().includes("playback"))return[{id:"filename",name:"Filename",type:"string",required:!0,default:"",description:"Sound file to play (without extension)"},{id:"skip",name:"Skip if busy",type:"boolean",required:!1,default:!1,description:"Skip playback if channel is busy"},...a];if(t?.toLowerCase().includes("queue"))return[{id:"queueName",name:"Queue Name",type:"string",required:!0,default:"",description:"Name of the queue"},{id:"options",name:"Queue Options",type:"string",required:!1,default:"",description:"Queue options"},{id:"timeout",name:"Timeout",type:"number",required:!1,default:0,description:"Maximum wait time in seconds (0 for unlimited)"},...a];return[{id:"app",name:"Application",type:"string",required:!0,default:"",description:"The application name"},{id:"args",name:"Arguments",type:"string",required:!1,default:"",description:"Application arguments"},...a];case"flowcontrol":if(t?.toLowerCase().includes("goto"))return[{id:"context",name:"Context",type:"string",required:!1,default:"",description:"Destination context (blank for same context)"},{id:"exten",name:"Extension",type:"string",required:!0,default:"s",description:"Destination extension"},{id:"priority",name:"Priority",type:"string",required:!0,default:"1",description:"Destination priority"},...a];if(t?.toLowerCase().includes("if")||t?.toLowerCase().includes("condition"))return[{id:"expression",name:"Condition",type:"string",required:!0,default:"",description:"Expression to evaluate (e.g., ${CALLERID(num)} = 1234)"},...a];return[{id:"action",name:"Action",type:"string",required:!0,default:"",description:"Flow control action"},{id:"data",name:"Data",type:"string",required:!1,default:"",description:"Additional data for the action"},...a];case"terminal":if(t?.toLowerCase().includes("hangup"))return[{id:"cause",name:"Hangup Cause",type:"select",required:!1,default:"normal",options:["normal","busy","congestion","no_answer","decline","canceled"],description:"The reason for hanging up"},...a];return[{id:"action",name:"Action",type:"string",required:!0,default:"Hangup",description:"Terminal action"},...a];default:return[{id:"custom",name:"Custom Value",type:"string",required:!1,default:"",description:"Custom configuration value"},{id:"enabled",name:"Enabled",type:"boolean",required:!1,default:!0,description:"Enable/disable this node"},...a]}},z=({selectedNode:e,onUpdateNodeProperties:t,onUpdateNodeLabel:r,onClosePanel:s})=>{let[o,i]=(0,n.useState)({}),[d,l]=(0,n.useState)("");if((0,n.useEffect)(()=>{e&&(i(e.data.properties||{}),l(e.data.label||""))},[e]),!e)return null;let p=e.data.nodeType,u=p.paramDefs&&p.paramDefs.length>0?p.paramDefs:U(p),m=(e,t)=>{i(r=>({...r,[e]:t}))},g=e=>{let t=void 0!==o[e.id]?o[e.id]:e.default;switch(e.type){case"string":default:return(0,a.jsx)(E.p,{id:e.id,value:t||"",onChange:t=>m(e.id,t.target.value),placeholder:e.description||"",className:"w-full"});case"number":return(0,a.jsx)(E.p,{id:e.id,type:"number",value:t||0,onChange:t=>m(e.id,parseFloat(t.target.value)),placeholder:e.description||"",className:"w-full"});case"boolean":return(0,a.jsx)(L,{id:e.id,checked:!!t,onCheckedChange:t=>m(e.id,t)});case"select":return(0,a.jsx)(_,{value:t||"",onValueChange:t=>m(e.id,t),children:e.options?.map(e=>a.jsx(F,{value:e,children:e},e))})}};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow-md w-full max-h-full overflow-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Node Properties"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:s,children:(0,a.jsx)($.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-2 bg-gray-50 rounded-md",children:[(0,a.jsx)("div",{className:"text-sm font-semibold",children:p.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:p.description}),(0,a.jsx)("div",{className:"text-xs mt-1 bg-gray-200 inline-block px-2 py-0.5 rounded-full",children:p.category})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O,{htmlFor:"node-label",children:"Label"}),(0,a.jsx)(E.p,{id:"node-label",value:d,onChange:e=>l(e.target.value),placeholder:"Node label",className:"w-full"})]}),u.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium",children:"Parameters"}),u.map(e=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(O,{htmlFor:e.id,children:[e.name," ",e.required&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.description}),g(e)]},e.id))]}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No configurable parameters"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O,{htmlFor:"custom-properties",children:"Custom Properties (JSON)"}),(0,a.jsx)(q,{id:"custom-properties",value:JSON.stringify(o,null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);i(t)}catch(e){}},placeholder:"Custom properties in JSON format",className:"font-mono text-xs",rows:5})]}),(0,a.jsx)(c.$,{variant:"brand",fullWidth:!0,onClick:()=>{e&&(t(e.id,o),d!==e.data.label&&r(e.id,d))},children:"Apply Changes"})]})]})},W={customNode:k,default:k},M={customEdge:T,default:T};function V({nodes:e=[],edges:t=[],nodeTypes:r=[],contextId:s,onNodesChange:i,onEdgesChange:l,onSave:h,readOnly:y=!1}){let f=(0,n.useRef)(null),[b,v]=(0,n.useState)(!1),[w,j]=(0,n.useState)(!1),[N,C]=(0,n.useState)({nodesToCreate:[],nodesToUpdate:[],nodesToDelete:[],edgesToCreate:[],edgesToDelete:[]}),[k,T]=(0,n.useState)(-1);r.filter(e=>"extension"===e.category||e.name?.toLowerCase().includes("entry")),r.filter(e=>"terminal"===e.category||e.name?.toLowerCase().includes("exit")||e.name?.toLowerCase().includes("hangup"));let[I,P]=(0,n.useState)((e=>{if(!e||0===e.length)return console.log("No nodes provided to process"),[];console.log(`Processing ${e.length} nodes`,e);let t=[],a=[],n=[];e.forEach(e=>{let s=r.find(t=>t.id===e.nodeTypeId);if(!s){n.push(e);return}"extension"===s.category||s.name?.toLowerCase().includes("entry")?t.push(e):"terminal"===s.category||s.name?.toLowerCase().includes("exit")||s.name?.toLowerCase().includes("hangup")?a.push(e):n.push(e)}),console.log(`Found ${t.length} entry nodes, ${a.length} exit nodes, ${n.length} other nodes`);let s=Math.max(600,200*Math.max(t.length,a.length)),o=(s-200*t.length)/2,i=(s-200*a.length)/2;return[...t.map((e,t)=>({id:e.id.toString(),type:"customNode",position:{x:o+200*t,y:50},data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e,isEntry:!0}})),...n.map(e=>({id:e.id.toString(),type:"customNode",position:e.position,data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e}})),...a.map((e,t)=>({id:e.id.toString(),type:"customNode",position:{x:i+200*t,y:600},data:{label:e.label||e.name,nodeType:r.find(t=>t.id===e.nodeTypeId)||{id:e.nodeTypeId,name:"Unknown",category:"application",description:"Unknown node type"},properties:e.properties||{},dialplanNode:e,isExit:!0}}))]})(e)),[E,$,O]=(0,u.ck)(I),[q,L,_]=(0,u.fM)(t.map(e=>({id:e.id,source:e.source,target:e.target,label:e.label,type:"default",markerEnd:{type:u.TG.ArrowClosed},data:{condition:e.data?.condition||null,priority:e.data?.priority||1}}))),[F,U]=(0,n.useState)(null),[V,H]=(0,n.useState)(null),R=(0,n.useCallback)(()=>(T(e=>e-1),k.toString()),[k]),B=(0,n.useCallback)(e=>{if(!y&&s)try{if(!e.source||!e.target){console.error("Invalid connection - missing source or target");return}let t=R(),r={id:`temp_${t}`,source:e.source,target:e.target,type:"default",markerEnd:{type:u.TG.ArrowClosed},data:{condition:null,priority:1,isTemp:!0,sourceId:e.source,targetId:e.target}};C(r=>({...r,edgesToCreate:[...r.edgesToCreate,{tempId:`temp_${t}`,sourceNodeId:e.source,targetNodeId:e.target,condition:null,priority:1}]})),L(e=>(0,u.rN)(r,e)),o.Ay.success("Connection added (not saved yet)")}catch(e){console.error("Error creating local connection:",e),o.Ay.error("Failed to create connection")}},[s,y,L,R]),G=(0,n.useCallback)((e,t)=>{H(t),j(!0),v(!1)},[]),K=(0,n.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),J=(0,n.useCallback)(e=>{if(e.preventDefault(),y||!f.current||!F||!s)return;let t=f.current.getBoundingClientRect(),r=e.dataTransfer.getData("application/reactflow");if(r)try{let a=JSON.parse(r),n={...F.project({x:e.clientX-t.left,y:e.clientY-t.top})};if("extension"===a.category||a.name?.toLowerCase().includes("entry")){n.y=50;let e=E.filter(e=>e.data.isEntry||e.data.nodeType?.category==="extension"||e.data.nodeType?.name?.toLowerCase().includes("entry"));n.x=200*e.length+100}else if("terminal"===a.category||a.name?.toLowerCase().includes("exit")||a.name?.toLowerCase().includes("hangup")){n.y=600;let e=E.filter(e=>e.data.isExit||e.data.nodeType?.category==="terminal"||e.data.nodeType?.name?.toLowerCase().includes("exit")||e.data.nodeType?.name?.toLowerCase().includes("hangup"));n.x=200*e.length+100}let s=R(),i=`${a.name}_${Date.now()}`,d={tempId:`temp_${s}`,nodeTypeId:a.id,name:i,label:i,position:n,properties:a.defaultParams||{}};C(e=>({...e,nodesToCreate:[...e.nodesToCreate,d]}));let l={id:`temp_${s}`,type:"customNode",position:n,data:{label:i,nodeType:a,properties:a.defaultParams||{},isTemp:!0,isEntry:"extension"===a.category||a.name?.toLowerCase().includes("entry"),isExit:"terminal"===a.category||a.name?.toLowerCase().includes("exit")||a.name?.toLowerCase().includes("hangup")}};$(e=>[...e,l]),o.Ay.success("Node added (not saved yet)"),v(!1)}catch(e){console.error("Error creating node locally:",e),o.Ay.error("Failed to create node")}},[s,F,y,$,R,E]),X=(0,n.useCallback)((e,t)=>{!y&&(t.id.startsWith("temp_")||C(e=>({...e,nodesToUpdate:[...e.nodesToUpdate.filter(e=>e.id!==t.id),{id:t.id,position:t.position}]})),t.id.startsWith("temp_")&&C(e=>({...e,nodesToCreate:e.nodesToCreate.map(e=>e.tempId===t.id?{...e,position:t.position}:e)})))},[y]),Q=(0,n.useCallback)(e=>{if(y){console.log("Cannot delete node - readOnly mode is enabled");return}try{$(t=>t.filter(t=>t.id!==e)),e.startsWith("temp_")?C(t=>({...t,nodesToCreate:t.nodesToCreate.filter(t=>t.tempId!==e)})):C(t=>({...t,nodesToDelete:[...t.nodesToDelete,e]})),L(t=>(t.filter(t=>t.source===e||t.target===e).forEach(e=>{e.id.startsWith("temp_")?C(t=>({...t,edgesToCreate:t.edgesToCreate.filter(t=>t.tempId!==e.id)})):C(t=>({...t,edgesToDelete:[...t.edgesToDelete,e.id]}))}),t.filter(t=>t.source!==e&&t.target!==e))),o.Ay.success("Node removed (not saved yet)")}catch(e){console.error("Error removing node locally:",e),o.Ay.error("Failed to remove node")}},[y,$,L]),Z=(0,n.useCallback)(e=>{if(y){console.log("Cannot delete connection - readOnly mode is enabled");return}try{L(t=>t.filter(t=>t.id!==e.id)),e.id.startsWith("temp_")?C(t=>({...t,edgesToCreate:t.edgesToCreate.filter(t=>t.tempId!==e.id)})):C(t=>({...t,edgesToDelete:[...t.edgesToDelete,e.id]})),o.Ay.success("Connection removed (not saved yet)")}catch(e){console.error("Error removing connection locally:",e),o.Ay.error("Failed to remove connection")}},[y,L]);(0,n.useCallback)(e=>{!y&&("Delete"===e.key||"Backspace"===e.key)&&V&&(console.log("Delete key pressed, deleting selected node:",V.id),Q(V.id),H(null))},[y,V,Q]);let Y=(0,n.useCallback)((e,t)=>{$(r=>r.map(r=>r.id===e?{...r,data:{...r.data,properties:t}}:r)),e.startsWith("temp_")?C(r=>({...r,nodesToCreate:r.nodesToCreate.map(r=>r.tempId===e?{...r,properties:t}:r)})):C(r=>{let a=r.nodesToUpdate.findIndex(t=>t.id===e);if(!(a>=0))return{...r,nodesToUpdate:[...r.nodesToUpdate,{id:e,properties:t}]};{let e=[...r.nodesToUpdate];return e[a]={...e[a],properties:t},{...r,nodesToUpdate:e}}}),o.Ay.success("Properties updated (not saved yet)")},[$]),ee=(0,n.useCallback)((e,t)=>{$(r=>r.map(r=>r.id===e?{...r,data:{...r.data,label:t}}:r)),e.startsWith("temp_")?C(r=>({...r,nodesToCreate:r.nodesToCreate.map(r=>r.tempId===e?{...r,label:t}:r)})):C(r=>{let a=r.nodesToUpdate.findIndex(t=>t.id===e);if(!(a>=0))return{...r,nodesToUpdate:[...r.nodesToUpdate,{id:e,label:t}]};{let e=[...r.nodesToUpdate];return e[a]={...e[a],label:t},{...r,nodesToUpdate:e}}})},[$]),et=(0,n.useCallback)(()=>{v(e=>!e),b||(j(!1),H(null))},[b]),er=async()=>{if(y||!s){o.Ay.error("Cannot save - read-only mode or missing context");return}let e=o.Ay.loading("Saving changes...");try{let t={created:{nodes:0,edges:0},updated:{nodes:0},deleted:{nodes:0,edges:0},errors:{nodes:0,edges:0}},r=!1,a=await Promise.all(N.nodesToCreate.map(async e=>{try{let{tempId:r,...a}=e,n=await (0,p.RM)(s,a);return t.created.nodes++,{tempId:r,createdNode:n}}catch(a){return console.error("Failed to create node:",a),a.response?.status===404&&(r=!0),t.errors.nodes++,{tempId:e.tempId,error:a}}})),n={};a.forEach(e=>{e.error||(n[e.tempId]=e.createdNode.id.toString())}),await Promise.all(N.nodesToUpdate.map(async e=>{try{let r={};return e.position&&(r.position=e.position),e.properties&&(r.properties=e.properties),e.label&&(r.label=e.label),await (0,p.OK)(parseInt(e.id),r),t.updated.nodes++,{success:!0}}catch(e){return console.error("Failed to update node:",e),e.response?.status===404&&(r=!0),t.errors.nodes++,{error:e}}})),await Promise.all(N.edgesToCreate.map(async e=>{try{let r=e.sourceNodeId.startsWith("temp_")?parseInt(n[e.sourceNodeId]||"0"):parseInt(e.sourceNodeId),a=e.targetNodeId.startsWith("temp_")?parseInt(n[e.targetNodeId]||"0"):parseInt(e.targetNodeId);if(!r||!a)return console.error("Invalid source or target node ID for connection"),t.errors.edges++,{error:"Invalid node IDs"};let s={sourceNodeId:r,targetNodeId:a,condition:e.condition,priority:e.priority};return await (0,p.tq)(s),t.created.edges++,{success:!0}}catch(e){return console.error("Failed to create connection:",e),e.response?.status===404&&(r=!0),t.errors.edges++,{error:e}}})),await Promise.all(N.nodesToDelete.map(async e=>{try{return await (0,p.AC)(parseInt(e)),t.deleted.nodes++,{success:!0}}catch(e){if(console.error("Failed to delete node:",e),e.response?.status===404||e.message?.includes("endpoint was not found"))return r=!0,t.deleted.nodes++,{success:!0,apiMissing:!0};return t.errors.nodes++,{error:e}}})),await Promise.all(N.edgesToDelete.map(async e=>{try{let r=parseInt(e.replace("e",""));if(isNaN(r))return console.error("Invalid edge ID format:",e),t.errors.edges++,{error:"Invalid edge ID"};return await (0,p.aN)(r),t.deleted.edges++,{success:!0}}catch(e){if(console.error("Failed to delete connection:",e),e.response?.status===404||e.message?.includes("endpoint was not found"))return r=!0,t.deleted.edges++,{success:!0,apiMissing:!0};return t.errors.edges++,{error:e}}})),C({nodesToCreate:[],nodesToUpdate:[],nodesToDelete:[],edgesToCreate:[],edgesToDelete:[]}),$(e=>e.map(e=>{if(e.id.startsWith("temp_")&&n[e.id]){let t=n[e.id],r=a.find(t=>t.tempId===e.id)?.createdNode;if(r)return{...e,id:t,data:{...e.data,isTemp:!1,dialplanNode:r}}}return e})),h&&h(),o.Ay.dismiss(e),r?o.Ay.success("Changes saved with some limitations. Some API endpoints may not be fully implemented yet.",{duration:5e3}):t.errors.nodes>0||t.errors.edges>0?o.Ay.success(`Saved with some errors: Created ${t.created.nodes} nodes and ${t.created.edges} connections, updated ${t.updated.nodes} nodes, deleted ${t.deleted.nodes} nodes and ${t.deleted.edges} connections. Failed: ${t.errors.nodes} nodes, ${t.errors.edges} connections.`,{duration:5e3}):o.Ay.success(`Saved: ${t.created.nodes} nodes and ${t.created.edges} connections created, ${t.updated.nodes} nodes updated, ${t.deleted.nodes} nodes and ${t.deleted.edges} connections deleted`)}catch(t){console.error("Error saving changes:",t),o.Ay.dismiss(e),o.Ay.error("Failed to save changes. Some API endpoints may not be fully implemented yet.")}};return(0,a.jsx)("div",{className:"h-full w-full relative",ref:f,children:(0,a.jsxs)(u.Gc,{nodes:E,edges:q,onNodesChange:O,onEdgesChange:_,onConnect:B,onNodeClick:G,onInit:U,onDrop:J,onDragOver:K,onNodeDragStop:X,nodeTypes:W,edgeTypes:M,deleteKeyCode:["Delete","Backspace"],onNodesDelete:e=>e.forEach(e=>Q(e.id)),onEdgesDelete:e=>e.forEach(e=>Z(e)),fitView:!0,fitViewOptions:{padding:.2},attributionPosition:"bottom-right",connectionMode:"loose",connectionLineStyle:{stroke:"#3b82f6",strokeWidth:3},connectionLineType:"bezier",defaultEdgeOptions:{type:"default",style:{stroke:"#64748b",strokeWidth:2},animated:!1},defaultViewport:{x:0,y:0,zoom:1},children:[(0,a.jsx)(m.V,{}),(0,a.jsx)(g.H,{}),(0,a.jsx)(x.o,{}),(0,a.jsxs)(u.Zk,{position:"top-right",className:"flex gap-2",children:[Object.values(N).some(e=>e.length>0)&&(0,a.jsx)("div",{className:"bg-yellow-500 text-white text-xs rounded-full px-2 py-1",children:"Unsaved changes"}),(0,a.jsxs)(c.$,{variant:"outline",size:"sm",onClick:er,disabled:y||!s,children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]}),(0,a.jsxs)(c.$,{variant:b?"primary":"outline",size:"sm",onClick:et,disabled:y,children:[b?(0,a.jsx)(S.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),b?"Close Palette":"Add Node"]})]}),b&&(0,a.jsxs)(u.Zk,{position:"top-left",className:"max-h-[600px] overflow-auto bg-white p-2 rounded shadow-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Node Palette"}),(0,a.jsx)(c.$,{variant:"outline",size:"sm",onClick:et,children:(0,a.jsx)(S.A,{className:"h-4 w-4"})})]}),(0,a.jsx)(D,{nodeTypes:r})]}),w&&V&&(0,a.jsx)(u.Zk,{position:"right",className:"w-80 max-h-full overflow-auto",children:(0,a.jsx)(z,{selectedNode:V,onUpdateNodeProperties:Y,onUpdateNodeLabel:ee,onClosePanel:()=>{j(!1),H(null)}})}),!1]})})}function H(e){return(0,a.jsx)(u.Ln,{children:(0,a.jsx)(V,{...e})})}var R=r(28531),B=r.n(R);function G(){(0,s.useRouter)();let{id:e}=(0,s.useParams)(),t=Number(e),[r,u]=(0,n.useState)(!0),[m,g]=(0,n.useState)(null),[x,h]=(0,n.useState)([]),[y,f]=(0,n.useState)(null),[b,v]=(0,n.useState)([]),[w,j]=(0,n.useState)([]),[N,C]=(0,n.useState)([]),[k,T]=(0,n.useState)(!1),[A,S]=(0,n.useState)({name:"",description:"",position:{x:100,y:100}}),[I,P]=(0,n.useState)(null),D=async e=>{if(e.preventDefault(),t)try{let e=await (0,p.q6)(t,A);console.log("Created context:",e),o.Ay.success("Context created successfully"),S({name:"",description:"",position:{x:100,y:100}}),T(!1);let r=await (0,p.ht)(t);h(r),f(e.id)}catch(e){console.error("Error creating context:",e),o.Ay.error("Failed to create context")}};(0,n.useCallback)((e,t)=>{j(r=>r.map(r=>String(r.id)===String(e)?{...r,...t}:r))},[]),(0,n.useCallback)(e=>{j(t=>t.filter(t=>String(t.id)!==String(e))),C(t=>t.filter(t=>String(t.sourceNodeId)!==String(e)&&String(t.targetNodeId)!==String(e)))},[]),(0,n.useCallback)((e,t)=>{C(r=>r.map(r=>String(r.id)===String(e)?{...r,...t}:r))},[]),(0,n.useCallback)(e=>{C(t=>t.filter(t=>String(t.id)!==String(e)))},[]);let E=async()=>{if(t)try{let e=await (0,p.U$)(t);console.log("Validation result:",e),e.valid?o.Ay.success("Project validation successful!"):(o.Ay.error(`Validation failed with ${e.errors.length} errors`),e.errors.forEach(e=>console.error(e)))}catch(e){console.error("Error validating project:",e),o.Ay.error("Failed to validate project")}};return((0,n.useCallback)((e,t)=>{let r={id:Date.now(),contextId:y||0,nodeTypeId:e.id,name:`New ${e.name} Node`,label:`New ${e.name} Node`,position:t,properties:{},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};j(e=>[...e,r])},[y]),(0,n.useCallback)(e=>{let t={id:Date.now(),sourceNodeId:Number(e.source),targetNodeId:Number(e.target),condition:null,priority:1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};C(e=>[...e,t])},[]),r)?(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(B(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Loading Dial Plan..."})]}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6 min-h-[300px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading project data..."})})]})}):I?(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(B(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Error Loading Dial Plan"})]}),(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,a.jsxs)("div",{className:"text-center py-10",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-red-600 mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:I}),(0,a.jsx)(c.$,{variant:"default",onClick:()=>window.location.reload(),children:"Retry"})]})})]})}):(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)(B(),{href:"/dialplan",children:(0,a.jsxs)(c.$,{variant:"outline",className:"mr-4",children:[(0,a.jsx)(i.A,{className:"w-4 h-4 mr-2"}),"Back to Projects"]})}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:m?.name||"Dial Plan Editor"})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Contexts"}),(0,a.jsxs)(c.$,{onClick:()=>T(!k),variant:"outline",size:"sm",children:[(0,a.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Add Context"]})]}),k&&(0,a.jsxs)("div",{className:"mb-6 border border-gray-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-md font-medium text-gray-900 mb-4",children:"Create New Context"}),(0,a.jsxs)("form",{onSubmit:D,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-4 gap-x-4 sm:grid-cols-6",children:[(0,a.jsxs)("div",{className:"sm:col-span-3",children:[(0,a.jsx)("label",{htmlFor:"contextName",className:"block text-sm font-medium text-gray-700",children:"Context Name"}),(0,a.jsx)("input",{id:"contextName",type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand sm:text-sm",value:A.name,onChange:e=>S({...A,name:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"contextDescription",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("input",{id:"contextDescription",type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand sm:text-sm",value:A.description,onChange:e=>S({...A,description:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end space-x-3",children:[(0,a.jsx)(c.$,{type:"button",variant:"secondary",onClick:()=>T(!1),children:"Cancel"}),(0,a.jsx)(c.$,{type:"submit",variant:"default",disabled:!A.name,children:"Create Context"})]})]})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:x.length>0?x.map(e=>(0,a.jsx)("button",{className:`px-4 py-2 rounded-md text-sm font-medium ${y===e.id?"bg-brand text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,onClick:()=>f(e.id),children:e.name},e.id)):(0,a.jsx)("div",{className:"text-gray-500 text-sm",children:"No contexts available. Create one to start building your dial plan."})})]}),y?(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-4 h-[700px]",children:(0,a.jsx)(H,{nodes:w,edges:N.map(e=>({id:`e${e.id}`,source:e.sourceNodeId.toString(),target:e.targetNodeId.toString(),label:e.condition||void 0,type:"default"})),nodeTypes:b,contextId:y,onNodesChange:e=>{console.log("Nodes changed:",e)},onEdgesChange:e=>{console.log("Edges changed:",e)},onSave:E})}):(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6 min-h-[300px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:x.length>0?"Select a context to edit its dial plan":"Create a context to start building your dial plan"})})]})})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,1057,4052,5668,7519,6572,9388,4404,931,3868,9110],()=>r(1873));module.exports=a})();