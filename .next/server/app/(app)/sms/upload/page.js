(()=>{var e={};e.id=5219,e.ids=[5219],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{"use strict";e.exports=require("os")},24849:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29931:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var s=r(45512),a=r(58009),i=r(79334),n=r(22403),l=r(35668),o=r(61594),d=r(41680);let c=(0,d.A)("cloud-upload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);var p=r(44269);let m=(0,d.A)("table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);var u=r(24849),h=r(13868),x=r(43517),f=r(92666),g=r(66581);let b=({headers:e,recommendedMappings:t,fieldMapping:r,setFieldMapping:a})=>{let i=(e,t)=>{a(r=>({...r,[e]:t}))};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-700",children:"Map CSV Headers to System Fields:"}),(0,s.jsx)("div",{className:"text-xs text-red-500 font-medium",children:"* Required field"})]}),[{id:"phone",label:"Phone Number",required:!0},{id:"name",label:"Contact Name",required:!1},{id:"email",label:"Email Address",required:!1}].map(t=>(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 items-center",children:[(0,s.jsxs)("label",{htmlFor:`map-${t.id}`,className:`block text-sm font-medium ${t.required?"text-gray-800":"text-gray-700"} capitalize`,children:[t.label," ",t.required&&(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsxs)("select",{id:`map-${t.id}`,value:r[t.id]||"",onChange:e=>i(t.id,e.target.value),className:`block w-full pl-3 pr-10 py-2 text-base border ${t.required&&!r[t.id]?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-brand focus:border-brand"} rounded-md`,required:t.required,children:[(0,s.jsx)("option",{value:"",children:"-- Select CSV Header --"}),e.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),t.required&&!r[t.id]&&(0,s.jsx)("p",{className:"mt-1 text-xs text-red-500",children:"This field is required for importing contacts"})]})]},t.id)),(0,s.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-blue-800",children:(0,s.jsx)("strong",{children:"Field Mapping Instructions:"})}),(0,s.jsxs)("ul",{className:"mt-2 text-xs text-blue-700 list-disc pl-5 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Phone Number"})," is required and must be mapped to a CSV column containing valid phone numbers."]}),(0,s.jsx)("li",{children:"Name and Email are optional but recommended for better contact management."}),(0,s.jsx)("li",{children:"Any unmapped CSV columns will be imported as custom fields."}),(0,s.jsx)("li",{children:"Make sure your CSV headers match the expected format to ensure proper importing."})]})]})]})};function y(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(v,{})})}function v(){let e=(0,i.useRouter)();(0,i.useSearchParams)();let{isAuthenticated:t}=(0,f.n)(),[r,d]=(0,a.useState)(null),[y,v]=(0,a.useState)(null),[j,w]=(0,a.useState)(!1),[N,C]=(0,a.useState)(!1),[A,k]=(0,a.useState)({}),[q,P]=(0,a.useState)(""),[S,M]=(0,a.useState)([]),[L,F]=(0,a.useState)(null),[V,E]=(0,a.useState)(null),_=(0,a.useRef)(null),$=async()=>{if(!r){n.Ay.error("Please select a CSV file first.");return}w(!0),v(null),k({});let e=new FormData;e.append("file",r);try{let t=await (0,g.nz)(e);v(t);let r=t.recommendedMappings?{...t.recommendedMappings}:{};if(!r.phone&&t.headers){let e=t.headers.filter(e=>e.toLowerCase().includes("phone")||e.toLowerCase().includes("mobile")||e.toLowerCase().includes("cell")||"number"===e.toLowerCase()||"tel"===e.toLowerCase());e.length>0&&(r.phone=e[0])}if(!r.name&&t.headers){let e=t.headers.filter(e=>e.toLowerCase().includes("name")||"fullname"===e.toLowerCase()||"contact"===e.toLowerCase()||"customer"===e.toLowerCase());e.length>0&&(r.name=e[0])}if(!r.email&&t.headers){let e=t.headers.filter(e=>e.toLowerCase().includes("email")||e.toLowerCase().includes("mail")||"e-mail"===e.toLowerCase());e.length>0&&(r.email=e[0])}k(r),r.phone?n.Ay.success("CSV preview loaded successfully with auto-mapped fields."):n.Ay.success("CSV preview loaded. Please map the required Phone Number field."),F(!0)}catch(t){console.error("Error previewing CSV:",t);let e=t.message||"Failed to preview CSV. Please check the file format.";n.Ay.error(e),("Network Error"===t.message||e.includes("Network connection failed"))&&(F(!1),n.Ay.error("API server might be unreachable. Please try again later or contact support.",{duration:5e3}))}finally{w(!1)}},z=async()=>{if(!r||!y){n.Ay.error("Please select a file and preview it first.");return}if(!A.phone||""===A.phone.trim()){n.Ay.error("Phone Number field mapping is required. Please select a column for phone numbers."),document.querySelector("#map-phone")?.scrollIntoView({behavior:"smooth",block:"center"});return}let t=Object.values(A).filter(Boolean),s=new Set(t);if(t.length!==s.size){n.Ay.error("You have mapped multiple fields to the same CSV column. Please use each column only once.");return}C(!0);let a=new FormData;a.append("file",r);let i=q?parseInt(q,10):void 0;console.log("Importing with mapping:",A),console.log("Field mapping:",A),console.log("File name:",r.name),console.log("File size:",r.size);try{let t=await (0,g.v0)(a,A,i);F(!0),n.Ay.success(t.message||"Contacts imported successfully!"),d(null),v(null),k({}),P(""),_.current&&(_.current.value=""),i?e.push(`/sms/${i}/settings`):e.push("/sms")}catch(e){if(console.error("Error importing contacts:",e),"ECONNABORTED"===e.code)F(!1),n.Ay.error("Connection timeout. The server took too long to respond.");else if("Network Error"===e.message)F(!1),n.Ay.error("Network connection failed. Please check your internet connection or try again later.");else if(e.response){console.error("Server error data:",e.response.data),console.error("Server error status:",e.response.status),console.error("Server error headers:",e.response.headers);let t=e.response.data?.error||e.response.data?.message||`Server error (${e.response.status}): Please check your data and try again.`;n.Ay.error(t)}else if(e.request)console.error("No response received:",e.request),n.Ay.error("No response received from the server. Please try again later.");else{let t=e.message||"Failed to import contacts. Please check console for details.";n.Ay.error(t)}}finally{C(!1)}};return(0,s.jsx)(h.A,{children:(0,s.jsxs)("div",{className:"py-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(x.$,{variant:"ghost",onClick:()=>e.back(),className:"mr-4",children:(0,s.jsx)(l.A,{className:"w-4 h-4"})}),(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:V?`Upload Contacts for: ${V.name}`:"Upload & Import Contacts"})]}),V&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Campaign Status: ",(0,s.jsx)("span",{className:`font-medium ${"active"===V.status?"text-green-600":"text-yellow-600"}`,children:V.status})]})]}),!1===L&&(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(o.A,{className:"h-5 w-5 text-yellow-400"}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Connection Warning"}),(0,s.jsx)("p",{className:"text-sm text-yellow-700",children:"We're having trouble connecting to the server. Some features might be temporarily unavailable. You can still prepare your CSV file and try uploading again shortly."})]})]})}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,s.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:(0,s.jsxs)("div",{className:"space-y-1 text-center",children:[(0,s.jsx)(c,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,s.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,s.jsxs)("label",{htmlFor:"file-upload-input",className:"relative cursor-pointer bg-white rounded-md font-medium text-brand hover:text-brand-dark focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-brand",children:[(0,s.jsx)("span",{children:"Upload a file"}),(0,s.jsx)("input",{id:"file-upload-input",name:"file-upload",type:"file",className:"sr-only",accept:".csv",onChange:e=>{let t=e.target.files?.[0];t&&(d(t),v(null),k({}))},ref:_})]}),(0,s.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"CSV up to 10MB"})]})}),r&&(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[(0,s.jsxs)("p",{className:"text-sm font-medium text-gray-700 truncate",children:["Selected: ",r.name]}),(0,s.jsx)(x.$,{variant:"ghost",size:"sm",onClick:()=>{d(null),v(null),_.current&&(_.current.value="")},children:(0,s.jsx)(p.A,{className:"w-4 h-4 text-red-500"})})]}),(0,s.jsxs)(x.$,{onClick:$,disabled:!r||j,isLoading:j,className:"mt-4 w-full",variant:"secondary",children:[(0,s.jsx)(m,{className:"w-4 h-4 mr-2"}),"Preview CSV & Configure Mapping"]})]}),y&&(0,s.jsxs)("div",{className:"border-t pt-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"CSV Preview & Field Mapping"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,s.jsx)("span",{className:"font-medium text-red-600",children:"Field mapping is required"})," to correctly import your contacts. At minimum, you must map the ",(0,s.jsx)("span",{className:"font-medium",children:"Phone Number"})," field."]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Estimated Total Rows: ",y.totalRowsEstimate||"N/A"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsx)("tr",{children:y.headers.map(e=>(0,s.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e},e))})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.previewRows.map((e,t)=>(0,s.jsx)("tr",{children:y.headers.map(r=>(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e[r]},`${t}-${r}`))},t))})]})}),(0,s.jsx)(b,{headers:y.headers,recommendedMappings:y.recommendedMappings,fieldMapping:A,setFieldMapping:k}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"campaign-select",className:"block text-sm font-medium text-gray-700",children:V?"Selected Campaign":"Assign to Campaign (Optional)"}),(0,s.jsxs)("select",{id:"campaign-select",value:q,onChange:e=>P(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-brand focus:border-brand sm:text-sm rounded-md",disabled:!!V,children:[!V&&(0,s.jsx)("option",{value:"",children:"-- Assign Later or Use Default --"}),S.map(e=>(0,s.jsx)("option",{value:e.id.toString(),children:e.name},e.id))]}),(0,s.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:V?"Contacts will be uploaded to the selected campaign.":"If no campaign is selected, contacts might be assigned to a default campaign or held for later assignment, depending on backend configuration."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(x.$,{onClick:z,disabled:N||!A.phone,isLoading:N,className:"w-full",variant:"brand",children:[(0,s.jsx)(u.A,{className:"w-4 h-4 mr-2"}),N?"Importing...":"Import Contacts"]}),!A.phone&&(0,s.jsx)("p",{className:"text-center text-sm text-red-500",children:"Phone Number field mapping is required to import contacts"})]})]})]})]})})}},33873:e=>{"use strict";e.exports=require("path")},35668:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(41680).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},47327:(e,t,r)=>{Promise.resolve().then(r.bind(r,56775))},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56775:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Applications/Knittt-Lite-v2/app/(app)/sms/upload/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Applications/Knittt-Lite-v2/app/(app)/sms/upload/page.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73849:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>d});var s=r(70260),a=r(28203),i=r(25155),n=r.n(i),l=r(67292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d={children:["",{children:["(app)",{children:["sms",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,56775)),"/Applications/Knittt-Lite-v2/app/(app)/sms/upload/page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,19611)),"/Applications/Knittt-Lite-v2/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Applications/Knittt-Lite-v2/app/(app)/sms/upload/page.tsx"],p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(app)/sms/upload/page",pathname:"/sms/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},84279:(e,t,r)=>{Promise.resolve().then(r.bind(r,29931))},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,1057,4052,5668,7519,6572,9388,931,3868,9110],()=>r(73849));module.exports=s})();