(()=>{var e={};e.id=7187,e.ids=[7187],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4643:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(41680).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},7702:(e,t,s)=>{"use strict";s.d(t,{cn:()=>i});var a=s(82281),r=s(94805);function i(...e){return(0,r.QP)((0,a.$)(e))}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},14173:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>d});var a=s(70260),r=s(28203),i=s(25155),n=s.n(i),l=s(67292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d={children:["",{children:["(app)",{children:["sms",{children:["[id]",{children:["settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,91301)),"/Applications/Knittt-Lite-v2/app/(app)/sms/[id]/settings/page.tsx"]}]},{}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,19611)),"/Applications/Knittt-Lite-v2/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Applications/Knittt-Lite-v2/app/(app)/sms/[id]/settings/page.tsx"],m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/(app)/sms/[id]/settings/page",pathname:"/sms/[id]/settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21399:(e,t,s)=>{Promise.resolve().then(s.bind(s,91301))},21820:e=>{"use strict";e.exports=require("os")},26658:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(41680).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33680:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(41680).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},33873:e=>{"use strict";e.exports=require("path")},35668:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(41680).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},49169:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(45512),r=s(58009),i=s(7702);let n=r.forwardRef(({className:e,type:t,label:s,error:r,...n},l)=>(0,a.jsxs)("div",{className:"w-full",children:[s&&(0,a.jsx)("label",{htmlFor:n.id,className:"block text-sm font-medium text-gray-700 mb-1",children:s}),(0,a.jsx)("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r?"border-red-500 focus-visible:ring-red-500":"",e),ref:l,...n}),r&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:r})]}));n.displayName="Input"},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58191:(e,t,s)=>{Promise.resolve().then(s.bind(s,94073))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72744:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(41680).A)("upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91301:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Applications/Knittt-Lite-v2/app/(app)/sms/[id]/settings/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Applications/Knittt-Lite-v2/app/(app)/sms/[id]/settings/page.tsx","default")},94073:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(45512),r=s(58009),i=s(79334),n=s(22403),l=s(35668),o=s(72744),d=s(64977),c=s(4643),m=s(26658),u=s(33680),p=s(13868),x=s(43517),h=s(49169),y=s(66581),g=s(92666);function b({campaignId:e}){let t=(0,i.useRouter)(),{isAuthenticated:s}=(0,g.n)(),[b,f]=(0,r.useState)(!0),[v,j]=(0,r.useState)(!1),[w,A]=(0,r.useState)(!1),[N,k]=(0,r.useState)({id:0,name:"",status:"",rateLimit:60,autoReplyEnabled:!1,replyTemplate:"",messageTemplate:""}),C=async()=>{f(!0);try{let t=await (0,y.mI)(parseInt(e));k({id:t.id,name:t.name,status:t.status,rateLimit:t.rateLimit,autoReplyEnabled:t.autoReplyEnabled,replyTemplate:t.replyTemplate||"",messageTemplate:t.messageTemplate,contactStats:t.contactStats})}catch(e){console.error("Error fetching campaign settings:",e),(0,n.Ay)("Failed to load campaign settings")}finally{f(!1)}},P=async e=>{if(e.preventDefault(),j(!0),N.rateLimit<1||N.rateLimit>1e4){n.Ay.error("Rate limit must be between 1 and 10000 messages per hour"),j(!1);return}if(!N.messageTemplate.trim()){n.Ay.error("Message template cannot be empty"),j(!1);return}if(N.autoReplyEnabled&&!N.replyTemplate.trim()){n.Ay.error("Auto-reply template cannot be empty when auto-reply is enabled"),j(!1);return}let s=!1,a=0;for(;!s&&a<=2;)try{await (0,y.Ah)(N.id,N.rateLimit),s=!0}catch(e){if(console.error(`Error saving rate limit (attempt ${a+1}/3):`,e),++a>2){if(window.confirm("Having trouble connecting to save rate limit settings. Do you want to:\n\n- Click OK to continue with other settings without rate limit change\n- Click Cancel to stop the save process entirely"))(0,n.Ay)("Rate limit not saved due to connection issues, continuing with other settings.");else{n.Ay.error("Settings save cancelled."),j(!1);return}}else await new Promise(e=>setTimeout(e,1e3*a))}try{await (0,y.s3)(N.id,{autoReplyEnabled:N.autoReplyEnabled,replyTemplate:N.replyTemplate}),s?n.Ay.success("All settings saved successfully"):n.Ay.success("Auto-reply settings saved successfully"),t.refresh()}catch(e){console.error("Error saving auto-reply settings:",e),n.Ay.error("Failed to save auto-reply settings")}finally{j(!1)}},T=async()=>{if(window.confirm(`Are you sure you want to ${"active"===N.status?"pause":"start"} this campaign?`))try{"active"===N.status?(await (0,y.kb)(N.id),k(e=>({...e,status:"paused"})),n.Ay.success("Campaign paused successfully")):(await (0,y.Kl)(N.id),k(e=>({...e,status:"active"})),n.Ay.success("Campaign started successfully"))}catch(e){console.error("Error toggling campaign status:",e),n.Ay.error("Failed to update campaign status. Please try again.")}},E=async()=>{if(!N.id)return;let e=N.contactStats?.unresponded||0;if(0===e){(0,n.Ay)("No unresponded messages to clear");return}if(window.confirm(`Are you sure you want to mark all ${e} unresponded messages for this campaign as resolved?`)){A(!0);try{let e=await (0,y.$2)(N.id);n.Ay.success(e.message||"Unresponded messages cleared successfully"),C()}catch(e){console.error("Error clearing unresponded messages:",e),n.Ay.error("Failed to clear unresponded messages. Please try again.")}finally{A(!1)}}},q=()=>{t.push(`/sms/upload?campaignId=${e}`)};return s?(0,a.jsx)(p.A,{children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(x.$,{variant:"ghost",onClick:()=>t.back(),className:"mr-4",children:(0,a.jsx)(l.A,{className:"w-4 h-4"})}),(0,a.jsxs)("h1",{className:"text-2xl font-semibold text-gray-900",children:["Campaign Settings: ",N.name]})]}),(0,a.jsxs)(x.$,{variant:"brand",onClick:q,className:"flex items-center",children:[(0,a.jsx)(o.A,{className:"w-4 h-4 mr-2"}),"Upload Leads"]})]}),b?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-500",children:"Loading settings..."})]}):(0,a.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,a.jsx)("div",{className:"px-4 py-5 sm:p-6",children:(0,a.jsxs)("form",{onSubmit:P,className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Campaign Status"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Current status: ",(0,a.jsx)("span",{className:`font-medium ${"active"===N.status?"text-green-600":"text-yellow-600"}`,children:N.status})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)(x.$,{type:"button",variant:"outline",onClick:q,children:[(0,a.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Upload Contacts"]}),(0,a.jsx)(x.$,{type:"button",variant:"active"===N.status?"secondary":"brand",onClick:T,disabled:"completed"===N.status,children:"active"===N.status?"Pause Campaign":"draft"===N.status||"paused"===N.status?"Start Campaign":"Campaign Completed"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"rateLimit",className:"block text-sm font-medium text-gray-700",children:"Rate Limit (messages per hour)"}),(0,a.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,a.jsx)(c.A,{className:"h-5 w-5 text-gray-400 mr-2"}),(0,a.jsx)(h.p,{type:"number",id:"rateLimit",value:N.rateLimit,onChange:e=>k(t=>({...t,rateLimit:parseInt(e.target.value,10)||0})),min:"1",max:"10000",className:"w-32"})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Maximum number of messages that can be sent per hour."})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"checkbox",id:"autoReplyEnabled",checked:N.autoReplyEnabled,onChange:e=>k(t=>({...t,autoReplyEnabled:e.target.checked})),className:"h-4 w-4 text-brand focus:ring-brand border-gray-300 rounded"}),(0,a.jsx)("label",{htmlFor:"autoReplyEnabled",className:"text-sm font-medium text-gray-700",children:"Enable Auto-Reply"})]}),N.autoReplyEnabled&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("label",{htmlFor:"replyTemplate",className:"block text-sm font-medium text-gray-700",children:"Auto-Reply Message"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("textarea",{id:"replyTemplate",rows:3,value:N.replyTemplate,onChange:e=>k(t=>({...t,replyTemplate:e.target.value})),className:"shadow-sm focus:ring-brand focus:border-brand block w-full sm:text-sm border border-gray-300 rounded-md",placeholder:"Thank you for your message. We'll get back to you soon."})}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"This message will be sent automatically when you receive a message."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"messageTemplate",className:"block text-sm font-medium text-gray-700",children:"Campaign Message Template"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("textarea",{id:"messageTemplate",rows:5,value:N.messageTemplate,onChange:e=>k(t=>({...t,messageTemplate:e.target.value})),className:"shadow-sm focus:ring-brand focus:border-brand block w-full sm:text-sm border border-gray-300 rounded-md",placeholder:"Hi {name}, this is a message for you..."})}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Use ","{name}",", ","{phone}",", ","{email}"," and other contact custom fields as placeholders."]})]}),(0,a.jsxs)("div",{className:"border-t pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Manage Unresponded Messages"}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Mark all currently unresponded messages for this campaign as resolved.","number"==typeof N.contactStats?.unresponded&&N.contactStats.unresponded>0&&`There are currently ${N.contactStats.unresponded} unresponded messages.`]}),(0,a.jsxs)(x.$,{type:"button",variant:"outline",onClick:E,isLoading:w,disabled:w,className:"mt-3",children:[(0,a.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Clear All Unresponded"]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 border-t pt-6",children:[(0,a.jsx)(x.$,{type:"button",variant:"secondary",onClick:()=>t.back(),children:"Cancel"}),(0,a.jsxs)(x.$,{type:"submit",variant:"brand",isLoading:v,children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})})})]})}):null}function f({params:e}){return(0,a.jsx)(b,{campaignId:e.id})}},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[638,1057,4052,5668,7519,6572,9388,931,3868,9110],()=>s(14173));module.exports=a})();